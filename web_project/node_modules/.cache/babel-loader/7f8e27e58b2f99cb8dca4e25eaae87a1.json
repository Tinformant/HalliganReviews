{"ast":null,"code":"/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar Plotly = require('../../plot_api/plot_api');\n\nvar Fx = require('../../components/fx');\n\nvar Lib = require('../../lib');\n\nvar Drawing = require('../../components/drawing');\n\nvar tinycolor = require('tinycolor2');\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nfunction performPlot(parcatsModels, graphDiv, layout, svg) {\n  var viewModels = parcatsModels.map(createParcatsViewModel.bind(0, graphDiv, layout)); // Get (potentially empty) parcatslayer selection with bound data to single element array\n\n  var layerSelection = svg.selectAll('g.parcatslayer').data([null]); // Initialize single parcatslayer group if it doesn't exist\n\n  layerSelection.enter().append('g').attr('class', 'parcatslayer').style('pointer-events', 'all'); // Bind data to children of layerSelection and get reference to traceSelection\n\n  var traceSelection = layerSelection.selectAll('g.trace.parcats').data(viewModels, key); // Initialize group for each trace/dimensions\n\n  var traceEnter = traceSelection.enter().append('g').attr('class', 'trace parcats'); // Update properties for each trace\n\n  traceSelection.attr('transform', function (d) {\n    return 'translate(' + d.x + ', ' + d.y + ')';\n  }); // Initialize paths group\n\n  traceEnter.append('g').attr('class', 'paths'); // Update paths transform\n\n  var pathsSelection = traceSelection.select('g.paths'); // Get paths selection\n\n  var pathSelection = pathsSelection.selectAll('path.path').data(function (d) {\n    return d.paths;\n  }, key); // Update existing path colors\n\n  pathSelection.attr('fill', function (d) {\n    return d.model.color;\n  }); // Create paths\n\n  var pathSelectionEnter = pathSelection.enter().append('path').attr('class', 'path').attr('stroke-opacity', 0).attr('fill', function (d) {\n    return d.model.color;\n  }).attr('fill-opacity', 0);\n  stylePathsNoHover(pathSelectionEnter); // Set path geometry\n\n  pathSelection.attr('d', function (d) {\n    return d.svgD;\n  }); // sort paths\n\n  if (!pathSelectionEnter.empty()) {\n    // Only sort paths if there has been a change.\n    // Otherwise paths are already sorted or a hover operation may be in progress\n    pathSelection.sort(compareRawColor);\n  } // Remove any old paths\n\n\n  pathSelection.exit().remove(); // Path hover\n\n  pathSelection.on('mouseover', mouseoverPath).on('mouseout', mouseoutPath).on('click', clickPath); // Initialize dimensions group\n\n  traceEnter.append('g').attr('class', 'dimensions'); // Update dimensions transform\n\n  var dimensionsSelection = traceSelection.select('g.dimensions'); // Get dimension selection\n\n  var dimensionSelection = dimensionsSelection.selectAll('g.dimension').data(function (d) {\n    return d.dimensions;\n  }, key); // Create dimension groups\n\n  dimensionSelection.enter().append('g').attr('class', 'dimension'); // Update dimension group transforms\n\n  dimensionSelection.attr('transform', function (d) {\n    return 'translate(' + d.x + ', 0)';\n  }); // Remove any old dimensions\n\n  dimensionSelection.exit().remove(); // Get category selection\n\n  var categorySelection = dimensionSelection.selectAll('g.category').data(function (d) {\n    return d.categories;\n  }, key); // Initialize category groups\n\n  var categoryGroupEnterSelection = categorySelection.enter().append('g').attr('class', 'category'); // Update category transforms\n\n  categorySelection.attr('transform', function (d) {\n    return 'translate(0, ' + d.y + ')';\n  }); // Initialize rectangle\n\n  categoryGroupEnterSelection.append('rect').attr('class', 'catrect').attr('pointer-events', 'none'); // Update rectangle\n\n  categorySelection.select('rect.catrect').attr('fill', 'none').attr('width', function (d) {\n    return d.width;\n  }).attr('height', function (d) {\n    return d.height;\n  });\n  styleCategoriesNoHover(categoryGroupEnterSelection); // Initialize color band rects\n\n  var bandSelection = categorySelection.selectAll('rect.bandrect').data(\n  /** @param {CategoryViewModel} catViewModel*/\n  function (catViewModel) {\n    return catViewModel.bands;\n  }, key); // Raise all update bands to the top so that fading enter/exit bands will be behind\n\n  bandSelection.each(function () {\n    Lib.raiseToTop(this);\n  }); // Update band color\n\n  bandSelection.attr('fill', function (d) {\n    return d.color;\n  });\n  var bandsSelectionEnter = bandSelection.enter().append('rect').attr('class', 'bandrect').attr('stroke-opacity', 0).attr('fill', function (d) {\n    return d.color;\n  }).attr('fill-opacity', 0);\n  bandSelection.attr('fill', function (d) {\n    return d.color;\n  }).attr('width', function (d) {\n    return d.width;\n  }).attr('height', function (d) {\n    return d.height;\n  }).attr('y', function (d) {\n    return d.y;\n  }).attr('cursor',\n  /** @param {CategoryBandViewModel} bandModel*/\n  function (bandModel) {\n    if (bandModel.parcatsViewModel.arrangement === 'fixed') {\n      return 'default';\n    } else if (bandModel.parcatsViewModel.arrangement === 'perpendicular') {\n      return 'ns-resize';\n    } else {\n      return 'move';\n    }\n  });\n  styleBandsNoHover(bandsSelectionEnter);\n  bandSelection.exit().remove(); // Initialize category label\n\n  categoryGroupEnterSelection.append('text').attr('class', 'catlabel').attr('pointer-events', 'none');\n  var paperColor = graphDiv._fullLayout.paper_bgcolor; // Update category label\n\n  categorySelection.select('text.catlabel').attr('text-anchor', function (d) {\n    if (catInRightDim(d)) {\n      // Place label to the right of category\n      return 'start';\n    } else {\n      // Place label to the left of category\n      return 'end';\n    }\n  }).attr('alignment-baseline', 'middle').style('text-shadow', paperColor + ' -1px  1px 2px, ' + paperColor + ' 1px  1px 2px, ' + paperColor + '  1px -1px 2px, ' + paperColor + ' -1px -1px 2px').style('fill', 'rgb(0, 0, 0)').attr('x', function (d) {\n    if (catInRightDim(d)) {\n      // Place label to the right of category\n      return d.width + 5;\n    } else {\n      // Place label to the left of category\n      return -5;\n    }\n  }).attr('y', function (d) {\n    return d.height / 2;\n  }).text(function (d) {\n    return d.model.categoryLabel;\n  }).each(\n  /** @param {CategoryViewModel} catModel*/\n  function (catModel) {\n    Drawing.font(d3.select(this), catModel.parcatsViewModel.categorylabelfont);\n    svgTextUtils.convertToTspans(d3.select(this), graphDiv);\n  }); // Initialize dimension label\n\n  categoryGroupEnterSelection.append('text').attr('class', 'dimlabel'); // Update dimension label\n\n  categorySelection.select('text.dimlabel').attr('text-anchor', 'middle').attr('alignment-baseline', 'baseline').attr('cursor',\n  /** @param {CategoryViewModel} catModel*/\n  function (catModel) {\n    if (catModel.parcatsViewModel.arrangement === 'fixed') {\n      return 'default';\n    } else {\n      return 'ew-resize';\n    }\n  }).attr('x', function (d) {\n    return d.width / 2;\n  }).attr('y', -5).text(function (d, i) {\n    if (i === 0) {\n      // Add dimension label above topmost category\n      return d.parcatsViewModel.model.dimensions[d.model.dimensionInd].dimensionLabel;\n    } else {\n      return null;\n    }\n  }).each(\n  /** @param {CategoryViewModel} catModel*/\n  function (catModel) {\n    Drawing.font(d3.select(this), catModel.parcatsViewModel.labelfont);\n  }); // Category hover\n  // categorySelection.select('rect.catrect')\n\n  categorySelection.selectAll('rect.bandrect').on('mouseover', mouseoverCategoryBand).on('mouseout', mouseoutCategory); // Remove unused categories\n\n  categorySelection.exit().remove(); // Setup drag\n\n  dimensionSelection.call(d3.behavior.drag().origin(function (d) {\n    return {\n      x: d.x,\n      y: 0\n    };\n  }).on('dragstart', dragDimensionStart).on('drag', dragDimension).on('dragend', dragDimensionEnd)); // Save off selections to view models\n\n  traceSelection.each(function (d) {\n    d.traceSelection = d3.select(this);\n    d.pathSelection = d3.select(this).selectAll('g.paths').selectAll('path.path');\n    d.dimensionSelection = d3.select(this).selectAll('g.dimensions').selectAll('g.dimension');\n  }); // Remove any orphan traces\n\n  traceSelection.exit().remove();\n}\n/**\n * Create / update parcat traces\n *\n * @param {Object} graphDiv\n * @param {Object} svg\n * @param {Array.<ParcatsModel>} parcatsModels\n * @param {Layout} layout\n */\n\n\nmodule.exports = function (graphDiv, svg, parcatsModels, layout) {\n  performPlot(parcatsModels, graphDiv, layout, svg);\n};\n/**\n * Function the returns the key property of an object for use with as D3 join function\n * @param d\n */\n\n\nfunction key(d) {\n  return d.key;\n}\n/** True if a category view model is in the right-most display dimension\n * @param {CategoryViewModel} d */\n\n\nfunction catInRightDim(d) {\n  var numDims = d.parcatsViewModel.dimensions.length;\n  var leftDimInd = d.parcatsViewModel.dimensions[numDims - 1].model.dimensionInd;\n  return d.model.dimensionInd === leftDimInd;\n}\n/**\n * @param {PathViewModel} a\n * @param {PathViewModel} b\n */\n\n\nfunction compareRawColor(a, b) {\n  if (a.model.rawColor > b.model.rawColor) {\n    return 1;\n  } else if (a.model.rawColor < b.model.rawColor) {\n    return -1;\n  } else {\n    return 0;\n  }\n}\n/**\n * Handle path mouseover\n * @param {PathViewModel} d\n */\n\n\nfunction mouseoverPath(d) {\n  if (!d.parcatsViewModel.dragDimension) {\n    // We're not currently dragging\n    if (d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n      // hoverinfo is not skip, so we at least style the paths and emit interaction events\n      // Raise path to top\n      Lib.raiseToTop(this);\n      stylePathsHover(d3.select(this)); // Emit hover event\n\n      var points = buildPointsArrayForPath(d);\n      var constraints = buildConstraintsForPath(d);\n      d.parcatsViewModel.graphDiv.emit('plotly_hover', {\n        points: points,\n        event: d3.event,\n        constraints: constraints\n      }); // Handle hover label\n\n      if (d.parcatsViewModel.hoverinfoItems.indexOf('none') === -1) {\n        // hoverinfo is a combination of 'count' and 'probability'\n        // Mouse\n        var hoverX = d3.mouse(this)[0]; // Label\n\n        var gd = d.parcatsViewModel.graphDiv;\n        var trace = d.parcatsViewModel.trace;\n        var fullLayout = gd._fullLayout;\n\n        var rootBBox = fullLayout._paperdiv.node().getBoundingClientRect();\n\n        var graphDivBBox = d.parcatsViewModel.graphDiv.getBoundingClientRect(); // Find path center in path coordinates\n\n        var pathCenterX, pathCenterY, dimInd;\n\n        for (dimInd = 0; dimInd < d.leftXs.length - 1; dimInd++) {\n          if (d.leftXs[dimInd] + d.dimWidths[dimInd] - 2 <= hoverX && hoverX <= d.leftXs[dimInd + 1] + 2) {\n            var leftDim = d.parcatsViewModel.dimensions[dimInd];\n            var rightDim = d.parcatsViewModel.dimensions[dimInd + 1];\n            pathCenterX = (leftDim.x + leftDim.width + rightDim.x) / 2;\n            pathCenterY = (d.topYs[dimInd] + d.topYs[dimInd + 1] + d.height) / 2;\n            break;\n          }\n        } // Find path center in root coordinates\n\n\n        var hoverCenterX = d.parcatsViewModel.x + pathCenterX;\n        var hoverCenterY = d.parcatsViewModel.y + pathCenterY;\n        var textColor = tinycolor.mostReadable(d.model.color, ['black', 'white']);\n        var count = d.model.count;\n        var prob = count / d.parcatsViewModel.model.count;\n        var labels = {\n          countLabel: count,\n          probabilityLabel: prob.toFixed(3)\n        }; // Build hover text\n\n        var hovertextParts = [];\n\n        if (d.parcatsViewModel.hoverinfoItems.indexOf('count') !== -1) {\n          hovertextParts.push(['Count:', labels.countLabel].join(' '));\n        }\n\n        if (d.parcatsViewModel.hoverinfoItems.indexOf('probability') !== -1) {\n          hovertextParts.push(['P:', labels.probabilityLabel].join(' '));\n        }\n\n        var hovertext = hovertextParts.join('<br>');\n        var mouseX = d3.mouse(gd)[0];\n        Fx.loneHover({\n          trace: trace,\n          x: hoverCenterX - rootBBox.left + graphDivBBox.left,\n          y: hoverCenterY - rootBBox.top + graphDivBBox.top,\n          text: hovertext,\n          color: d.model.color,\n          borderColor: 'black',\n          fontFamily: 'Monaco, \"Courier New\", monospace',\n          fontSize: 10,\n          fontColor: textColor,\n          idealAlign: mouseX < hoverCenterX ? 'right' : 'left',\n          hovertemplate: (trace.line || {}).hovertemplate,\n          hovertemplateLabels: labels,\n          eventData: [{\n            data: trace._input,\n            fullData: trace,\n            count: count,\n            probability: prob\n          }]\n        }, {\n          container: fullLayout._hoverlayer.node(),\n          outerContainer: fullLayout._paper.node(),\n          gd: gd\n        });\n      }\n    }\n  }\n}\n/**\n * Handle path mouseout\n * @param {PathViewModel} d\n */\n\n\nfunction mouseoutPath(d) {\n  if (!d.parcatsViewModel.dragDimension) {\n    // We're not currently dragging\n    stylePathsNoHover(d3.select(this)); // Remove and hover label\n\n    Fx.loneUnhover(d.parcatsViewModel.graphDiv._fullLayout._hoverlayer.node()); // Restore path order\n\n    d.parcatsViewModel.pathSelection.sort(compareRawColor); // Emit unhover event\n\n    if (d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n      var points = buildPointsArrayForPath(d);\n      var constraints = buildConstraintsForPath(d);\n      d.parcatsViewModel.graphDiv.emit('plotly_unhover', {\n        points: points,\n        event: d3.event,\n        constraints: constraints\n      });\n    }\n  }\n}\n/**\n * Build array of point objects for a path\n *\n * For use in click/hover events\n * @param {PathViewModel} d\n */\n\n\nfunction buildPointsArrayForPath(d) {\n  var points = [];\n  var curveNumber = getTraceIndex(d.parcatsViewModel);\n\n  for (var i = 0; i < d.model.valueInds.length; i++) {\n    var pointNumber = d.model.valueInds[i];\n    points.push({\n      curveNumber: curveNumber,\n      pointNumber: pointNumber\n    });\n  }\n\n  return points;\n}\n/**\n * Build constraints object for a path\n *\n * For use in click/hover events\n * @param {PathViewModel} d\n */\n\n\nfunction buildConstraintsForPath(d) {\n  var constraints = {};\n  var dimensions = d.parcatsViewModel.model.dimensions; // dimensions\n\n  for (var i = 0; i < dimensions.length; i++) {\n    var dimension = dimensions[i];\n    var category = dimension.categories[d.model.categoryInds[i]];\n    constraints[dimension.containerInd] = category.categoryValue;\n  } // color\n\n\n  if (d.model.rawColor !== undefined) {\n    constraints.color = d.model.rawColor;\n  }\n\n  return constraints;\n}\n/**\n * Handle path click\n * @param {PathViewModel} d\n */\n\n\nfunction clickPath(d) {\n  if (d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n    // hoverinfo it's skip, so interaction events aren't disabled\n    var points = buildPointsArrayForPath(d);\n    var constraints = buildConstraintsForPath(d);\n    d.parcatsViewModel.graphDiv.emit('plotly_click', {\n      points: points,\n      event: d3.event,\n      constraints: constraints\n    });\n  }\n}\n\nfunction stylePathsNoHover(pathSelection) {\n  pathSelection.attr('fill', function (d) {\n    return d.model.color;\n  }).attr('fill-opacity', 0.6).attr('stroke', 'lightgray').attr('stroke-width', 0.2).attr('stroke-opacity', 1.0);\n}\n\nfunction stylePathsHover(pathSelection) {\n  pathSelection.attr('fill-opacity', 0.8).attr('stroke', function (d) {\n    return tinycolor.mostReadable(d.model.color, ['black', 'white']);\n  }).attr('stroke-width', 0.3);\n}\n\nfunction styleCategoryHover(categorySelection) {\n  categorySelection.select('rect.catrect').attr('stroke', 'black').attr('stroke-width', 2.5);\n}\n\nfunction styleCategoriesNoHover(categorySelection) {\n  categorySelection.select('rect.catrect').attr('stroke', 'black').attr('stroke-width', 1).attr('stroke-opacity', 1);\n}\n\nfunction styleBandsHover(bandsSelection) {\n  bandsSelection.attr('stroke', 'black').attr('stroke-width', 1.5);\n}\n\nfunction styleBandsNoHover(bandsSelection) {\n  bandsSelection.attr('stroke', 'black').attr('stroke-width', 0.2).attr('stroke-opacity', 1.0).attr('fill-opacity', 1.0);\n}\n/**\n * Return selection of all paths that pass through the specified category\n * @param {CategoryBandViewModel} catBandViewModel\n */\n\n\nfunction selectPathsThroughCategoryBandColor(catBandViewModel) {\n  var allPaths = catBandViewModel.parcatsViewModel.pathSelection;\n  var dimInd = catBandViewModel.categoryViewModel.model.dimensionInd;\n  var catInd = catBandViewModel.categoryViewModel.model.categoryInd;\n  return allPaths.filter(\n  /** @param {PathViewModel} pathViewModel */\n  function (pathViewModel) {\n    return pathViewModel.model.categoryInds[dimInd] === catInd && pathViewModel.model.color === catBandViewModel.color;\n  });\n}\n/**\n * Perform hover styling for all paths that pass though the specified band element's category\n *\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\n\n\nfunction styleForCategoryHovermode(bandElement) {\n  // Get all bands in the current category\n  var bandSel = d3.select(bandElement.parentNode).selectAll('rect.bandrect'); // Raise and style paths\n\n  bandSel.each(function (bvm) {\n    var paths = selectPathsThroughCategoryBandColor(bvm);\n    stylePathsHover(paths);\n    paths.each(function () {\n      // Raise path to top\n      Lib.raiseToTop(this);\n    });\n  }); // Style category\n\n  styleCategoryHover(d3.select(bandElement.parentNode));\n}\n/**\n * Perform hover styling for all paths that pass though the category of the specified band element and share the\n * same color\n *\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\n\n\nfunction styleForColorHovermode(bandElement) {\n  var bandViewModel = d3.select(bandElement).datum();\n  var catPaths = selectPathsThroughCategoryBandColor(bandViewModel);\n  stylePathsHover(catPaths);\n  catPaths.each(function () {\n    // Raise path to top\n    Lib.raiseToTop(this);\n  }); // Style category for drag\n\n  d3.select(bandElement.parentNode).selectAll('rect.bandrect').filter(function (b) {\n    return b.color === bandViewModel.color;\n  }).each(function () {\n    Lib.raiseToTop(this);\n    styleBandsHover(d3.select(this));\n  });\n}\n/**\n * @param {HTMLElement} bandElement\n *  HTML element for band\n * @param eventName\n *  Event name (plotly_hover or plotly_click)\n * @param event\n *  Mouse Event\n */\n\n\nfunction emitPointsEventCategoryHovermode(bandElement, eventName, event) {\n  // Get all bands in the current category\n  var bandViewModel = d3.select(bandElement).datum();\n  var categoryModel = bandViewModel.categoryViewModel.model;\n  var gd = bandViewModel.parcatsViewModel.graphDiv;\n  var bandSel = d3.select(bandElement.parentNode).selectAll('rect.bandrect');\n  var points = [];\n  bandSel.each(function (bvm) {\n    var paths = selectPathsThroughCategoryBandColor(bvm);\n    paths.each(function (pathViewModel) {\n      // Extend points array\n      Array.prototype.push.apply(points, buildPointsArrayForPath(pathViewModel));\n    });\n  });\n  var constraints = {};\n  constraints[categoryModel.dimensionInd] = categoryModel.categoryValue;\n  gd.emit(eventName, {\n    points: points,\n    event: event,\n    constraints: constraints\n  });\n}\n/**\n * @param {HTMLElement} bandElement\n *  HTML element for band\n * @param eventName\n *  Event name (plotly_hover or plotly_click)\n * @param event\n *  Mouse Event\n */\n\n\nfunction emitPointsEventColorHovermode(bandElement, eventName, event) {\n  var bandViewModel = d3.select(bandElement).datum();\n  var categoryModel = bandViewModel.categoryViewModel.model;\n  var gd = bandViewModel.parcatsViewModel.graphDiv;\n  var paths = selectPathsThroughCategoryBandColor(bandViewModel);\n  var points = [];\n  paths.each(function (pathViewModel) {\n    // Extend points array\n    Array.prototype.push.apply(points, buildPointsArrayForPath(pathViewModel));\n  });\n  var constraints = {};\n  constraints[categoryModel.dimensionInd] = categoryModel.categoryValue; // color\n\n  if (bandViewModel.rawColor !== undefined) {\n    constraints.color = bandViewModel.rawColor;\n  }\n\n  gd.emit(eventName, {\n    points: points,\n    event: event,\n    constraints: constraints\n  });\n}\n/**\n * Create hover label for a band element's category (for use when hoveron === 'category')\n *\n * @param {ClientRect} rootBBox\n *  Client bounding box for root of figure\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\n\n\nfunction createHoverLabelForCategoryHovermode(rootBBox, bandElement) {\n  // Selections\n  var rectSelection = d3.select(bandElement.parentNode).select('rect.catrect');\n  var rectBoundingBox = rectSelection.node().getBoundingClientRect(); // Models\n\n  /** @type {CategoryViewModel} */\n\n  var catViewModel = rectSelection.datum();\n  var parcatsViewModel = catViewModel.parcatsViewModel;\n  var dimensionModel = parcatsViewModel.model.dimensions[catViewModel.model.dimensionInd];\n  var trace = parcatsViewModel.trace; // Positions\n\n  var hoverCenterY = rectBoundingBox.top + rectBoundingBox.height / 2;\n  var hoverCenterX, hoverLabelIdealAlign;\n\n  if (parcatsViewModel.dimensions.length > 1 && dimensionModel.displayInd === parcatsViewModel.dimensions.length - 1) {\n    // right most dimension\n    hoverCenterX = rectBoundingBox.left;\n    hoverLabelIdealAlign = 'left';\n  } else {\n    hoverCenterX = rectBoundingBox.left + rectBoundingBox.width;\n    hoverLabelIdealAlign = 'right';\n  }\n\n  var count = catViewModel.model.count;\n  var catLabel = catViewModel.model.categoryLabel;\n  var prob = count / catViewModel.parcatsViewModel.model.count;\n  var labels = {\n    countLabel: count,\n    categoryLabel: catLabel,\n    probabilityLabel: prob.toFixed(3)\n  }; // Hover label text\n\n  var hoverinfoParts = [];\n\n  if (catViewModel.parcatsViewModel.hoverinfoItems.indexOf('count') !== -1) {\n    hoverinfoParts.push(['Count:', labels.countLabel].join(' '));\n  }\n\n  if (catViewModel.parcatsViewModel.hoverinfoItems.indexOf('probability') !== -1) {\n    hoverinfoParts.push(['P(' + labels.categoryLabel + '):', labels.probabilityLabel].join(' '));\n  }\n\n  var hovertext = hoverinfoParts.join('<br>');\n  return {\n    trace: trace,\n    x: hoverCenterX - rootBBox.left,\n    y: hoverCenterY - rootBBox.top,\n    text: hovertext,\n    color: 'lightgray',\n    borderColor: 'black',\n    fontFamily: 'Monaco, \"Courier New\", monospace',\n    fontSize: 12,\n    fontColor: 'black',\n    idealAlign: hoverLabelIdealAlign,\n    hovertemplate: trace.hovertemplate,\n    hovertemplateLabels: labels,\n    eventData: [{\n      data: trace._input,\n      fullData: trace,\n      count: count,\n      category: catLabel,\n      probability: prob\n    }]\n  };\n}\n/**\n * Create hover label for a band element's category (for use when hoveron === 'category')\n *\n * @param {ClientRect} rootBBox\n *  Client bounding box for root of figure\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\n\n\nfunction createHoverLabelForDimensionHovermode(rootBBox, bandElement) {\n  var allHoverlabels = [];\n  d3.select(bandElement.parentNode.parentNode).selectAll('g.category').select('rect.catrect').each(function () {\n    var bandNode = this;\n    allHoverlabels.push(createHoverLabelForCategoryHovermode(rootBBox, bandNode));\n  });\n  return allHoverlabels;\n}\n/**\n * Create hover labels for a band element's category (for use when hoveron === 'dimension')\n *\n * @param {ClientRect} rootBBox\n *  Client bounding box for root of figure\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\n\n\nfunction createHoverLabelForColorHovermode(rootBBox, bandElement) {\n  var bandBoundingBox = bandElement.getBoundingClientRect(); // Models\n\n  /** @type {CategoryBandViewModel} */\n\n  var bandViewModel = d3.select(bandElement).datum();\n  var catViewModel = bandViewModel.categoryViewModel;\n  var parcatsViewModel = catViewModel.parcatsViewModel;\n  var dimensionModel = parcatsViewModel.model.dimensions[catViewModel.model.dimensionInd];\n  var trace = parcatsViewModel.trace; // positions\n\n  var hoverCenterY = bandBoundingBox.y + bandBoundingBox.height / 2;\n  var hoverCenterX, hoverLabelIdealAlign;\n\n  if (parcatsViewModel.dimensions.length > 1 && dimensionModel.displayInd === parcatsViewModel.dimensions.length - 1) {\n    // right most dimension\n    hoverCenterX = bandBoundingBox.left;\n    hoverLabelIdealAlign = 'left';\n  } else {\n    hoverCenterX = bandBoundingBox.left + bandBoundingBox.width;\n    hoverLabelIdealAlign = 'right';\n  } // Labels\n\n\n  var catLabel = catViewModel.model.categoryLabel; // Counts\n\n  var totalCount = bandViewModel.parcatsViewModel.model.count;\n  var bandColorCount = 0;\n  bandViewModel.categoryViewModel.bands.forEach(function (b) {\n    if (b.color === bandViewModel.color) {\n      bandColorCount += b.count;\n    }\n  });\n  var catCount = catViewModel.model.count;\n  var colorCount = 0;\n  parcatsViewModel.pathSelection.each(\n  /** @param {PathViewModel} pathViewModel */\n  function (pathViewModel) {\n    if (pathViewModel.model.color === bandViewModel.color) {\n      colorCount += pathViewModel.model.count;\n    }\n  });\n  var pColorAndCat = bandColorCount / totalCount;\n  var pCatGivenColor = bandColorCount / colorCount;\n  var pColorGivenCat = bandColorCount / catCount;\n  var labels = {\n    countLabel: totalCount,\n    categoryLabel: catLabel,\n    probabilityLabel: pColorAndCat.toFixed(3)\n  }; // Hover label text\n\n  var hoverinfoParts = [];\n\n  if (catViewModel.parcatsViewModel.hoverinfoItems.indexOf('count') !== -1) {\n    hoverinfoParts.push(['Count:', labels.countLabel].join(' '));\n  }\n\n  if (catViewModel.parcatsViewModel.hoverinfoItems.indexOf('probability') !== -1) {\n    hoverinfoParts.push('P(color âˆ© ' + catLabel + '): ' + labels.probabilityLabel);\n    hoverinfoParts.push('P(' + catLabel + ' | color): ' + pCatGivenColor.toFixed(3));\n    hoverinfoParts.push('P(color | ' + catLabel + '): ' + pColorGivenCat.toFixed(3));\n  }\n\n  var hovertext = hoverinfoParts.join('<br>'); // Compute text color\n\n  var textColor = tinycolor.mostReadable(bandViewModel.color, ['black', 'white']);\n  return {\n    trace: trace,\n    x: hoverCenterX - rootBBox.left,\n    y: hoverCenterY - rootBBox.top,\n    // name: 'NAME',\n    text: hovertext,\n    color: bandViewModel.color,\n    borderColor: 'black',\n    fontFamily: 'Monaco, \"Courier New\", monospace',\n    fontColor: textColor,\n    fontSize: 10,\n    idealAlign: hoverLabelIdealAlign,\n    hovertemplate: trace.hovertemplate,\n    hovertemplateLabels: labels,\n    eventData: [{\n      data: trace._input,\n      fullData: trace,\n      category: catLabel,\n      count: totalCount,\n      probability: pColorAndCat,\n      categorycount: catCount,\n      colorcount: colorCount,\n      bandcolorcount: bandColorCount\n    }]\n  };\n}\n/**\n * Handle dimension mouseover\n * @param {CategoryBandViewModel} bandViewModel\n */\n\n\nfunction mouseoverCategoryBand(bandViewModel) {\n  if (!bandViewModel.parcatsViewModel.dragDimension) {\n    // We're not currently dragging\n    if (bandViewModel.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n      // hoverinfo is not skip, so we at least style the bands and emit interaction events\n      // Mouse\n      var mouseY = d3.mouse(this)[1];\n\n      if (mouseY < -1) {\n        // Hover is above above the category rectangle (probably the dimension title text)\n        return;\n      }\n\n      var gd = bandViewModel.parcatsViewModel.graphDiv;\n      var fullLayout = gd._fullLayout;\n\n      var rootBBox = fullLayout._paperdiv.node().getBoundingClientRect();\n\n      var hoveron = bandViewModel.parcatsViewModel.hoveron;\n      /** @type {HTMLElement} */\n\n      var bandElement = this; // Handle style and events\n\n      if (hoveron === 'color') {\n        styleForColorHovermode(bandElement);\n        emitPointsEventColorHovermode(bandElement, 'plotly_hover', d3.event);\n      } else {\n        styleForCategoryHovermode(bandElement);\n        emitPointsEventCategoryHovermode(bandElement, 'plotly_hover', d3.event);\n      } // Handle hover label\n\n\n      if (bandViewModel.parcatsViewModel.hoverinfoItems.indexOf('none') === -1) {\n        var hoverItems;\n\n        if (hoveron === 'category') {\n          hoverItems = createHoverLabelForCategoryHovermode(rootBBox, bandElement);\n        } else if (hoveron === 'color') {\n          hoverItems = createHoverLabelForColorHovermode(rootBBox, bandElement);\n        } else if (hoveron === 'dimension') {\n          hoverItems = createHoverLabelForDimensionHovermode(rootBBox, bandElement);\n        }\n\n        if (hoverItems) {\n          Fx.loneHover(hoverItems, {\n            container: fullLayout._hoverlayer.node(),\n            outerContainer: fullLayout._paper.node(),\n            gd: gd\n          });\n        }\n      }\n    }\n  }\n}\n/**\n * Handle dimension mouseover\n * @param {CategoryBandViewModel} bandViewModel\n */\n\n\nfunction mouseoutCategory(bandViewModel) {\n  var parcatsViewModel = bandViewModel.parcatsViewModel;\n\n  if (!parcatsViewModel.dragDimension) {\n    // We're not dragging anything\n    // Reset unhovered styles\n    stylePathsNoHover(parcatsViewModel.pathSelection);\n    styleCategoriesNoHover(parcatsViewModel.dimensionSelection.selectAll('g.category'));\n    styleBandsNoHover(parcatsViewModel.dimensionSelection.selectAll('g.category').selectAll('rect.bandrect')); // Remove hover label\n\n    Fx.loneUnhover(parcatsViewModel.graphDiv._fullLayout._hoverlayer.node()); // Restore path order\n\n    parcatsViewModel.pathSelection.sort(compareRawColor); // Emit unhover event\n\n    if (parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n      var hoveron = bandViewModel.parcatsViewModel.hoveron;\n      var bandElement = this; // Handle style and events\n\n      if (hoveron === 'color') {\n        emitPointsEventColorHovermode(bandElement, 'plotly_unhover', d3.event);\n      } else {\n        emitPointsEventCategoryHovermode(bandElement, 'plotly_unhover', d3.event);\n      }\n    }\n  }\n}\n/**\n * Handle dimension drag start\n * @param {DimensionViewModel} d\n */\n\n\nfunction dragDimensionStart(d) {\n  // Check if dragging is supported\n  if (d.parcatsViewModel.arrangement === 'fixed') {\n    return;\n  } // Save off initial drag indexes for dimension\n\n\n  d.dragDimensionDisplayInd = d.model.displayInd;\n  d.initialDragDimensionDisplayInds = d.parcatsViewModel.model.dimensions.map(function (d) {\n    return d.displayInd;\n  });\n  d.dragHasMoved = false; // Check for category hit\n\n  d.dragCategoryDisplayInd = null;\n  d3.select(this).selectAll('g.category').select('rect.catrect').each(\n  /** @param {CategoryViewModel} catViewModel */\n  function (catViewModel) {\n    var catMouseX = d3.mouse(this)[0];\n    var catMouseY = d3.mouse(this)[1];\n\n    if (-2 <= catMouseX && catMouseX <= catViewModel.width + 2 && -2 <= catMouseY && catMouseY <= catViewModel.height + 2) {\n      // Save off initial drag indexes for categories\n      d.dragCategoryDisplayInd = catViewModel.model.displayInd;\n      d.initialDragCategoryDisplayInds = d.model.categories.map(function (c) {\n        return c.displayInd;\n      }); // Initialize categories dragY to be the current y position\n\n      catViewModel.model.dragY = catViewModel.y; // Raise category\n\n      Lib.raiseToTop(this.parentNode); // Get band element\n\n      d3.select(this.parentNode).selectAll('rect.bandrect')\n      /** @param {CategoryBandViewModel} bandViewModel */\n      .each(function (bandViewModel) {\n        if (bandViewModel.y < catMouseY && catMouseY <= bandViewModel.y + bandViewModel.height) {\n          d.potentialClickBand = this;\n        }\n      });\n    }\n  }); // Update toplevel drag dimension\n\n  d.parcatsViewModel.dragDimension = d; // Remove hover label if any\n\n  Fx.loneUnhover(d.parcatsViewModel.graphDiv._fullLayout._hoverlayer.node());\n}\n/**\n * Handle dimension drag\n * @param {DimensionViewModel} d\n */\n\n\nfunction dragDimension(d) {\n  // Check if dragging is supported\n  if (d.parcatsViewModel.arrangement === 'fixed') {\n    return;\n  }\n\n  d.dragHasMoved = true;\n\n  if (d.dragDimensionDisplayInd === null) {\n    return;\n  }\n\n  var dragDimInd = d.dragDimensionDisplayInd;\n  var prevDimInd = dragDimInd - 1;\n  var nextDimInd = dragDimInd + 1;\n  var dragDimension = d.parcatsViewModel.dimensions[dragDimInd]; // Update category\n\n  if (d.dragCategoryDisplayInd !== null) {\n    var dragCategory = dragDimension.categories[d.dragCategoryDisplayInd]; // Update dragY by dy\n\n    dragCategory.model.dragY += d3.event.dy;\n    var categoryY = dragCategory.model.dragY; // Check for category drag swaps\n\n    var catDisplayInd = dragCategory.model.displayInd;\n    var dimCategoryViews = dragDimension.categories;\n    var catAbove = dimCategoryViews[catDisplayInd - 1];\n    var catBelow = dimCategoryViews[catDisplayInd + 1]; // Check for overlap above\n\n    if (catAbove !== undefined) {\n      if (categoryY < catAbove.y + catAbove.height / 2.0) {\n        // Swap display inds\n        dragCategory.model.displayInd = catAbove.model.displayInd;\n        catAbove.model.displayInd = catDisplayInd;\n      }\n    }\n\n    if (catBelow !== undefined) {\n      if (categoryY + dragCategory.height > catBelow.y + catBelow.height / 2.0) {\n        // Swap display inds\n        dragCategory.model.displayInd = catBelow.model.displayInd;\n        catBelow.model.displayInd = catDisplayInd;\n      }\n    } // Update category drag display index\n\n\n    d.dragCategoryDisplayInd = dragCategory.model.displayInd;\n  } // Update dimension position\n\n\n  if (d.dragCategoryDisplayInd === null || d.parcatsViewModel.arrangement === 'freeform') {\n    dragDimension.model.dragX = d3.event.x; // Check for dimension swaps\n\n    var prevDimension = d.parcatsViewModel.dimensions[prevDimInd];\n    var nextDimension = d.parcatsViewModel.dimensions[nextDimInd];\n\n    if (prevDimension !== undefined) {\n      if (dragDimension.model.dragX < prevDimension.x + prevDimension.width) {\n        // Swap display inds\n        dragDimension.model.displayInd = prevDimension.model.displayInd;\n        prevDimension.model.displayInd = dragDimInd;\n      }\n    }\n\n    if (nextDimension !== undefined) {\n      if (dragDimension.model.dragX + dragDimension.width > nextDimension.x) {\n        // Swap display inds\n        dragDimension.model.displayInd = nextDimension.model.displayInd;\n        nextDimension.model.displayInd = d.dragDimensionDisplayInd;\n      }\n    } // Update drag display index\n\n\n    d.dragDimensionDisplayInd = dragDimension.model.displayInd;\n  } // Update view models\n\n\n  updateDimensionViewModels(d.parcatsViewModel);\n  updatePathViewModels(d.parcatsViewModel); // Update svg geometry\n\n  updateSvgCategories(d.parcatsViewModel);\n  updateSvgPaths(d.parcatsViewModel);\n}\n/**\n * Handle dimension drag end\n * @param {DimensionViewModel} d\n */\n\n\nfunction dragDimensionEnd(d) {\n  // Check if dragging is supported\n  if (d.parcatsViewModel.arrangement === 'fixed') {\n    return;\n  }\n\n  if (d.dragDimensionDisplayInd === null) {\n    return;\n  }\n\n  d3.select(this).selectAll('text').attr('font-weight', 'normal'); // Compute restyle command\n  // -----------------------\n\n  var restyleData = {};\n  var traceInd = getTraceIndex(d.parcatsViewModel); // ### Handle dimension reordering ###\n\n  var finalDragDimensionDisplayInds = d.parcatsViewModel.model.dimensions.map(function (d) {\n    return d.displayInd;\n  });\n  var anyDimsReordered = d.initialDragDimensionDisplayInds.some(function (initDimDisplay, dimInd) {\n    return initDimDisplay !== finalDragDimensionDisplayInds[dimInd];\n  });\n\n  if (anyDimsReordered) {\n    finalDragDimensionDisplayInds.forEach(function (finalDimDisplay, dimInd) {\n      var containerInd = d.parcatsViewModel.model.dimensions[dimInd].containerInd;\n      restyleData['dimensions[' + containerInd + '].displayindex'] = finalDimDisplay;\n    });\n  } // ### Handle category reordering ###\n\n\n  var anyCatsReordered = false;\n\n  if (d.dragCategoryDisplayInd !== null) {\n    var finalDragCategoryDisplayInds = d.model.categories.map(function (c) {\n      return c.displayInd;\n    });\n    anyCatsReordered = d.initialDragCategoryDisplayInds.some(function (initCatDisplay, catInd) {\n      return initCatDisplay !== finalDragCategoryDisplayInds[catInd];\n    });\n\n    if (anyCatsReordered) {\n      // Sort a shallow copy of the category models by display index\n      var sortedCategoryModels = d.model.categories.slice().sort(function (a, b) {\n        return a.displayInd - b.displayInd;\n      }); // Get new categoryarray and ticktext values\n\n      var newCategoryArray = sortedCategoryModels.map(function (v) {\n        return v.categoryValue;\n      });\n      var newCategoryLabels = sortedCategoryModels.map(function (v) {\n        return v.categoryLabel;\n      });\n      restyleData['dimensions[' + d.model.containerInd + '].categoryarray'] = [newCategoryArray];\n      restyleData['dimensions[' + d.model.containerInd + '].ticktext'] = [newCategoryLabels];\n      restyleData['dimensions[' + d.model.containerInd + '].categoryorder'] = 'array';\n    }\n  } // Handle potential click event\n  // ----------------------------\n\n\n  if (d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n    if (!d.dragHasMoved && d.potentialClickBand) {\n      if (d.parcatsViewModel.hoveron === 'color') {\n        emitPointsEventColorHovermode(d.potentialClickBand, 'plotly_click', d3.event.sourceEvent);\n      } else {\n        emitPointsEventCategoryHovermode(d.potentialClickBand, 'plotly_click', d3.event.sourceEvent);\n      }\n    }\n  } // Nullify drag states\n  // -------------------\n\n\n  d.model.dragX = null;\n\n  if (d.dragCategoryDisplayInd !== null) {\n    var dragCategory = d.parcatsViewModel.dimensions[d.dragDimensionDisplayInd].categories[d.dragCategoryDisplayInd];\n    dragCategory.model.dragY = null;\n    d.dragCategoryDisplayInd = null;\n  }\n\n  d.dragDimensionDisplayInd = null;\n  d.parcatsViewModel.dragDimension = null;\n  d.dragHasMoved = null;\n  d.potentialClickBand = null; // Update view models\n  // ------------------\n\n  updateDimensionViewModels(d.parcatsViewModel);\n  updatePathViewModels(d.parcatsViewModel); // Perform transition\n  // ------------------\n\n  var transition = d3.transition().duration(300).ease('cubic-in-out');\n  transition.each(function () {\n    updateSvgCategories(d.parcatsViewModel, true);\n    updateSvgPaths(d.parcatsViewModel, true);\n  }).each('end', function () {\n    if (anyDimsReordered || anyCatsReordered) {\n      // Perform restyle if the order of categories or dimensions changed\n      Plotly.restyle(d.parcatsViewModel.graphDiv, restyleData, [traceInd]);\n    }\n  });\n}\n/**\n *\n * @param {ParcatsViewModel} parcatsViewModel\n */\n\n\nfunction getTraceIndex(parcatsViewModel) {\n  var traceInd;\n  var allTraces = parcatsViewModel.graphDiv._fullData;\n\n  for (var i = 0; i < allTraces.length; i++) {\n    if (parcatsViewModel.key === allTraces[i].uid) {\n      traceInd = i;\n      break;\n    }\n  }\n\n  return traceInd;\n}\n/** Update the svg paths for view model\n * @param {ParcatsViewModel} parcatsViewModel\n * @param {boolean} hasTransition Whether to update element with transition\n */\n\n\nfunction updateSvgPaths(parcatsViewModel, hasTransition) {\n  if (hasTransition === undefined) {\n    hasTransition = false;\n  }\n\n  function transition(selection) {\n    return hasTransition ? selection.transition() : selection;\n  } // Update binding\n\n\n  parcatsViewModel.pathSelection.data(function (d) {\n    return d.paths;\n  }, key); // Update paths\n\n  transition(parcatsViewModel.pathSelection).attr('d', function (d) {\n    return d.svgD;\n  });\n}\n/** Update the svg paths for view model\n * @param {ParcatsViewModel} parcatsViewModel\n * @param {boolean} hasTransition Whether to update element with transition\n */\n\n\nfunction updateSvgCategories(parcatsViewModel, hasTransition) {\n  if (hasTransition === undefined) {\n    hasTransition = false;\n  }\n\n  function transition(selection) {\n    return hasTransition ? selection.transition() : selection;\n  } // Update binding\n\n\n  parcatsViewModel.dimensionSelection.data(function (d) {\n    return d.dimensions;\n  }, key);\n  var categorySelection = parcatsViewModel.dimensionSelection.selectAll('g.category').data(function (d) {\n    return d.categories;\n  }, key); // Update dimension position\n\n  transition(parcatsViewModel.dimensionSelection).attr('transform', function (d) {\n    return 'translate(' + d.x + ', 0)';\n  }); // Update category position\n\n  transition(categorySelection).attr('transform', function (d) {\n    return 'translate(0, ' + d.y + ')';\n  });\n  var dimLabelSelection = categorySelection.select('.dimlabel'); // ### Update dimension label\n  // Only the top-most display category should have the dimension label\n\n  dimLabelSelection.text(function (d, i) {\n    if (i === 0) {\n      // Add dimension label above topmost category\n      return d.parcatsViewModel.model.dimensions[d.model.dimensionInd].dimensionLabel;\n    } else {\n      return null;\n    }\n  }); // Update category label\n  // Categories in the right-most display dimension have their labels on\n  // the right, all others on the left\n\n  var catLabelSelection = categorySelection.select('.catlabel');\n  catLabelSelection.attr('text-anchor', function (d) {\n    if (catInRightDim(d)) {\n      // Place label to the right of category\n      return 'start';\n    } else {\n      // Place label to the left of category\n      return 'end';\n    }\n  }).attr('x', function (d) {\n    if (catInRightDim(d)) {\n      // Place label to the right of category\n      return d.width + 5;\n    } else {\n      // Place label to the left of category\n      return -5;\n    }\n  }).each(function (d) {\n    // Update attriubutes of <tspan> elements\n    var newX;\n    var newAnchor;\n\n    if (catInRightDim(d)) {\n      // Place label to the right of category\n      newX = d.width + 5;\n      newAnchor = 'start';\n    } else {\n      // Place label to the left of category\n      newX = -5;\n      newAnchor = 'end';\n    }\n\n    d3.select(this).selectAll('tspan').attr('x', newX).attr('text-anchor', newAnchor);\n  }); // Update bands\n  // Initialize color band rects\n\n  var bandSelection = categorySelection.selectAll('rect.bandrect').data(\n  /** @param {CategoryViewModel} catViewModel*/\n  function (catViewModel) {\n    return catViewModel.bands;\n  }, key);\n  var bandsSelectionEnter = bandSelection.enter().append('rect').attr('class', 'bandrect').attr('cursor', 'move').attr('stroke-opacity', 0).attr('fill', function (d) {\n    return d.color;\n  }).attr('fill-opacity', 0);\n  bandSelection.attr('fill', function (d) {\n    return d.color;\n  }).attr('width', function (d) {\n    return d.width;\n  }).attr('height', function (d) {\n    return d.height;\n  }).attr('y', function (d) {\n    return d.y;\n  });\n  styleBandsNoHover(bandsSelectionEnter); // Raise bands to the top\n\n  bandSelection.each(function () {\n    Lib.raiseToTop(this);\n  }); // Remove unused bands\n\n  bandSelection.exit().remove();\n}\n/**\n * Create a ParcatsViewModel traces\n * @param {Object} graphDiv\n *  Top-level graph div element\n * @param {Layout} layout\n *  SVG layout object\n * @param {Array.<ParcatsModel>} wrappedParcatsModel\n *  Wrapped ParcatsModel for this trace\n * @return {ParcatsViewModel}\n */\n\n\nfunction createParcatsViewModel(graphDiv, layout, wrappedParcatsModel) {\n  // Unwrap model\n  var parcatsModel = wrappedParcatsModel[0]; // Compute margin\n\n  var margin = layout.margin || {\n    l: 80,\n    r: 80,\n    t: 100,\n    b: 80\n  }; // Compute pixel position/extents\n\n  var trace = parcatsModel.trace;\n  var domain = trace.domain;\n  var figureWidth = layout.width;\n  var figureHeight = layout.height;\n  var traceWidth = Math.floor(figureWidth * (domain.x[1] - domain.x[0]));\n  var traceHeight = Math.floor(figureHeight * (domain.y[1] - domain.y[0]));\n  var traceX = domain.x[0] * figureWidth + margin.l;\n  var traceY = layout.height - domain.y[1] * layout.height + margin.t; // Handle path shape\n  // -----------------\n\n  var pathShape = trace.line.shape; // Handle hover info\n  // -----------------\n\n  var hoverinfoItems;\n\n  if (trace.hoverinfo === 'all') {\n    hoverinfoItems = ['count', 'probability'];\n  } else {\n    hoverinfoItems = (trace.hoverinfo || '').split('+');\n  } // Construct parcatsViewModel\n  // --------------------------\n\n\n  var parcatsViewModel = {\n    trace: trace,\n    key: trace.uid,\n    model: parcatsModel,\n    x: traceX,\n    y: traceY,\n    width: traceWidth,\n    height: traceHeight,\n    hoveron: trace.hoveron,\n    hoverinfoItems: hoverinfoItems,\n    arrangement: trace.arrangement,\n    bundlecolors: trace.bundlecolors,\n    sortpaths: trace.sortpaths,\n    labelfont: trace.labelfont,\n    categorylabelfont: trace.tickfont,\n    pathShape: pathShape,\n    dragDimension: null,\n    margin: margin,\n    paths: [],\n    dimensions: [],\n    graphDiv: graphDiv,\n    traceSelection: null,\n    pathSelection: null,\n    dimensionSelection: null\n  }; // Update dimension view models if we have at least 1 dimension\n\n  if (parcatsModel.dimensions) {\n    updateDimensionViewModels(parcatsViewModel); // Update path view models if we have at least 2 dimensions\n\n    updatePathViewModels(parcatsViewModel);\n  } // Inside a categories view model\n\n\n  return parcatsViewModel;\n}\n/**\n * Build the SVG string to represents a parallel categories path\n * @param {Array.<Number>} leftXPositions\n *  Array of the x positions of the left edge of each dimension (in display order)\n * @param {Array.<Number>} pathYs\n *  Array of the y positions of the top of the path at each dimension (in display order)\n * @param {Array.<Number>} dimWidths\n *  Array of the widths of each dimension in display order\n * @param {Number} pathHeight\n *  The height of the path in pixels\n * @param {Number} curvature\n *  The curvature factor for the path. 0 results in a straight line and values greater than zero result in curved paths\n * @return {string}\n */\n\n\nfunction buildSvgPath(leftXPositions, pathYs, dimWidths, pathHeight, curvature) {\n  // Compute the x midpoint of each path segment\n  var xRefPoints1 = [];\n  var xRefPoints2 = [];\n  var refInterpolator;\n  var d;\n\n  for (d = 0; d < dimWidths.length - 1; d++) {\n    refInterpolator = d3.interpolateNumber(dimWidths[d] + leftXPositions[d], leftXPositions[d + 1]);\n    xRefPoints1.push(refInterpolator(curvature));\n    xRefPoints2.push(refInterpolator(1 - curvature));\n  } // Move to top of path on left edge of left-most category\n\n\n  var svgD = 'M ' + leftXPositions[0] + ',' + pathYs[0]; // Horizontal line to right edge\n\n  svgD += 'l' + dimWidths[0] + ',0 '; // Horizontal line to right edge\n\n  for (d = 1; d < dimWidths.length; d++) {\n    // Curve to left edge of category\n    svgD += 'C' + xRefPoints1[d - 1] + ',' + pathYs[d - 1] + ' ' + xRefPoints2[d - 1] + ',' + pathYs[d] + ' ' + leftXPositions[d] + ',' + pathYs[d]; // svgD += 'L' + leftXPositions[d] + ',' + pathYs[d];\n    // Horizontal line to right edge\n\n    svgD += 'l' + dimWidths[d] + ',0 ';\n  } // Line down\n\n\n  svgD += 'l' + '0,' + pathHeight + ' '; // Line to left edge of right-most category\n\n  svgD += 'l -' + dimWidths[dimWidths.length - 1] + ',0 ';\n\n  for (d = dimWidths.length - 2; d >= 0; d--) {\n    // Curve to right edge of category\n    svgD += 'C' + xRefPoints2[d] + ',' + (pathYs[d + 1] + pathHeight) + ' ' + xRefPoints1[d] + ',' + (pathYs[d] + pathHeight) + ' ' + (leftXPositions[d] + dimWidths[d]) + ',' + (pathYs[d] + pathHeight); // svgD += 'L' + (leftXPositions[d] + dimWidths[d]) + ',' + (pathYs[d] + pathHeight);\n    // Horizontal line to right edge\n\n    svgD += 'l-' + dimWidths[d] + ',0 ';\n  } // Close path\n\n\n  svgD += 'Z';\n  return svgD;\n}\n/**\n * Update the path view models based on the dimension view models in a ParcatsViewModel\n *\n * @param {ParcatsViewModel} parcatsViewModel\n *  View model for trace\n */\n\n\nfunction updatePathViewModels(parcatsViewModel) {\n  // Initialize an array of the y position of the top of the next path to be added to each category.\n  //\n  // nextYPositions[d][c] is the y position of the next path through category with index c of dimension with index d\n  var dimensionViewModels = parcatsViewModel.dimensions;\n  var parcatsModel = parcatsViewModel.model;\n  var nextYPositions = dimensionViewModels.map(function (d) {\n    return d.categories.map(function (c) {\n      return c.y;\n    });\n  }); // Array from category index to category display index for each true dimension index\n\n  var catToDisplayIndPerDim = parcatsViewModel.model.dimensions.map(function (d) {\n    return d.categories.map(function (c) {\n      return c.displayInd;\n    });\n  }); // Array from true dimension index to dimension display index\n\n  var dimToDisplayInd = parcatsViewModel.model.dimensions.map(function (d) {\n    return d.displayInd;\n  });\n  var displayToDimInd = parcatsViewModel.dimensions.map(function (d) {\n    return d.model.dimensionInd;\n  }); // Array of the x position of the left edge of the rectangles for each dimension\n\n  var leftXPositions = dimensionViewModels.map(function (d) {\n    return d.x;\n  }); // Compute dimension widths\n\n  var dimWidths = dimensionViewModels.map(function (d) {\n    return d.width;\n  }); // Build sorted Array of PathModel objects\n\n  var pathModels = [];\n\n  for (var p in parcatsModel.paths) {\n    if (parcatsModel.paths.hasOwnProperty(p)) {\n      pathModels.push(parcatsModel.paths[p]);\n    }\n  } // Compute category display inds to use for sorting paths\n\n\n  function pathDisplayCategoryInds(pathModel) {\n    var dimensionInds = pathModel.categoryInds.map(function (catInd, dimInd) {\n      return catToDisplayIndPerDim[dimInd][catInd];\n    });\n    var displayInds = displayToDimInd.map(function (dimInd) {\n      return dimensionInds[dimInd];\n    });\n    return displayInds;\n  } // Sort in ascending order by display index array\n\n\n  pathModels.sort(function (v1, v2) {\n    // Build display inds for each path\n    var sortArray1 = pathDisplayCategoryInds(v1);\n    var sortArray2 = pathDisplayCategoryInds(v2); // Handle path sort order\n\n    if (parcatsViewModel.sortpaths === 'backward') {\n      sortArray1.reverse();\n      sortArray2.reverse();\n    } // Append the first value index of the path to break ties\n\n\n    sortArray1.push(v1.valueInds[0]);\n    sortArray2.push(v2.valueInds[0]); // Handle color bundling\n\n    if (parcatsViewModel.bundlecolors) {\n      // Prepend sort array with the raw color value\n      sortArray1.unshift(v1.rawColor);\n      sortArray2.unshift(v2.rawColor);\n    } // colors equal, sort by display categories\n\n\n    if (sortArray1 < sortArray2) {\n      return -1;\n    }\n\n    if (sortArray1 > sortArray2) {\n      return 1;\n    }\n\n    return 0;\n  }); // Create path models\n\n  var pathViewModels = new Array(pathModels.length);\n  var totalCount = dimensionViewModels[0].model.count;\n  var totalHeight = dimensionViewModels[0].categories.map(function (c) {\n    return c.height;\n  }).reduce(function (v1, v2) {\n    return v1 + v2;\n  });\n\n  for (var pathNumber = 0; pathNumber < pathModels.length; pathNumber++) {\n    var pathModel = pathModels[pathNumber];\n    var pathHeight;\n\n    if (totalCount > 0) {\n      pathHeight = totalHeight * (pathModel.count / totalCount);\n    } else {\n      pathHeight = 0;\n    } // Build path y coords\n\n\n    var pathYs = new Array(nextYPositions.length);\n\n    for (var d = 0; d < pathModel.categoryInds.length; d++) {\n      var catInd = pathModel.categoryInds[d];\n      var catDisplayInd = catToDisplayIndPerDim[d][catInd];\n      var dimDisplayInd = dimToDisplayInd[d]; // Update next y position\n\n      pathYs[dimDisplayInd] = nextYPositions[dimDisplayInd][catDisplayInd];\n      nextYPositions[dimDisplayInd][catDisplayInd] += pathHeight; // Update category color information\n\n      var catViewModle = parcatsViewModel.dimensions[dimDisplayInd].categories[catDisplayInd];\n      var numBands = catViewModle.bands.length;\n      var lastCatBand = catViewModle.bands[numBands - 1];\n\n      if (lastCatBand === undefined || pathModel.rawColor !== lastCatBand.rawColor) {\n        // Create a new band\n        var bandY = lastCatBand === undefined ? 0 : lastCatBand.y + lastCatBand.height;\n        catViewModle.bands.push({\n          key: bandY,\n          color: pathModel.color,\n          rawColor: pathModel.rawColor,\n          height: pathHeight,\n          width: catViewModle.width,\n          count: pathModel.count,\n          y: bandY,\n          categoryViewModel: catViewModle,\n          parcatsViewModel: parcatsViewModel\n        });\n      } else {\n        // Extend current band\n        var currentBand = catViewModle.bands[numBands - 1];\n        currentBand.height += pathHeight;\n        currentBand.count += pathModel.count;\n      }\n    } // build svg path\n\n\n    var svgD;\n\n    if (parcatsViewModel.pathShape === 'hspline') {\n      svgD = buildSvgPath(leftXPositions, pathYs, dimWidths, pathHeight, 0.5);\n    } else {\n      svgD = buildSvgPath(leftXPositions, pathYs, dimWidths, pathHeight, 0);\n    }\n\n    pathViewModels[pathNumber] = {\n      key: pathModel.valueInds[0],\n      model: pathModel,\n      height: pathHeight,\n      leftXs: leftXPositions,\n      topYs: pathYs,\n      dimWidths: dimWidths,\n      svgD: svgD,\n      parcatsViewModel: parcatsViewModel\n    };\n  }\n\n  parcatsViewModel.paths = pathViewModels; // * @property key\n  // *  Unique key for this model\n  // * @property {PathModel} model\n  // *  Source path model\n  // * @property {Number} height\n  // *  Height of this path (pixels)\n  // * @property {String} svgD\n  // *  SVG path \"d\" attribute string\n}\n/**\n * Update the dimension view models based on the dimension models in a ParcatsViewModel\n *\n * @param {ParcatsViewModel} parcatsViewModel\n *  View model for trace\n */\n\n\nfunction updateDimensionViewModels(parcatsViewModel) {\n  // Compute dimension ordering\n  var dimensionsIndInfo = parcatsViewModel.model.dimensions.map(function (d) {\n    return {\n      displayInd: d.displayInd,\n      dimensionInd: d.dimensionInd\n    };\n  });\n  dimensionsIndInfo.sort(function (a, b) {\n    return a.displayInd - b.displayInd;\n  });\n  var dimensions = [];\n\n  for (var displayInd in dimensionsIndInfo) {\n    var dimensionInd = dimensionsIndInfo[displayInd].dimensionInd;\n    var dimModel = parcatsViewModel.model.dimensions[dimensionInd];\n    dimensions.push(createDimensionViewModel(parcatsViewModel, dimModel));\n  }\n\n  parcatsViewModel.dimensions = dimensions;\n}\n/**\n * Create a parcats DimensionViewModel\n *\n * @param {ParcatsViewModel} parcatsViewModel\n *  View model for trace\n * @param {DimensionModel} dimensionModel\n * @return {DimensionViewModel}\n */\n\n\nfunction createDimensionViewModel(parcatsViewModel, dimensionModel) {\n  // Compute dimension x position\n  var categoryLabelPad = 40;\n  var dimWidth = 16;\n  var numDimensions = parcatsViewModel.model.dimensions.length;\n  var displayInd = dimensionModel.displayInd; // Compute x coordinate values\n\n  var dimDx;\n  var dimX0;\n  var dimX;\n\n  if (numDimensions > 1) {\n    dimDx = (parcatsViewModel.width - 2 * categoryLabelPad - dimWidth) / (numDimensions - 1);\n  } else {\n    dimDx = 0;\n  }\n\n  dimX0 = categoryLabelPad;\n  dimX = dimX0 + dimDx * displayInd; // Compute categories\n\n  var categories = [];\n  var maxCats = parcatsViewModel.model.maxCats;\n  var numCats = dimensionModel.categories.length;\n  var catSpacing = 8;\n  var totalCount = dimensionModel.count;\n  var totalHeight = parcatsViewModel.height - catSpacing * (maxCats - 1);\n  var nextCatHeight;\n  var nextCatModel;\n  var nextCat;\n  var catInd;\n  var catDisplayInd; // Compute starting Y offset\n\n  var nextCatY = (maxCats - numCats) * catSpacing / 2.0; // Compute category ordering\n\n  var categoryIndInfo = dimensionModel.categories.map(function (c) {\n    return {\n      displayInd: c.displayInd,\n      categoryInd: c.categoryInd\n    };\n  });\n  categoryIndInfo.sort(function (a, b) {\n    return a.displayInd - b.displayInd;\n  });\n\n  for (catDisplayInd = 0; catDisplayInd < numCats; catDisplayInd++) {\n    catInd = categoryIndInfo[catDisplayInd].categoryInd;\n    nextCatModel = dimensionModel.categories[catInd];\n\n    if (totalCount > 0) {\n      nextCatHeight = nextCatModel.count / totalCount * totalHeight;\n    } else {\n      nextCatHeight = 0;\n    }\n\n    nextCat = {\n      key: nextCatModel.valueInds[0],\n      model: nextCatModel,\n      width: dimWidth,\n      height: nextCatHeight,\n      y: nextCatModel.dragY !== null ? nextCatModel.dragY : nextCatY,\n      bands: [],\n      parcatsViewModel: parcatsViewModel\n    };\n    nextCatY = nextCatY + nextCatHeight + catSpacing;\n    categories.push(nextCat);\n  }\n\n  return {\n    key: dimensionModel.dimensionInd,\n    x: dimensionModel.dragX !== null ? dimensionModel.dragX : dimX,\n    y: 0,\n    width: dimWidth,\n    model: dimensionModel,\n    categories: categories,\n    parcatsViewModel: parcatsViewModel,\n    dragCategoryDisplayInd: null,\n    dragDimensionDisplayInd: null,\n    initialDragDimensionDisplayInds: null,\n    initialDragCategoryDisplayInds: null,\n    dragHasMoved: null,\n    potentialClickBand: null\n  };\n} // JSDoc typedefs\n// ==============\n\n/**\n * @typedef {Object} Layout\n *  Object containing svg layout information\n *\n * @property {Number} width (pixels)\n *  Usable width for Figure (after margins are removed)\n * @property {Number} height (pixels)\n *  Usable height for Figure (after margins are removed)\n * @property {Margin} margin\n *  Margin around the Figure (pixels)\n */\n\n/**\n * @typedef {Object} Margin\n *  Object containing padding information in pixels\n *\n * @property {Number} t\n *  Top margin\n * @property {Number} r\n *  Right margin\n * @property {Number} b\n *  Bottom margin\n * @property {Number} l\n *  Left margin\n */\n\n/**\n * @typedef {Object} Font\n *  Object containing font information\n *\n * @property {Number} size: Font size\n * @property {String} color: Font color\n * @property {String} family: Font family\n */\n\n/**\n * @typedef {Object} ParcatsViewModel\n *  Object containing calculated parcats view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {ParcatsModel} model\n *  Source parcats model\n * @property {Array.<DimensionViewModel>} dimensions\n *  Array of dimension view models\n * @property {Number} width\n *  Width for this trace (pixels)\n * @property {Number} height\n *  Height for this trace (pixels)\n * @property {Number} x\n *  X position of this trace with respect to the Figure (pixels)\n * @property {Number} y\n *  Y position of this trace with respect to the Figure (pixels)\n * @property {String} hoveron\n *  Hover interaction mode. One of: 'category', 'color', or 'dimension'\n * @property {Array.<String>} hoverinfoItems\n *  Info to display on hover. Array with a combination of 'counts' and/or 'probabilities', or 'none', or 'skip'\n * @property {String} arrangement\n *  Category arrangement. One of: 'perpendicular', 'freeform', or 'fixed'\n * @property {Boolean} bundlecolors\n *  Whether paths should be sorted so that like colors are bundled together as they pass through categories\n * @property {String} sortpaths\n *  If 'forward' then sort paths based on dimensions from left to right. If 'backward' sort based on dimensions\n *  from right to left\n * @property {Font} labelfont\n *  Font for the dimension labels\n * @property {Font} categorylabelfont\n *  Font for the category labels\n * @property {String} pathShape\n *  The shape of the paths. Either 'linear' or 'hspline'.\n * @property {DimensionViewModel|null} dragDimension\n *  Dimension currently being dragged. Null if no drag in progress\n * @property {Margin} margin\n *  Margin around the Figure\n * @property {Object} graphDiv\n *  Top-level graph div element\n * @property {Object} traceSelection\n *  D3 selection of this view models trace group element\n * @property {Object} pathSelection\n *  D3 selection of this view models path elements\n * @property {Object} dimensionSelection\n *  D3 selection of this view models dimension group element\n */\n\n/**\n * @typedef {Object} DimensionViewModel\n *  Object containing calculated parcats dimension view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {DimensionModel} model\n *  Source dimension model\n * @property {Number} x\n *  X position of the center of this dimension with respect to the Figure (pixels)\n * @property {Number} y\n *  Y position of the top of this dimension with respect to the Figure (pixels)\n * @property {Number} width\n *  Width of categories in this dimension (pixels)\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n * @property {Array.<CategoryViewModel>} categories\n *  Dimensions category view models\n * @property {Number|null} dragCategoryDisplayInd\n *  Display index of category currently being dragged. null if no category is being dragged\n * @property {Number|null} dragDimensionDisplayInd\n *  Display index of the dimension being dragged. null if no dimension is being dragged\n * @property {Array.<Number>|null} initialDragDimensionDisplayInds\n *  Dimensions display indexes at the beginning of the current drag. null if no dimension is being dragged\n * @property {Array.<Number>|null} initialDragCategoryDisplayInds\n *  Category display indexes for the at the beginning of the current drag. null if no category is being dragged\n * @property {HTMLElement} potentialClickBand\n *  Band under mouse when current drag began. If no drag movement takes place then a click will be emitted for this\n *  band. Null if not drag in progress.\n * @property {Boolean} dragHasMoved\n *  True if there is an active drag and the drag has moved. If drag doesn't move before being ended then\n *  this may be interpreted as a click. Null if no drag in progress\n */\n\n/**\n * @typedef {Object} CategoryViewModel\n *  Object containing calculated parcats category view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {CategoryModel} model\n *  Source category model\n * @property {Number} width\n *  Width for this category (pixels)\n * @property {Number} height\n *  Height for this category (pixels)\n * @property {Number} y\n *  Y position of this cateogry with respect to the Figure (pixels)\n * @property {Array.<CategoryBandViewModel>} bands\n *  Array of color bands inside the category\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n */\n\n/**\n * @typedef {Object} CategoryBandViewModel\n *  Object containing calculated category band information. A category band is a region inside a category covering\n *  paths of a single color\n *\n * @property key\n *  Unique key for this model\n * @property color\n *  Band color\n * @property rawColor\n *  Raw color value for band\n * @property {Number} width\n *  Band width\n * @property {Number} height\n *  Band height\n * @property {Number} y\n *  Y position of top of the band with respect to the category\n * @property {Number} count\n *  The number of samples represented by the band\n * @property {CategoryViewModel} categoryViewModel\n *  The parent categorie's view model\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n */\n\n/**\n * @typedef {Object} PathViewModel\n *  Object containing calculated parcats path view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {PathModel} model\n *  Source path model\n * @property {Number} height\n *  Height of this path (pixels)\n * @property {Array.<Number>} leftXs\n *  The x position of the left edge of each display dimension\n * @property {Array.<Number>} topYs\n *  The y position of the top of the path for each display dimension\n * @property {Array.<Number>} dimWidths\n *  The width of each display dimension\n * @property {String} svgD\n *  SVG path \"d\" attribute string\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n */","map":{"version":3,"sources":["/Users/jingkaisu/Documents/HRfront/HalliganReviews/web_project/node_modules/plotly.js/src/traces/parcats/parcats.js"],"names":["d3","require","Plotly","Fx","Lib","Drawing","tinycolor","svgTextUtils","performPlot","parcatsModels","graphDiv","layout","svg","viewModels","map","createParcatsViewModel","bind","layerSelection","selectAll","data","enter","append","attr","style","traceSelection","key","traceEnter","d","x","y","pathsSelection","select","pathSelection","paths","model","color","pathSelectionEnter","stylePathsNoHover","svgD","empty","sort","compareRawColor","exit","remove","on","mouseoverPath","mouseoutPath","clickPath","dimensionsSelection","dimensionSelection","dimensions","categorySelection","categories","categoryGroupEnterSelection","width","height","styleCategoriesNoHover","bandSelection","catViewModel","bands","each","raiseToTop","bandsSelectionEnter","bandModel","parcatsViewModel","arrangement","styleBandsNoHover","paperColor","_fullLayout","paper_bgcolor","catInRightDim","text","categoryLabel","catModel","font","categorylabelfont","convertToTspans","i","dimensionInd","dimensionLabel","labelfont","mouseoverCategoryBand","mouseoutCategory","call","behavior","drag","origin","dragDimensionStart","dragDimension","dragDimensionEnd","module","exports","numDims","length","leftDimInd","a","b","rawColor","hoverinfoItems","indexOf","stylePathsHover","points","buildPointsArrayForPath","constraints","buildConstraintsForPath","emit","event","hoverX","mouse","gd","trace","fullLayout","rootBBox","_paperdiv","node","getBoundingClientRect","graphDivBBox","pathCenterX","pathCenterY","dimInd","leftXs","dimWidths","leftDim","rightDim","topYs","hoverCenterX","hoverCenterY","textColor","mostReadable","count","prob","labels","countLabel","probabilityLabel","toFixed","hovertextParts","push","join","hovertext","mouseX","loneHover","left","top","borderColor","fontFamily","fontSize","fontColor","idealAlign","hovertemplate","line","hovertemplateLabels","eventData","_input","fullData","probability","container","_hoverlayer","outerContainer","_paper","loneUnhover","curveNumber","getTraceIndex","valueInds","pointNumber","dimension","category","categoryInds","containerInd","categoryValue","undefined","styleCategoryHover","styleBandsHover","bandsSelection","selectPathsThroughCategoryBandColor","catBandViewModel","allPaths","categoryViewModel","catInd","categoryInd","filter","pathViewModel","styleForCategoryHovermode","bandElement","bandSel","parentNode","bvm","styleForColorHovermode","bandViewModel","datum","catPaths","emitPointsEventCategoryHovermode","eventName","categoryModel","Array","prototype","apply","emitPointsEventColorHovermode","createHoverLabelForCategoryHovermode","rectSelection","rectBoundingBox","dimensionModel","hoverLabelIdealAlign","displayInd","catLabel","hoverinfoParts","createHoverLabelForDimensionHovermode","allHoverlabels","bandNode","createHoverLabelForColorHovermode","bandBoundingBox","totalCount","bandColorCount","forEach","catCount","colorCount","pColorAndCat","pCatGivenColor","pColorGivenCat","categorycount","colorcount","bandcolorcount","mouseY","hoveron","hoverItems","dragDimensionDisplayInd","initialDragDimensionDisplayInds","dragHasMoved","dragCategoryDisplayInd","catMouseX","catMouseY","initialDragCategoryDisplayInds","c","dragY","potentialClickBand","dragDimInd","prevDimInd","nextDimInd","dragCategory","dy","categoryY","catDisplayInd","dimCategoryViews","catAbove","catBelow","dragX","prevDimension","nextDimension","updateDimensionViewModels","updatePathViewModels","updateSvgCategories","updateSvgPaths","restyleData","traceInd","finalDragDimensionDisplayInds","anyDimsReordered","some","initDimDisplay","finalDimDisplay","anyCatsReordered","finalDragCategoryDisplayInds","initCatDisplay","sortedCategoryModels","slice","newCategoryArray","v","newCategoryLabels","sourceEvent","transition","duration","ease","restyle","allTraces","_fullData","uid","hasTransition","selection","dimLabelSelection","catLabelSelection","newX","newAnchor","wrappedParcatsModel","parcatsModel","margin","l","r","t","domain","figureWidth","figureHeight","traceWidth","Math","floor","traceHeight","traceX","traceY","pathShape","shape","hoverinfo","split","bundlecolors","sortpaths","tickfont","buildSvgPath","leftXPositions","pathYs","pathHeight","curvature","xRefPoints1","xRefPoints2","refInterpolator","interpolateNumber","dimensionViewModels","nextYPositions","catToDisplayIndPerDim","dimToDisplayInd","displayToDimInd","pathModels","p","hasOwnProperty","pathDisplayCategoryInds","pathModel","dimensionInds","displayInds","v1","v2","sortArray1","sortArray2","reverse","unshift","pathViewModels","totalHeight","reduce","pathNumber","dimDisplayInd","catViewModle","numBands","lastCatBand","bandY","currentBand","dimensionsIndInfo","dimModel","createDimensionViewModel","categoryLabelPad","dimWidth","numDimensions","dimDx","dimX0","dimX","maxCats","numCats","catSpacing","nextCatHeight","nextCatModel","nextCat","nextCatY","categoryIndInfo"],"mappings":"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","sourcesContent":["/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar Plotly = require('../../plot_api/plot_api');\nvar Fx = require('../../components/fx');\nvar Lib = require('../../lib');\nvar Drawing = require('../../components/drawing');\nvar tinycolor = require('tinycolor2');\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nfunction performPlot(parcatsModels, graphDiv, layout, svg) {\n    var viewModels = parcatsModels.map(createParcatsViewModel.bind(0, graphDiv, layout));\n\n    // Get (potentially empty) parcatslayer selection with bound data to single element array\n    var layerSelection = svg.selectAll('g.parcatslayer').data([null]);\n\n    // Initialize single parcatslayer group if it doesn't exist\n    layerSelection.enter()\n        .append('g')\n        .attr('class', 'parcatslayer')\n        .style('pointer-events', 'all');\n\n    // Bind data to children of layerSelection and get reference to traceSelection\n    var traceSelection = layerSelection\n        .selectAll('g.trace.parcats')\n        .data(viewModels, key);\n\n    // Initialize group for each trace/dimensions\n    var traceEnter = traceSelection.enter()\n        .append('g')\n        .attr('class', 'trace parcats');\n\n    // Update properties for each trace\n    traceSelection\n        .attr('transform', function(d) {\n            return 'translate(' + d.x + ', ' + d.y + ')';\n        });\n\n    // Initialize paths group\n    traceEnter\n        .append('g')\n        .attr('class', 'paths');\n\n    // Update paths transform\n    var pathsSelection = traceSelection\n        .select('g.paths');\n\n    // Get paths selection\n    var pathSelection = pathsSelection\n        .selectAll('path.path')\n        .data(function(d) {\n            return d.paths;\n        }, key);\n\n    // Update existing path colors\n    pathSelection\n        .attr('fill', function(d) {\n            return d.model.color;\n        });\n\n    // Create paths\n    var pathSelectionEnter = pathSelection\n        .enter()\n        .append('path')\n        .attr('class', 'path')\n        .attr('stroke-opacity', 0)\n        .attr('fill', function(d) {\n            return d.model.color;\n        })\n        .attr('fill-opacity', 0);\n\n    stylePathsNoHover(pathSelectionEnter);\n\n    // Set path geometry\n    pathSelection\n        .attr('d', function(d) {\n            return d.svgD;\n        });\n\n    // sort paths\n    if(!pathSelectionEnter.empty()) {\n        // Only sort paths if there has been a change.\n        // Otherwise paths are already sorted or a hover operation may be in progress\n        pathSelection.sort(compareRawColor);\n    }\n\n    // Remove any old paths\n    pathSelection.exit().remove();\n\n    // Path hover\n    pathSelection\n        .on('mouseover', mouseoverPath)\n        .on('mouseout', mouseoutPath)\n        .on('click', clickPath);\n\n    // Initialize dimensions group\n    traceEnter.append('g').attr('class', 'dimensions');\n\n    // Update dimensions transform\n    var dimensionsSelection = traceSelection\n        .select('g.dimensions');\n\n    // Get dimension selection\n    var dimensionSelection = dimensionsSelection\n        .selectAll('g.dimension')\n        .data(function(d) {\n            return d.dimensions;\n        }, key);\n\n    // Create dimension groups\n    dimensionSelection.enter()\n        .append('g')\n        .attr('class', 'dimension');\n\n    // Update dimension group transforms\n    dimensionSelection.attr('transform', function(d) {\n        return 'translate(' + d.x + ', 0)';\n    });\n\n    // Remove any old dimensions\n    dimensionSelection.exit().remove();\n\n    // Get category selection\n    var categorySelection = dimensionSelection\n        .selectAll('g.category')\n        .data(function(d) {\n            return d.categories;\n        }, key);\n\n    // Initialize category groups\n    var categoryGroupEnterSelection = categorySelection\n        .enter()\n        .append('g')\n        .attr('class', 'category');\n\n    // Update category transforms\n    categorySelection\n        .attr('transform', function(d) {\n            return 'translate(0, ' + d.y + ')';\n        });\n\n\n    // Initialize rectangle\n    categoryGroupEnterSelection\n        .append('rect')\n        .attr('class', 'catrect')\n        .attr('pointer-events', 'none');\n\n\n    // Update rectangle\n    categorySelection.select('rect.catrect')\n        .attr('fill', 'none')\n        .attr('width', function(d) {\n            return d.width;\n        })\n        .attr('height', function(d) {\n            return d.height;\n        });\n\n    styleCategoriesNoHover(categoryGroupEnterSelection);\n\n    // Initialize color band rects\n    var bandSelection = categorySelection\n        .selectAll('rect.bandrect')\n        .data(\n            /** @param {CategoryViewModel} catViewModel*/\n            function(catViewModel) {\n                return catViewModel.bands;\n            }, key);\n\n    // Raise all update bands to the top so that fading enter/exit bands will be behind\n    bandSelection.each(function() {Lib.raiseToTop(this);});\n\n    // Update band color\n    bandSelection\n        .attr('fill', function(d) {\n            return d.color;\n        });\n\n    var bandsSelectionEnter = bandSelection.enter()\n        .append('rect')\n        .attr('class', 'bandrect')\n        .attr('stroke-opacity', 0)\n        .attr('fill', function(d) {\n            return d.color;\n        })\n        .attr('fill-opacity', 0);\n\n    bandSelection\n        .attr('fill', function(d) {\n            return d.color;\n        })\n        .attr('width', function(d) {\n            return d.width;\n        })\n        .attr('height', function(d) {\n            return d.height;\n        })\n        .attr('y', function(d) {\n            return d.y;\n        })\n        .attr('cursor',\n            /** @param {CategoryBandViewModel} bandModel*/\n            function(bandModel) {\n                if(bandModel.parcatsViewModel.arrangement === 'fixed') {\n                    return 'default';\n                } else if(bandModel.parcatsViewModel.arrangement === 'perpendicular') {\n                    return 'ns-resize';\n                } else {\n                    return 'move';\n                }\n            });\n\n    styleBandsNoHover(bandsSelectionEnter);\n\n    bandSelection.exit().remove();\n\n    // Initialize category label\n    categoryGroupEnterSelection\n        .append('text')\n        .attr('class', 'catlabel')\n        .attr('pointer-events', 'none');\n\n    var paperColor = graphDiv._fullLayout.paper_bgcolor;\n\n    // Update category label\n    categorySelection.select('text.catlabel')\n        .attr('text-anchor',\n            function(d) {\n                if(catInRightDim(d)) {\n                    // Place label to the right of category\n                    return 'start';\n                } else {\n                    // Place label to the left of category\n                    return 'end';\n                }\n            })\n        .attr('alignment-baseline', 'middle')\n\n        .style('text-shadow',\n            paperColor + ' -1px  1px 2px, ' +\n            paperColor + ' 1px  1px 2px, ' +\n            paperColor + '  1px -1px 2px, ' +\n            paperColor + ' -1px -1px 2px')\n        .style('fill', 'rgb(0, 0, 0)')\n        .attr('x',\n            function(d) {\n                if(catInRightDim(d)) {\n                    // Place label to the right of category\n                    return d.width + 5;\n                } else {\n                    // Place label to the left of category\n                    return -5;\n                }\n            })\n        .attr('y', function(d) {\n            return d.height / 2;\n        })\n        .text(function(d) {\n            return d.model.categoryLabel;\n        })\n        .each(\n            /** @param {CategoryViewModel} catModel*/\n            function(catModel) {\n                Drawing.font(d3.select(this), catModel.parcatsViewModel.categorylabelfont);\n                svgTextUtils.convertToTspans(d3.select(this), graphDiv);\n            });\n\n    // Initialize dimension label\n    categoryGroupEnterSelection\n        .append('text')\n        .attr('class', 'dimlabel');\n\n    // Update dimension label\n    categorySelection.select('text.dimlabel')\n        .attr('text-anchor', 'middle')\n        .attr('alignment-baseline', 'baseline')\n        .attr('cursor',\n             /** @param {CategoryViewModel} catModel*/\n            function(catModel) {\n                if(catModel.parcatsViewModel.arrangement === 'fixed') {\n                    return 'default';\n                } else {\n                    return 'ew-resize';\n                }\n            })\n        .attr('x', function(d) {\n            return d.width / 2;\n        })\n        .attr('y', -5)\n        .text(function(d, i) {\n            if(i === 0) {\n                // Add dimension label above topmost category\n                return d.parcatsViewModel.model.dimensions[d.model.dimensionInd].dimensionLabel;\n            } else {\n                return null;\n            }\n        })\n        .each(\n            /** @param {CategoryViewModel} catModel*/\n            function(catModel) {\n                Drawing.font(d3.select(this), catModel.parcatsViewModel.labelfont);\n            });\n\n    // Category hover\n    // categorySelection.select('rect.catrect')\n    categorySelection.selectAll('rect.bandrect')\n        .on('mouseover', mouseoverCategoryBand)\n        .on('mouseout', mouseoutCategory);\n\n    // Remove unused categories\n    categorySelection.exit().remove();\n\n    // Setup drag\n    dimensionSelection.call(d3.behavior.drag()\n        .origin(function(d) {\n            return {x: d.x, y: 0};\n        })\n        .on('dragstart', dragDimensionStart)\n        .on('drag', dragDimension)\n        .on('dragend', dragDimensionEnd));\n\n\n    // Save off selections to view models\n    traceSelection.each(function(d) {\n        d.traceSelection = d3.select(this);\n        d.pathSelection = d3.select(this).selectAll('g.paths').selectAll('path.path');\n        d.dimensionSelection = d3.select(this).selectAll('g.dimensions').selectAll('g.dimension');\n    });\n\n    // Remove any orphan traces\n    traceSelection.exit().remove();\n}\n\n/**\n * Create / update parcat traces\n *\n * @param {Object} graphDiv\n * @param {Object} svg\n * @param {Array.<ParcatsModel>} parcatsModels\n * @param {Layout} layout\n */\nmodule.exports = function(graphDiv, svg, parcatsModels, layout) {\n    performPlot(parcatsModels, graphDiv, layout, svg);\n};\n\n/**\n * Function the returns the key property of an object for use with as D3 join function\n * @param d\n */\nfunction key(d) {\n    return d.key;\n}\n\n /** True if a category view model is in the right-most display dimension\n  * @param {CategoryViewModel} d */\nfunction catInRightDim(d) {\n    var numDims = d.parcatsViewModel.dimensions.length;\n    var leftDimInd = d.parcatsViewModel.dimensions[numDims - 1].model.dimensionInd;\n    return d.model.dimensionInd === leftDimInd;\n}\n\n/**\n * @param {PathViewModel} a\n * @param {PathViewModel} b\n */\nfunction compareRawColor(a, b) {\n    if(a.model.rawColor > b.model.rawColor) {\n        return 1;\n    } else if(a.model.rawColor < b.model.rawColor) {\n        return -1;\n    } else {\n        return 0;\n    }\n}\n\n/**\n * Handle path mouseover\n * @param {PathViewModel} d\n */\nfunction mouseoverPath(d) {\n    if(!d.parcatsViewModel.dragDimension) {\n        // We're not currently dragging\n\n        if(d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n            // hoverinfo is not skip, so we at least style the paths and emit interaction events\n\n            // Raise path to top\n            Lib.raiseToTop(this);\n\n            stylePathsHover(d3.select(this));\n\n            // Emit hover event\n            var points = buildPointsArrayForPath(d);\n            var constraints = buildConstraintsForPath(d);\n            d.parcatsViewModel.graphDiv.emit('plotly_hover', {\n                points: points, event: d3.event, constraints: constraints\n            });\n\n            // Handle hover label\n            if(d.parcatsViewModel.hoverinfoItems.indexOf('none') === -1) {\n                // hoverinfo is a combination of 'count' and 'probability'\n\n                // Mouse\n                var hoverX = d3.mouse(this)[0];\n\n                // Label\n                var gd = d.parcatsViewModel.graphDiv;\n                var trace = d.parcatsViewModel.trace;\n                var fullLayout = gd._fullLayout;\n                var rootBBox = fullLayout._paperdiv.node().getBoundingClientRect();\n                var graphDivBBox = d.parcatsViewModel.graphDiv.getBoundingClientRect();\n\n                // Find path center in path coordinates\n                var pathCenterX,\n                    pathCenterY,\n                    dimInd;\n\n                for(dimInd = 0; dimInd < (d.leftXs.length - 1); dimInd++) {\n                    if(d.leftXs[dimInd] + d.dimWidths[dimInd] - 2 <= hoverX && hoverX <= d.leftXs[dimInd + 1] + 2) {\n                        var leftDim = d.parcatsViewModel.dimensions[dimInd];\n                        var rightDim = d.parcatsViewModel.dimensions[dimInd + 1];\n                        pathCenterX = (leftDim.x + leftDim.width + rightDim.x) / 2;\n                        pathCenterY = (d.topYs[dimInd] + d.topYs[dimInd + 1] + d.height) / 2;\n                        break;\n                    }\n                }\n\n                // Find path center in root coordinates\n                var hoverCenterX = d.parcatsViewModel.x + pathCenterX;\n                var hoverCenterY = d.parcatsViewModel.y + pathCenterY;\n\n                var textColor = tinycolor.mostReadable(d.model.color, ['black', 'white']);\n\n                var count = d.model.count;\n                var prob = count / d.parcatsViewModel.model.count;\n                var labels = {\n                    countLabel: count,\n                    probabilityLabel: prob.toFixed(3)\n                };\n\n                // Build hover text\n                var hovertextParts = [];\n                if(d.parcatsViewModel.hoverinfoItems.indexOf('count') !== -1) {\n                    hovertextParts.push(['Count:', labels.countLabel].join(' '));\n                }\n                if(d.parcatsViewModel.hoverinfoItems.indexOf('probability') !== -1) {\n                    hovertextParts.push(['P:', labels.probabilityLabel].join(' '));\n                }\n\n                var hovertext = hovertextParts.join('<br>');\n                var mouseX = d3.mouse(gd)[0];\n\n                Fx.loneHover({\n                    trace: trace,\n                    x: hoverCenterX - rootBBox.left + graphDivBBox.left,\n                    y: hoverCenterY - rootBBox.top + graphDivBBox.top,\n                    text: hovertext,\n                    color: d.model.color,\n                    borderColor: 'black',\n                    fontFamily: 'Monaco, \"Courier New\", monospace',\n                    fontSize: 10,\n                    fontColor: textColor,\n                    idealAlign: mouseX < hoverCenterX ? 'right' : 'left',\n                    hovertemplate: (trace.line || {}).hovertemplate,\n                    hovertemplateLabels: labels,\n                    eventData: [{\n                        data: trace._input,\n                        fullData: trace,\n                        count: count,\n                        probability: prob\n                    }]\n                }, {\n                    container: fullLayout._hoverlayer.node(),\n                    outerContainer: fullLayout._paper.node(),\n                    gd: gd\n                });\n            }\n        }\n    }\n}\n\n/**\n * Handle path mouseout\n * @param {PathViewModel} d\n */\nfunction mouseoutPath(d) {\n    if(!d.parcatsViewModel.dragDimension) {\n        // We're not currently dragging\n        stylePathsNoHover(d3.select(this));\n\n        // Remove and hover label\n        Fx.loneUnhover(d.parcatsViewModel.graphDiv._fullLayout._hoverlayer.node());\n\n        // Restore path order\n        d.parcatsViewModel.pathSelection.sort(compareRawColor);\n\n        // Emit unhover event\n        if(d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n            var points = buildPointsArrayForPath(d);\n            var constraints = buildConstraintsForPath(d);\n            d.parcatsViewModel.graphDiv.emit('plotly_unhover', {\n                points: points, event: d3.event, constraints: constraints\n            });\n        }\n    }\n}\n\n/**\n * Build array of point objects for a path\n *\n * For use in click/hover events\n * @param {PathViewModel} d\n */\nfunction buildPointsArrayForPath(d) {\n    var points = [];\n    var curveNumber = getTraceIndex(d.parcatsViewModel);\n\n    for(var i = 0; i < d.model.valueInds.length; i++) {\n        var pointNumber = d.model.valueInds[i];\n        points.push({\n            curveNumber: curveNumber,\n            pointNumber: pointNumber\n        });\n    }\n    return points;\n}\n\n/**\n * Build constraints object for a path\n *\n * For use in click/hover events\n * @param {PathViewModel} d\n */\nfunction buildConstraintsForPath(d) {\n    var constraints = {};\n    var dimensions = d.parcatsViewModel.model.dimensions;\n\n    // dimensions\n    for(var i = 0; i < dimensions.length; i++) {\n        var dimension = dimensions[i];\n        var category = dimension.categories[d.model.categoryInds[i]];\n        constraints[dimension.containerInd] = category.categoryValue;\n    }\n\n    // color\n    if(d.model.rawColor !== undefined) {\n        constraints.color = d.model.rawColor;\n    }\n    return constraints;\n}\n\n/**\n * Handle path click\n * @param {PathViewModel} d\n */\nfunction clickPath(d) {\n    if(d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n        // hoverinfo it's skip, so interaction events aren't disabled\n        var points = buildPointsArrayForPath(d);\n        var constraints = buildConstraintsForPath(d);\n        d.parcatsViewModel.graphDiv.emit('plotly_click', {\n            points: points, event: d3.event, constraints: constraints\n        });\n    }\n}\n\nfunction stylePathsNoHover(pathSelection) {\n    pathSelection\n        .attr('fill', function(d) {\n            return d.model.color;\n        })\n        .attr('fill-opacity', 0.6)\n        .attr('stroke', 'lightgray')\n        .attr('stroke-width', 0.2)\n        .attr('stroke-opacity', 1.0);\n}\n\nfunction stylePathsHover(pathSelection) {\n    pathSelection\n        .attr('fill-opacity', 0.8)\n        .attr('stroke', function(d) {\n            return tinycolor.mostReadable(d.model.color, ['black', 'white']);\n        })\n        .attr('stroke-width', 0.3);\n}\n\nfunction styleCategoryHover(categorySelection) {\n    categorySelection\n        .select('rect.catrect')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 2.5);\n}\n\nfunction styleCategoriesNoHover(categorySelection) {\n    categorySelection\n        .select('rect.catrect')\n        .attr('stroke', 'black')\n        .attr('stroke-width', 1)\n        .attr('stroke-opacity', 1);\n}\n\nfunction styleBandsHover(bandsSelection) {\n    bandsSelection\n        .attr('stroke', 'black')\n        .attr('stroke-width', 1.5);\n}\n\nfunction styleBandsNoHover(bandsSelection) {\n    bandsSelection\n        .attr('stroke', 'black')\n        .attr('stroke-width', 0.2)\n        .attr('stroke-opacity', 1.0)\n        .attr('fill-opacity', 1.0);\n}\n\n/**\n * Return selection of all paths that pass through the specified category\n * @param {CategoryBandViewModel} catBandViewModel\n */\nfunction selectPathsThroughCategoryBandColor(catBandViewModel) {\n    var allPaths = catBandViewModel.parcatsViewModel.pathSelection;\n    var dimInd = catBandViewModel.categoryViewModel.model.dimensionInd;\n    var catInd = catBandViewModel.categoryViewModel.model.categoryInd;\n\n    return allPaths\n        .filter(\n            /** @param {PathViewModel} pathViewModel */\n            function(pathViewModel) {\n                return pathViewModel.model.categoryInds[dimInd] === catInd &&\n                    pathViewModel.model.color === catBandViewModel.color;\n            });\n}\n\n\n/**\n * Perform hover styling for all paths that pass though the specified band element's category\n *\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\nfunction styleForCategoryHovermode(bandElement) {\n    // Get all bands in the current category\n    var bandSel = d3.select(bandElement.parentNode).selectAll('rect.bandrect');\n\n    // Raise and style paths\n    bandSel.each(function(bvm) {\n        var paths = selectPathsThroughCategoryBandColor(bvm);\n        stylePathsHover(paths);\n        paths.each(function() {\n            // Raise path to top\n            Lib.raiseToTop(this);\n        });\n    });\n\n    // Style category\n    styleCategoryHover(d3.select(bandElement.parentNode));\n}\n\n/**\n * Perform hover styling for all paths that pass though the category of the specified band element and share the\n * same color\n *\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\nfunction styleForColorHovermode(bandElement) {\n    var bandViewModel = d3.select(bandElement).datum();\n    var catPaths = selectPathsThroughCategoryBandColor(bandViewModel);\n    stylePathsHover(catPaths);\n    catPaths.each(function() {\n        // Raise path to top\n        Lib.raiseToTop(this);\n    });\n\n    // Style category for drag\n    d3.select(bandElement.parentNode)\n        .selectAll('rect.bandrect')\n        .filter(function(b) {return b.color === bandViewModel.color;})\n        .each(function() {\n            Lib.raiseToTop(this);\n            styleBandsHover(d3.select(this));\n        });\n}\n\n\n/**\n * @param {HTMLElement} bandElement\n *  HTML element for band\n * @param eventName\n *  Event name (plotly_hover or plotly_click)\n * @param event\n *  Mouse Event\n */\nfunction emitPointsEventCategoryHovermode(bandElement, eventName, event) {\n    // Get all bands in the current category\n    var bandViewModel = d3.select(bandElement).datum();\n    var categoryModel = bandViewModel.categoryViewModel.model;\n    var gd = bandViewModel.parcatsViewModel.graphDiv;\n    var bandSel = d3.select(bandElement.parentNode).selectAll('rect.bandrect');\n\n    var points = [];\n    bandSel.each(function(bvm) {\n        var paths = selectPathsThroughCategoryBandColor(bvm);\n        paths.each(function(pathViewModel) {\n            // Extend points array\n            Array.prototype.push.apply(points, buildPointsArrayForPath(pathViewModel));\n        });\n    });\n\n    var constraints = {};\n    constraints[categoryModel.dimensionInd] = categoryModel.categoryValue;\n    gd.emit(eventName, {\n        points: points, event: event, constraints: constraints\n    });\n}\n\n/**\n * @param {HTMLElement} bandElement\n *  HTML element for band\n * @param eventName\n *  Event name (plotly_hover or plotly_click)\n * @param event\n *  Mouse Event\n */\nfunction emitPointsEventColorHovermode(bandElement, eventName, event) {\n    var bandViewModel = d3.select(bandElement).datum();\n    var categoryModel = bandViewModel.categoryViewModel.model;\n    var gd = bandViewModel.parcatsViewModel.graphDiv;\n    var paths = selectPathsThroughCategoryBandColor(bandViewModel);\n\n    var points = [];\n    paths.each(function(pathViewModel) {\n        // Extend points array\n        Array.prototype.push.apply(points, buildPointsArrayForPath(pathViewModel));\n    });\n\n    var constraints = {};\n    constraints[categoryModel.dimensionInd] = categoryModel.categoryValue;\n    // color\n    if(bandViewModel.rawColor !== undefined) {\n        constraints.color = bandViewModel.rawColor;\n    }\n    gd.emit(eventName, {\n        points: points, event: event, constraints: constraints\n    });\n}\n\n/**\n * Create hover label for a band element's category (for use when hoveron === 'category')\n *\n * @param {ClientRect} rootBBox\n *  Client bounding box for root of figure\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\nfunction createHoverLabelForCategoryHovermode(rootBBox, bandElement) {\n    // Selections\n    var rectSelection = d3.select(bandElement.parentNode).select('rect.catrect');\n    var rectBoundingBox = rectSelection.node().getBoundingClientRect();\n\n    // Models\n    /** @type {CategoryViewModel} */\n    var catViewModel = rectSelection.datum();\n    var parcatsViewModel = catViewModel.parcatsViewModel;\n    var dimensionModel = parcatsViewModel.model.dimensions[catViewModel.model.dimensionInd];\n    var trace = parcatsViewModel.trace;\n\n    // Positions\n    var hoverCenterY = rectBoundingBox.top + rectBoundingBox.height / 2;\n    var hoverCenterX,\n        hoverLabelIdealAlign;\n\n    if(parcatsViewModel.dimensions.length > 1 &&\n        dimensionModel.displayInd === parcatsViewModel.dimensions.length - 1) {\n        // right most dimension\n        hoverCenterX = rectBoundingBox.left;\n        hoverLabelIdealAlign = 'left';\n    } else {\n        hoverCenterX = rectBoundingBox.left + rectBoundingBox.width;\n        hoverLabelIdealAlign = 'right';\n    }\n\n    var count = catViewModel.model.count;\n    var catLabel = catViewModel.model.categoryLabel;\n    var prob = count / catViewModel.parcatsViewModel.model.count;\n    var labels = {\n        countLabel: count,\n        categoryLabel: catLabel,\n        probabilityLabel: prob.toFixed(3)\n    };\n\n    // Hover label text\n    var hoverinfoParts = [];\n    if(catViewModel.parcatsViewModel.hoverinfoItems.indexOf('count') !== -1) {\n        hoverinfoParts.push(['Count:', labels.countLabel].join(' '));\n    }\n    if(catViewModel.parcatsViewModel.hoverinfoItems.indexOf('probability') !== -1) {\n        hoverinfoParts.push(['P(' + labels.categoryLabel + '):', labels.probabilityLabel].join(' '));\n    }\n\n    var hovertext = hoverinfoParts.join('<br>');\n    return {\n        trace: trace,\n        x: hoverCenterX - rootBBox.left,\n        y: hoverCenterY - rootBBox.top,\n        text: hovertext,\n        color: 'lightgray',\n        borderColor: 'black',\n        fontFamily: 'Monaco, \"Courier New\", monospace',\n        fontSize: 12,\n        fontColor: 'black',\n        idealAlign: hoverLabelIdealAlign,\n        hovertemplate: trace.hovertemplate,\n        hovertemplateLabels: labels,\n        eventData: [{\n            data: trace._input,\n            fullData: trace,\n            count: count,\n            category: catLabel,\n            probability: prob\n        }]\n    };\n}\n\n/**\n * Create hover label for a band element's category (for use when hoveron === 'category')\n *\n * @param {ClientRect} rootBBox\n *  Client bounding box for root of figure\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\nfunction createHoverLabelForDimensionHovermode(rootBBox, bandElement) {\n    var allHoverlabels = [];\n\n    d3.select(bandElement.parentNode.parentNode)\n        .selectAll('g.category')\n        .select('rect.catrect')\n        .each(function() {\n            var bandNode = this;\n            allHoverlabels.push(createHoverLabelForCategoryHovermode(rootBBox, bandNode));\n        });\n\n    return allHoverlabels;\n}\n\n/**\n * Create hover labels for a band element's category (for use when hoveron === 'dimension')\n *\n * @param {ClientRect} rootBBox\n *  Client bounding box for root of figure\n * @param {HTMLElement} bandElement\n *  HTML element for band\n *\n */\nfunction createHoverLabelForColorHovermode(rootBBox, bandElement) {\n    var bandBoundingBox = bandElement.getBoundingClientRect();\n\n    // Models\n    /** @type {CategoryBandViewModel} */\n    var bandViewModel = d3.select(bandElement).datum();\n    var catViewModel = bandViewModel.categoryViewModel;\n    var parcatsViewModel = catViewModel.parcatsViewModel;\n    var dimensionModel = parcatsViewModel.model.dimensions[catViewModel.model.dimensionInd];\n    var trace = parcatsViewModel.trace;\n\n    // positions\n    var hoverCenterY = bandBoundingBox.y + bandBoundingBox.height / 2;\n\n    var hoverCenterX,\n        hoverLabelIdealAlign;\n    if(parcatsViewModel.dimensions.length > 1 &&\n        dimensionModel.displayInd === parcatsViewModel.dimensions.length - 1) {\n        // right most dimension\n        hoverCenterX = bandBoundingBox.left;\n        hoverLabelIdealAlign = 'left';\n    } else {\n        hoverCenterX = bandBoundingBox.left + bandBoundingBox.width;\n        hoverLabelIdealAlign = 'right';\n    }\n\n    // Labels\n    var catLabel = catViewModel.model.categoryLabel;\n\n    // Counts\n    var totalCount = bandViewModel.parcatsViewModel.model.count;\n\n    var bandColorCount = 0;\n    bandViewModel.categoryViewModel.bands.forEach(function(b) {\n        if(b.color === bandViewModel.color) {\n            bandColorCount += b.count;\n        }\n    });\n\n    var catCount = catViewModel.model.count;\n\n    var colorCount = 0;\n    parcatsViewModel.pathSelection.each(\n        /** @param {PathViewModel} pathViewModel */\n        function(pathViewModel) {\n            if(pathViewModel.model.color === bandViewModel.color) {\n                colorCount += pathViewModel.model.count;\n            }\n        });\n\n    var pColorAndCat = bandColorCount / totalCount;\n    var pCatGivenColor = bandColorCount / colorCount;\n    var pColorGivenCat = bandColorCount / catCount;\n\n    var labels = {\n        countLabel: totalCount,\n        categoryLabel: catLabel,\n        probabilityLabel: pColorAndCat.toFixed(3)\n    };\n\n    // Hover label text\n    var hoverinfoParts = [];\n    if(catViewModel.parcatsViewModel.hoverinfoItems.indexOf('count') !== -1) {\n        hoverinfoParts.push(['Count:', labels.countLabel].join(' '));\n    }\n    if(catViewModel.parcatsViewModel.hoverinfoItems.indexOf('probability') !== -1) {\n        hoverinfoParts.push('P(color âˆ© ' + catLabel + '): ' + labels.probabilityLabel);\n        hoverinfoParts.push('P(' + catLabel + ' | color): ' + pCatGivenColor.toFixed(3));\n        hoverinfoParts.push('P(color | ' + catLabel + '): ' + pColorGivenCat.toFixed(3));\n    }\n\n    var hovertext = hoverinfoParts.join('<br>');\n\n    // Compute text color\n    var textColor = tinycolor.mostReadable(bandViewModel.color, ['black', 'white']);\n\n    return {\n        trace: trace,\n        x: hoverCenterX - rootBBox.left,\n        y: hoverCenterY - rootBBox.top,\n        // name: 'NAME',\n        text: hovertext,\n        color: bandViewModel.color,\n        borderColor: 'black',\n        fontFamily: 'Monaco, \"Courier New\", monospace',\n        fontColor: textColor,\n        fontSize: 10,\n        idealAlign: hoverLabelIdealAlign,\n        hovertemplate: trace.hovertemplate,\n        hovertemplateLabels: labels,\n        eventData: [{\n            data: trace._input,\n            fullData: trace,\n            category: catLabel,\n            count: totalCount,\n            probability: pColorAndCat,\n            categorycount: catCount,\n            colorcount: colorCount,\n            bandcolorcount: bandColorCount\n        }]\n    };\n}\n\n/**\n * Handle dimension mouseover\n * @param {CategoryBandViewModel} bandViewModel\n */\nfunction mouseoverCategoryBand(bandViewModel) {\n    if(!bandViewModel.parcatsViewModel.dragDimension) {\n        // We're not currently dragging\n\n        if(bandViewModel.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n            // hoverinfo is not skip, so we at least style the bands and emit interaction events\n\n            // Mouse\n            var mouseY = d3.mouse(this)[1];\n            if(mouseY < -1) {\n                // Hover is above above the category rectangle (probably the dimension title text)\n                return;\n            }\n\n            var gd = bandViewModel.parcatsViewModel.graphDiv;\n            var fullLayout = gd._fullLayout;\n            var rootBBox = fullLayout._paperdiv.node().getBoundingClientRect();\n            var hoveron = bandViewModel.parcatsViewModel.hoveron;\n\n            /** @type {HTMLElement} */\n            var bandElement = this;\n\n            // Handle style and events\n            if(hoveron === 'color') {\n                styleForColorHovermode(bandElement);\n                emitPointsEventColorHovermode(bandElement, 'plotly_hover', d3.event);\n            } else {\n                styleForCategoryHovermode(bandElement);\n                emitPointsEventCategoryHovermode(bandElement, 'plotly_hover', d3.event);\n            }\n\n            // Handle hover label\n            if(bandViewModel.parcatsViewModel.hoverinfoItems.indexOf('none') === -1) {\n                var hoverItems;\n                if(hoveron === 'category') {\n                    hoverItems = createHoverLabelForCategoryHovermode(rootBBox, bandElement);\n                } else if(hoveron === 'color') {\n                    hoverItems = createHoverLabelForColorHovermode(rootBBox, bandElement);\n                } else if(hoveron === 'dimension') {\n                    hoverItems = createHoverLabelForDimensionHovermode(rootBBox, bandElement);\n                }\n\n                if(hoverItems) {\n                    Fx.loneHover(hoverItems, {\n                        container: fullLayout._hoverlayer.node(),\n                        outerContainer: fullLayout._paper.node(),\n                        gd: gd\n                    });\n                }\n            }\n        }\n    }\n}\n\n\n/**\n * Handle dimension mouseover\n * @param {CategoryBandViewModel} bandViewModel\n */\nfunction mouseoutCategory(bandViewModel) {\n    var parcatsViewModel = bandViewModel.parcatsViewModel;\n\n    if(!parcatsViewModel.dragDimension) {\n        // We're not dragging anything\n\n        // Reset unhovered styles\n        stylePathsNoHover(parcatsViewModel.pathSelection);\n        styleCategoriesNoHover(parcatsViewModel.dimensionSelection.selectAll('g.category'));\n        styleBandsNoHover(parcatsViewModel.dimensionSelection.selectAll('g.category').selectAll('rect.bandrect'));\n\n        // Remove hover label\n        Fx.loneUnhover(parcatsViewModel.graphDiv._fullLayout._hoverlayer.node());\n\n        // Restore path order\n        parcatsViewModel.pathSelection.sort(compareRawColor);\n\n        // Emit unhover event\n        if(parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n            var hoveron = bandViewModel.parcatsViewModel.hoveron;\n            var bandElement = this;\n\n            // Handle style and events\n            if(hoveron === 'color') {\n                emitPointsEventColorHovermode(bandElement, 'plotly_unhover', d3.event);\n            } else {\n                emitPointsEventCategoryHovermode(bandElement, 'plotly_unhover', d3.event);\n            }\n        }\n    }\n}\n\n\n/**\n * Handle dimension drag start\n * @param {DimensionViewModel} d\n */\nfunction dragDimensionStart(d) {\n    // Check if dragging is supported\n    if(d.parcatsViewModel.arrangement === 'fixed') {\n        return;\n    }\n\n    // Save off initial drag indexes for dimension\n    d.dragDimensionDisplayInd = d.model.displayInd;\n    d.initialDragDimensionDisplayInds = d.parcatsViewModel.model.dimensions.map(function(d) {return d.displayInd;});\n    d.dragHasMoved = false;\n\n    // Check for category hit\n    d.dragCategoryDisplayInd = null;\n    d3.select(this)\n        .selectAll('g.category')\n        .select('rect.catrect')\n        .each(\n            /** @param {CategoryViewModel} catViewModel */\n            function(catViewModel) {\n                var catMouseX = d3.mouse(this)[0];\n                var catMouseY = d3.mouse(this)[1];\n\n\n                if(-2 <= catMouseX && catMouseX <= catViewModel.width + 2 &&\n                    -2 <= catMouseY && catMouseY <= catViewModel.height + 2) {\n                    // Save off initial drag indexes for categories\n                    d.dragCategoryDisplayInd = catViewModel.model.displayInd;\n                    d.initialDragCategoryDisplayInds = d.model.categories.map(function(c) {\n                        return c.displayInd;\n                    });\n\n                    // Initialize categories dragY to be the current y position\n                    catViewModel.model.dragY = catViewModel.y;\n\n                    // Raise category\n                    Lib.raiseToTop(this.parentNode);\n\n                    // Get band element\n                    d3.select(this.parentNode)\n                        .selectAll('rect.bandrect')\n                        /** @param {CategoryBandViewModel} bandViewModel */\n                        .each(function(bandViewModel) {\n                            if(bandViewModel.y < catMouseY && catMouseY <= bandViewModel.y + bandViewModel.height) {\n                                d.potentialClickBand = this;\n                            }\n                        });\n                }\n            });\n\n    // Update toplevel drag dimension\n    d.parcatsViewModel.dragDimension = d;\n\n    // Remove hover label if any\n    Fx.loneUnhover(d.parcatsViewModel.graphDiv._fullLayout._hoverlayer.node());\n}\n\n/**\n * Handle dimension drag\n * @param {DimensionViewModel} d\n */\nfunction dragDimension(d) {\n    // Check if dragging is supported\n    if(d.parcatsViewModel.arrangement === 'fixed') {\n        return;\n    }\n\n    d.dragHasMoved = true;\n\n    if(d.dragDimensionDisplayInd === null) {\n        return;\n    }\n\n    var dragDimInd = d.dragDimensionDisplayInd;\n    var prevDimInd = dragDimInd - 1;\n    var nextDimInd = dragDimInd + 1;\n\n    var dragDimension = d.parcatsViewModel\n        .dimensions[dragDimInd];\n\n    // Update category\n    if(d.dragCategoryDisplayInd !== null) {\n        var dragCategory = dragDimension.categories[d.dragCategoryDisplayInd];\n\n        // Update dragY by dy\n        dragCategory.model.dragY += d3.event.dy;\n        var categoryY = dragCategory.model.dragY;\n\n        // Check for category drag swaps\n        var catDisplayInd = dragCategory.model.displayInd;\n        var dimCategoryViews = dragDimension.categories;\n\n        var catAbove = dimCategoryViews[catDisplayInd - 1];\n        var catBelow = dimCategoryViews[catDisplayInd + 1];\n\n        // Check for overlap above\n        if(catAbove !== undefined) {\n            if(categoryY < (catAbove.y + catAbove.height / 2.0)) {\n                // Swap display inds\n                dragCategory.model.displayInd = catAbove.model.displayInd;\n                catAbove.model.displayInd = catDisplayInd;\n            }\n        }\n\n        if(catBelow !== undefined) {\n            if((categoryY + dragCategory.height) > (catBelow.y + catBelow.height / 2.0)) {\n                // Swap display inds\n                dragCategory.model.displayInd = catBelow.model.displayInd;\n                catBelow.model.displayInd = catDisplayInd;\n            }\n        }\n\n        // Update category drag display index\n        d.dragCategoryDisplayInd = dragCategory.model.displayInd;\n    }\n\n    // Update dimension position\n    if(d.dragCategoryDisplayInd === null || d.parcatsViewModel.arrangement === 'freeform') {\n        dragDimension.model.dragX = d3.event.x;\n\n        // Check for dimension swaps\n        var prevDimension = d.parcatsViewModel.dimensions[prevDimInd];\n        var nextDimension = d.parcatsViewModel.dimensions[nextDimInd];\n\n        if(prevDimension !== undefined) {\n            if(dragDimension.model.dragX < (prevDimension.x + prevDimension.width)) {\n                // Swap display inds\n                dragDimension.model.displayInd = prevDimension.model.displayInd;\n                prevDimension.model.displayInd = dragDimInd;\n            }\n        }\n\n        if(nextDimension !== undefined) {\n            if((dragDimension.model.dragX + dragDimension.width) > nextDimension.x) {\n                // Swap display inds\n                dragDimension.model.displayInd = nextDimension.model.displayInd;\n                nextDimension.model.displayInd = d.dragDimensionDisplayInd;\n            }\n        }\n\n        // Update drag display index\n        d.dragDimensionDisplayInd = dragDimension.model.displayInd;\n    }\n\n    // Update view models\n    updateDimensionViewModels(d.parcatsViewModel);\n    updatePathViewModels(d.parcatsViewModel);\n\n    // Update svg geometry\n    updateSvgCategories(d.parcatsViewModel);\n    updateSvgPaths(d.parcatsViewModel);\n}\n\n\n/**\n * Handle dimension drag end\n * @param {DimensionViewModel} d\n */\nfunction dragDimensionEnd(d) {\n    // Check if dragging is supported\n    if(d.parcatsViewModel.arrangement === 'fixed') {\n        return;\n    }\n\n    if(d.dragDimensionDisplayInd === null) {\n        return;\n    }\n\n    d3.select(this).selectAll('text').attr('font-weight', 'normal');\n\n    // Compute restyle command\n    // -----------------------\n    var restyleData = {};\n    var traceInd = getTraceIndex(d.parcatsViewModel);\n\n    // ### Handle dimension reordering ###\n    var finalDragDimensionDisplayInds = d.parcatsViewModel.model.dimensions.map(function(d) {return d.displayInd;});\n    var anyDimsReordered = d.initialDragDimensionDisplayInds.some(function(initDimDisplay, dimInd) {\n        return initDimDisplay !== finalDragDimensionDisplayInds[dimInd];\n    });\n\n    if(anyDimsReordered) {\n        finalDragDimensionDisplayInds.forEach(function(finalDimDisplay, dimInd) {\n            var containerInd = d.parcatsViewModel.model.dimensions[dimInd].containerInd;\n            restyleData['dimensions[' + containerInd + '].displayindex'] = finalDimDisplay;\n        });\n    }\n\n    // ### Handle category reordering ###\n    var anyCatsReordered = false;\n    if(d.dragCategoryDisplayInd !== null) {\n        var finalDragCategoryDisplayInds = d.model.categories.map(function(c) {\n            return c.displayInd;\n        });\n\n        anyCatsReordered = d.initialDragCategoryDisplayInds.some(function(initCatDisplay, catInd) {\n            return initCatDisplay !== finalDragCategoryDisplayInds[catInd];\n        });\n\n        if(anyCatsReordered) {\n            // Sort a shallow copy of the category models by display index\n            var sortedCategoryModels = d.model.categories.slice().sort(\n                function(a, b) { return a.displayInd - b.displayInd; });\n\n            // Get new categoryarray and ticktext values\n            var newCategoryArray = sortedCategoryModels.map(function(v) { return v.categoryValue; });\n            var newCategoryLabels = sortedCategoryModels.map(function(v) { return v.categoryLabel; });\n\n            restyleData['dimensions[' + d.model.containerInd + '].categoryarray'] = [newCategoryArray];\n            restyleData['dimensions[' + d.model.containerInd + '].ticktext'] = [newCategoryLabels];\n            restyleData['dimensions[' + d.model.containerInd + '].categoryorder'] = 'array';\n        }\n    }\n\n    // Handle potential click event\n    // ----------------------------\n    if(d.parcatsViewModel.hoverinfoItems.indexOf('skip') === -1) {\n        if(!d.dragHasMoved && d.potentialClickBand) {\n            if(d.parcatsViewModel.hoveron === 'color') {\n                emitPointsEventColorHovermode(d.potentialClickBand, 'plotly_click', d3.event.sourceEvent);\n            } else {\n                emitPointsEventCategoryHovermode(d.potentialClickBand, 'plotly_click', d3.event.sourceEvent);\n            }\n        }\n    }\n\n    // Nullify drag states\n    // -------------------\n    d.model.dragX = null;\n    if(d.dragCategoryDisplayInd !== null) {\n        var dragCategory = d.parcatsViewModel\n            .dimensions[d.dragDimensionDisplayInd]\n            .categories[d.dragCategoryDisplayInd];\n\n        dragCategory.model.dragY = null;\n        d.dragCategoryDisplayInd = null;\n    }\n\n    d.dragDimensionDisplayInd = null;\n    d.parcatsViewModel.dragDimension = null;\n    d.dragHasMoved = null;\n    d.potentialClickBand = null;\n\n    // Update view models\n    // ------------------\n    updateDimensionViewModels(d.parcatsViewModel);\n    updatePathViewModels(d.parcatsViewModel);\n\n    // Perform transition\n    // ------------------\n    var transition = d3.transition()\n        .duration(300)\n        .ease('cubic-in-out');\n\n    transition\n        .each(function() {\n            updateSvgCategories(d.parcatsViewModel, true);\n            updateSvgPaths(d.parcatsViewModel, true);\n        })\n        .each('end', function() {\n            if(anyDimsReordered || anyCatsReordered) {\n                // Perform restyle if the order of categories or dimensions changed\n                Plotly.restyle(d.parcatsViewModel.graphDiv, restyleData, [traceInd]);\n            }\n        });\n}\n\n/**\n *\n * @param {ParcatsViewModel} parcatsViewModel\n */\nfunction getTraceIndex(parcatsViewModel) {\n    var traceInd;\n    var allTraces = parcatsViewModel.graphDiv._fullData;\n    for(var i = 0; i < allTraces.length; i++) {\n        if(parcatsViewModel.key === allTraces[i].uid) {\n            traceInd = i;\n            break;\n        }\n    }\n    return traceInd;\n}\n\n/** Update the svg paths for view model\n * @param {ParcatsViewModel} parcatsViewModel\n * @param {boolean} hasTransition Whether to update element with transition\n */\nfunction updateSvgPaths(parcatsViewModel, hasTransition) {\n    if(hasTransition === undefined) {\n        hasTransition = false;\n    }\n\n    function transition(selection) {\n        return hasTransition ? selection.transition() : selection;\n    }\n\n    // Update binding\n    parcatsViewModel.pathSelection.data(function(d) {\n        return d.paths;\n    }, key);\n\n    // Update paths\n    transition(parcatsViewModel.pathSelection).attr('d', function(d) {\n        return d.svgD;\n    });\n}\n\n/** Update the svg paths for view model\n * @param {ParcatsViewModel} parcatsViewModel\n * @param {boolean} hasTransition Whether to update element with transition\n */\nfunction updateSvgCategories(parcatsViewModel, hasTransition) {\n    if(hasTransition === undefined) {\n        hasTransition = false;\n    }\n\n    function transition(selection) {\n        return hasTransition ? selection.transition() : selection;\n    }\n\n    // Update binding\n    parcatsViewModel.dimensionSelection\n        .data(function(d) {\n            return d.dimensions;\n        }, key);\n\n    var categorySelection = parcatsViewModel.dimensionSelection\n        .selectAll('g.category')\n        .data(function(d) {return d.categories;}, key);\n\n    // Update dimension position\n    transition(parcatsViewModel.dimensionSelection)\n        .attr('transform', function(d) {\n            return 'translate(' + d.x + ', 0)';\n        });\n\n    // Update category position\n    transition(categorySelection)\n        .attr('transform', function(d) {\n            return 'translate(0, ' + d.y + ')';\n        });\n\n    var dimLabelSelection = categorySelection.select('.dimlabel');\n\n    // ### Update dimension label\n    // Only the top-most display category should have the dimension label\n    dimLabelSelection\n        .text(function(d, i) {\n            if(i === 0) {\n                // Add dimension label above topmost category\n                return d.parcatsViewModel.model.dimensions[d.model.dimensionInd].dimensionLabel;\n            } else {\n                return null;\n            }\n        });\n\n    // Update category label\n    // Categories in the right-most display dimension have their labels on\n    // the right, all others on the left\n    var catLabelSelection = categorySelection.select('.catlabel');\n    catLabelSelection\n        .attr('text-anchor',\n            function(d) {\n                if(catInRightDim(d)) {\n                    // Place label to the right of category\n                    return 'start';\n                } else {\n                    // Place label to the left of category\n                    return 'end';\n                }\n            })\n        .attr('x',\n            function(d) {\n                if(catInRightDim(d)) {\n                    // Place label to the right of category\n                    return d.width + 5;\n                } else {\n                    // Place label to the left of category\n                    return -5;\n                }\n            })\n        .each(function(d) {\n            // Update attriubutes of <tspan> elements\n            var newX;\n            var newAnchor;\n            if(catInRightDim(d)) {\n                // Place label to the right of category\n                newX = d.width + 5;\n                newAnchor = 'start';\n            } else {\n                // Place label to the left of category\n                newX = -5;\n                newAnchor = 'end';\n            }\n            d3.select(this)\n                .selectAll('tspan')\n                .attr('x', newX)\n                .attr('text-anchor', newAnchor);\n        });\n\n    // Update bands\n    // Initialize color band rects\n    var bandSelection = categorySelection\n        .selectAll('rect.bandrect')\n        .data(\n            /** @param {CategoryViewModel} catViewModel*/\n            function(catViewModel) {\n                return catViewModel.bands;\n            }, key);\n\n    var bandsSelectionEnter = bandSelection.enter()\n        .append('rect')\n        .attr('class', 'bandrect')\n        .attr('cursor', 'move')\n        .attr('stroke-opacity', 0)\n        .attr('fill', function(d) {\n            return d.color;\n        })\n        .attr('fill-opacity', 0);\n\n    bandSelection\n        .attr('fill', function(d) {\n            return d.color;\n        })\n        .attr('width', function(d) {\n            return d.width;\n        })\n        .attr('height', function(d) {\n            return d.height;\n        })\n        .attr('y', function(d) {\n            return d.y;\n        });\n\n    styleBandsNoHover(bandsSelectionEnter);\n\n    // Raise bands to the top\n    bandSelection.each(function() {Lib.raiseToTop(this);});\n\n    // Remove unused bands\n    bandSelection.exit().remove();\n}\n\n/**\n * Create a ParcatsViewModel traces\n * @param {Object} graphDiv\n *  Top-level graph div element\n * @param {Layout} layout\n *  SVG layout object\n * @param {Array.<ParcatsModel>} wrappedParcatsModel\n *  Wrapped ParcatsModel for this trace\n * @return {ParcatsViewModel}\n */\nfunction createParcatsViewModel(graphDiv, layout, wrappedParcatsModel) {\n    // Unwrap model\n    var parcatsModel = wrappedParcatsModel[0];\n\n    // Compute margin\n    var margin = layout.margin || {l: 80, r: 80, t: 100, b: 80};\n\n    // Compute pixel position/extents\n    var trace = parcatsModel.trace;\n    var domain = trace.domain;\n    var figureWidth = layout.width;\n    var figureHeight = layout.height;\n    var traceWidth = Math.floor(figureWidth * (domain.x[1] - domain.x[0]));\n    var traceHeight = Math.floor(figureHeight * (domain.y[1] - domain.y[0]));\n    var traceX = domain.x[0] * figureWidth + margin.l;\n    var traceY = layout.height - domain.y[1] * layout.height + margin.t;\n\n    // Handle path shape\n    // -----------------\n    var pathShape = trace.line.shape;\n\n    // Handle hover info\n    // -----------------\n    var hoverinfoItems;\n    if(trace.hoverinfo === 'all') {\n        hoverinfoItems = ['count', 'probability'];\n    } else {\n        hoverinfoItems = (trace.hoverinfo || '').split('+');\n    }\n\n    // Construct parcatsViewModel\n    // --------------------------\n    var parcatsViewModel = {\n        trace: trace,\n        key: trace.uid,\n        model: parcatsModel,\n        x: traceX,\n        y: traceY,\n        width: traceWidth,\n        height: traceHeight,\n        hoveron: trace.hoveron,\n        hoverinfoItems: hoverinfoItems,\n        arrangement: trace.arrangement,\n        bundlecolors: trace.bundlecolors,\n        sortpaths: trace.sortpaths,\n        labelfont: trace.labelfont,\n        categorylabelfont: trace.tickfont,\n        pathShape: pathShape,\n        dragDimension: null,\n        margin: margin,\n        paths: [],\n        dimensions: [],\n        graphDiv: graphDiv,\n        traceSelection: null,\n        pathSelection: null,\n        dimensionSelection: null\n    };\n\n    // Update dimension view models if we have at least 1 dimension\n    if(parcatsModel.dimensions) {\n        updateDimensionViewModels(parcatsViewModel);\n\n        // Update path view models if we have at least 2 dimensions\n        updatePathViewModels(parcatsViewModel);\n    }\n    // Inside a categories view model\n    return parcatsViewModel;\n}\n\n/**\n * Build the SVG string to represents a parallel categories path\n * @param {Array.<Number>} leftXPositions\n *  Array of the x positions of the left edge of each dimension (in display order)\n * @param {Array.<Number>} pathYs\n *  Array of the y positions of the top of the path at each dimension (in display order)\n * @param {Array.<Number>} dimWidths\n *  Array of the widths of each dimension in display order\n * @param {Number} pathHeight\n *  The height of the path in pixels\n * @param {Number} curvature\n *  The curvature factor for the path. 0 results in a straight line and values greater than zero result in curved paths\n * @return {string}\n */\nfunction buildSvgPath(leftXPositions, pathYs, dimWidths, pathHeight, curvature) {\n    // Compute the x midpoint of each path segment\n    var xRefPoints1 = [];\n    var xRefPoints2 = [];\n    var refInterpolator;\n    var d;\n\n    for(d = 0; d < dimWidths.length - 1; d++) {\n        refInterpolator = d3.interpolateNumber(dimWidths[d] + leftXPositions[d], leftXPositions[d + 1]);\n        xRefPoints1.push(refInterpolator(curvature));\n        xRefPoints2.push(refInterpolator(1 - curvature));\n    }\n\n    // Move to top of path on left edge of left-most category\n    var svgD = 'M ' + leftXPositions[0] + ',' + pathYs[0];\n\n    // Horizontal line to right edge\n    svgD += 'l' + dimWidths[0] + ',0 ';\n\n    // Horizontal line to right edge\n    for(d = 1; d < dimWidths.length; d++) {\n        // Curve to left edge of category\n        svgD += 'C' + xRefPoints1[d - 1] + ',' + pathYs[d - 1] +\n              ' ' + xRefPoints2[d - 1] + ',' + pathYs[d] +\n              ' ' + leftXPositions[d] + ',' + pathYs[d];\n\n        // svgD += 'L' + leftXPositions[d] + ',' + pathYs[d];\n\n        // Horizontal line to right edge\n        svgD += 'l' + dimWidths[d] + ',0 ';\n    }\n\n    // Line down\n    svgD += 'l' + '0,' + pathHeight + ' ';\n\n    // Line to left edge of right-most category\n    svgD += 'l -' + dimWidths[dimWidths.length - 1] + ',0 ';\n\n    for(d = dimWidths.length - 2; d >= 0; d--) {\n        // Curve to right edge of category\n        svgD += 'C' + xRefPoints2[d] + ',' + (pathYs[d + 1] + pathHeight) +\n             ' ' + xRefPoints1[d] + ',' + (pathYs[d] + pathHeight) +\n             ' ' + (leftXPositions[d] + dimWidths[d]) + ',' + (pathYs[d] + pathHeight);\n\n        // svgD += 'L' + (leftXPositions[d] + dimWidths[d]) + ',' + (pathYs[d] + pathHeight);\n\n        // Horizontal line to right edge\n        svgD += 'l-' + dimWidths[d] + ',0 ';\n    }\n\n    // Close path\n    svgD += 'Z';\n    return svgD;\n}\n\n/**\n * Update the path view models based on the dimension view models in a ParcatsViewModel\n *\n * @param {ParcatsViewModel} parcatsViewModel\n *  View model for trace\n */\nfunction updatePathViewModels(parcatsViewModel) {\n    // Initialize an array of the y position of the top of the next path to be added to each category.\n    //\n    // nextYPositions[d][c] is the y position of the next path through category with index c of dimension with index d\n    var dimensionViewModels = parcatsViewModel.dimensions;\n    var parcatsModel = parcatsViewModel.model;\n    var nextYPositions = dimensionViewModels.map(\n        function(d) {\n            return d.categories.map(\n                function(c) {\n                    return c.y;\n                });\n        });\n\n    // Array from category index to category display index for each true dimension index\n    var catToDisplayIndPerDim = parcatsViewModel.model.dimensions.map(\n        function(d) {\n            return d.categories.map(function(c) {return c.displayInd;});\n        });\n\n    // Array from true dimension index to dimension display index\n    var dimToDisplayInd = parcatsViewModel.model.dimensions.map(function(d) {return d.displayInd;});\n    var displayToDimInd = parcatsViewModel.dimensions.map(function(d) {return d.model.dimensionInd;});\n\n    // Array of the x position of the left edge of the rectangles for each dimension\n    var leftXPositions = dimensionViewModels.map(\n        function(d) {\n            return d.x;\n        });\n\n    // Compute dimension widths\n    var dimWidths = dimensionViewModels.map(function(d) {return d.width;});\n\n    // Build sorted Array of PathModel objects\n    var pathModels = [];\n    for(var p in parcatsModel.paths) {\n        if(parcatsModel.paths.hasOwnProperty(p)) {\n            pathModels.push(parcatsModel.paths[p]);\n        }\n    }\n\n    // Compute category display inds to use for sorting paths\n    function pathDisplayCategoryInds(pathModel) {\n        var dimensionInds = pathModel.categoryInds.map(function(catInd, dimInd) {return catToDisplayIndPerDim[dimInd][catInd];});\n        var displayInds = displayToDimInd.map(function(dimInd) {\n            return dimensionInds[dimInd];\n        });\n        return displayInds;\n    }\n\n    // Sort in ascending order by display index array\n    pathModels.sort(function(v1, v2) {\n        // Build display inds for each path\n        var sortArray1 = pathDisplayCategoryInds(v1);\n        var sortArray2 = pathDisplayCategoryInds(v2);\n\n        // Handle path sort order\n        if(parcatsViewModel.sortpaths === 'backward') {\n            sortArray1.reverse();\n            sortArray2.reverse();\n        }\n\n        // Append the first value index of the path to break ties\n        sortArray1.push(v1.valueInds[0]);\n        sortArray2.push(v2.valueInds[0]);\n\n        // Handle color bundling\n        if(parcatsViewModel.bundlecolors) {\n            // Prepend sort array with the raw color value\n            sortArray1.unshift(v1.rawColor);\n            sortArray2.unshift(v2.rawColor);\n        }\n\n        // colors equal, sort by display categories\n        if(sortArray1 < sortArray2) {\n            return -1;\n        }\n        if(sortArray1 > sortArray2) {\n            return 1;\n        }\n\n        return 0;\n    });\n\n    // Create path models\n    var pathViewModels = new Array(pathModels.length);\n    var totalCount = dimensionViewModels[0].model.count;\n    var totalHeight = dimensionViewModels[0].categories\n        .map(function(c) { return c.height; })\n        .reduce(function(v1, v2) { return v1 + v2; });\n\n\n    for(var pathNumber = 0; pathNumber < pathModels.length; pathNumber++) {\n        var pathModel = pathModels[pathNumber];\n\n        var pathHeight;\n        if(totalCount > 0) {\n            pathHeight = totalHeight * (pathModel.count / totalCount);\n        } else {\n            pathHeight = 0;\n        }\n\n        // Build path y coords\n        var pathYs = new Array(nextYPositions.length);\n        for(var d = 0; d < pathModel.categoryInds.length; d++) {\n            var catInd = pathModel.categoryInds[d];\n            var catDisplayInd = catToDisplayIndPerDim[d][catInd];\n            var dimDisplayInd = dimToDisplayInd[d];\n\n            // Update next y position\n            pathYs[dimDisplayInd] = nextYPositions[dimDisplayInd][catDisplayInd];\n            nextYPositions[dimDisplayInd][catDisplayInd] += pathHeight;\n\n            // Update category color information\n            var catViewModle = parcatsViewModel.dimensions[dimDisplayInd].categories[catDisplayInd];\n            var numBands = catViewModle.bands.length;\n            var lastCatBand = catViewModle.bands[numBands - 1];\n\n            if(lastCatBand === undefined || pathModel.rawColor !== lastCatBand.rawColor) {\n                // Create a new band\n                var bandY = lastCatBand === undefined ? 0 : lastCatBand.y + lastCatBand.height;\n                catViewModle.bands.push({\n                    key: bandY,\n                    color: pathModel.color,\n                    rawColor: pathModel.rawColor,\n                    height: pathHeight,\n                    width: catViewModle.width,\n                    count: pathModel.count,\n                    y: bandY,\n                    categoryViewModel: catViewModle,\n                    parcatsViewModel: parcatsViewModel\n                });\n            } else {\n                // Extend current band\n                var currentBand = catViewModle.bands[numBands - 1];\n                currentBand.height += pathHeight;\n                currentBand.count += pathModel.count;\n            }\n        }\n\n        // build svg path\n        var svgD;\n        if(parcatsViewModel.pathShape === 'hspline') {\n            svgD = buildSvgPath(leftXPositions, pathYs, dimWidths, pathHeight, 0.5);\n        } else {\n            svgD = buildSvgPath(leftXPositions, pathYs, dimWidths, pathHeight, 0);\n        }\n\n        pathViewModels[pathNumber] = {\n            key: pathModel.valueInds[0],\n            model: pathModel,\n            height: pathHeight,\n            leftXs: leftXPositions,\n            topYs: pathYs,\n            dimWidths: dimWidths,\n            svgD: svgD,\n            parcatsViewModel: parcatsViewModel\n        };\n    }\n\n    parcatsViewModel.paths = pathViewModels;\n\n // * @property key\n // *  Unique key for this model\n // * @property {PathModel} model\n // *  Source path model\n // * @property {Number} height\n // *  Height of this path (pixels)\n // * @property {String} svgD\n // *  SVG path \"d\" attribute string\n}\n\n/**\n * Update the dimension view models based on the dimension models in a ParcatsViewModel\n *\n * @param {ParcatsViewModel} parcatsViewModel\n *  View model for trace\n */\nfunction updateDimensionViewModels(parcatsViewModel) {\n    // Compute dimension ordering\n    var dimensionsIndInfo = parcatsViewModel.model.dimensions.map(function(d) {\n        return {displayInd: d.displayInd, dimensionInd: d.dimensionInd};\n    });\n\n    dimensionsIndInfo.sort(function(a, b) {\n        return a.displayInd - b.displayInd;\n    });\n\n    var dimensions = [];\n    for(var displayInd in dimensionsIndInfo) {\n        var dimensionInd = dimensionsIndInfo[displayInd].dimensionInd;\n        var dimModel = parcatsViewModel.model.dimensions[dimensionInd];\n        dimensions.push(createDimensionViewModel(parcatsViewModel, dimModel));\n    }\n\n    parcatsViewModel.dimensions = dimensions;\n}\n\n/**\n * Create a parcats DimensionViewModel\n *\n * @param {ParcatsViewModel} parcatsViewModel\n *  View model for trace\n * @param {DimensionModel} dimensionModel\n * @return {DimensionViewModel}\n */\nfunction createDimensionViewModel(parcatsViewModel, dimensionModel) {\n    // Compute dimension x position\n    var categoryLabelPad = 40;\n    var dimWidth = 16;\n    var numDimensions = parcatsViewModel.model.dimensions.length;\n    var displayInd = dimensionModel.displayInd;\n\n    // Compute x coordinate values\n    var dimDx;\n    var dimX0;\n    var dimX;\n\n    if(numDimensions > 1) {\n        dimDx = (parcatsViewModel.width - 2 * categoryLabelPad - dimWidth) / (numDimensions - 1);\n    } else {\n        dimDx = 0;\n    }\n    dimX0 = categoryLabelPad;\n    dimX = dimX0 + dimDx * displayInd;\n\n    // Compute categories\n    var categories = [];\n    var maxCats = parcatsViewModel.model.maxCats;\n    var numCats = dimensionModel.categories.length;\n    var catSpacing = 8;\n    var totalCount = dimensionModel.count;\n    var totalHeight = parcatsViewModel.height - catSpacing * (maxCats - 1);\n    var nextCatHeight;\n    var nextCatModel;\n    var nextCat;\n    var catInd;\n    var catDisplayInd;\n\n    // Compute starting Y offset\n    var nextCatY = (maxCats - numCats) * catSpacing / 2.0;\n\n    // Compute category ordering\n    var categoryIndInfo = dimensionModel.categories.map(function(c) {\n        return {displayInd: c.displayInd, categoryInd: c.categoryInd};\n    });\n\n    categoryIndInfo.sort(function(a, b) {\n        return a.displayInd - b.displayInd;\n    });\n\n    for(catDisplayInd = 0; catDisplayInd < numCats; catDisplayInd++) {\n        catInd = categoryIndInfo[catDisplayInd].categoryInd;\n        nextCatModel = dimensionModel.categories[catInd];\n\n        if(totalCount > 0) {\n            nextCatHeight = (nextCatModel.count / totalCount) * totalHeight;\n        } else {\n            nextCatHeight = 0;\n        }\n\n        nextCat = {\n            key: nextCatModel.valueInds[0],\n            model: nextCatModel,\n            width: dimWidth,\n            height: nextCatHeight,\n            y: nextCatModel.dragY !== null ? nextCatModel.dragY : nextCatY,\n            bands: [],\n            parcatsViewModel: parcatsViewModel\n        };\n\n        nextCatY = nextCatY + nextCatHeight + catSpacing;\n        categories.push(nextCat);\n    }\n\n    return {\n        key: dimensionModel.dimensionInd,\n        x: dimensionModel.dragX !== null ? dimensionModel.dragX : dimX,\n        y: 0,\n        width: dimWidth,\n        model: dimensionModel,\n        categories: categories,\n        parcatsViewModel: parcatsViewModel,\n        dragCategoryDisplayInd: null,\n        dragDimensionDisplayInd: null,\n        initialDragDimensionDisplayInds: null,\n        initialDragCategoryDisplayInds: null,\n        dragHasMoved: null,\n        potentialClickBand: null\n    };\n}\n\n// JSDoc typedefs\n// ==============\n/**\n * @typedef {Object} Layout\n *  Object containing svg layout information\n *\n * @property {Number} width (pixels)\n *  Usable width for Figure (after margins are removed)\n * @property {Number} height (pixels)\n *  Usable height for Figure (after margins are removed)\n * @property {Margin} margin\n *  Margin around the Figure (pixels)\n */\n\n/**\n * @typedef {Object} Margin\n *  Object containing padding information in pixels\n *\n * @property {Number} t\n *  Top margin\n * @property {Number} r\n *  Right margin\n * @property {Number} b\n *  Bottom margin\n * @property {Number} l\n *  Left margin\n */\n\n/**\n * @typedef {Object} Font\n *  Object containing font information\n *\n * @property {Number} size: Font size\n * @property {String} color: Font color\n * @property {String} family: Font family\n */\n\n/**\n * @typedef {Object} ParcatsViewModel\n *  Object containing calculated parcats view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {ParcatsModel} model\n *  Source parcats model\n * @property {Array.<DimensionViewModel>} dimensions\n *  Array of dimension view models\n * @property {Number} width\n *  Width for this trace (pixels)\n * @property {Number} height\n *  Height for this trace (pixels)\n * @property {Number} x\n *  X position of this trace with respect to the Figure (pixels)\n * @property {Number} y\n *  Y position of this trace with respect to the Figure (pixels)\n * @property {String} hoveron\n *  Hover interaction mode. One of: 'category', 'color', or 'dimension'\n * @property {Array.<String>} hoverinfoItems\n *  Info to display on hover. Array with a combination of 'counts' and/or 'probabilities', or 'none', or 'skip'\n * @property {String} arrangement\n *  Category arrangement. One of: 'perpendicular', 'freeform', or 'fixed'\n * @property {Boolean} bundlecolors\n *  Whether paths should be sorted so that like colors are bundled together as they pass through categories\n * @property {String} sortpaths\n *  If 'forward' then sort paths based on dimensions from left to right. If 'backward' sort based on dimensions\n *  from right to left\n * @property {Font} labelfont\n *  Font for the dimension labels\n * @property {Font} categorylabelfont\n *  Font for the category labels\n * @property {String} pathShape\n *  The shape of the paths. Either 'linear' or 'hspline'.\n * @property {DimensionViewModel|null} dragDimension\n *  Dimension currently being dragged. Null if no drag in progress\n * @property {Margin} margin\n *  Margin around the Figure\n * @property {Object} graphDiv\n *  Top-level graph div element\n * @property {Object} traceSelection\n *  D3 selection of this view models trace group element\n * @property {Object} pathSelection\n *  D3 selection of this view models path elements\n * @property {Object} dimensionSelection\n *  D3 selection of this view models dimension group element\n */\n\n/**\n * @typedef {Object} DimensionViewModel\n *  Object containing calculated parcats dimension view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {DimensionModel} model\n *  Source dimension model\n * @property {Number} x\n *  X position of the center of this dimension with respect to the Figure (pixels)\n * @property {Number} y\n *  Y position of the top of this dimension with respect to the Figure (pixels)\n * @property {Number} width\n *  Width of categories in this dimension (pixels)\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n * @property {Array.<CategoryViewModel>} categories\n *  Dimensions category view models\n * @property {Number|null} dragCategoryDisplayInd\n *  Display index of category currently being dragged. null if no category is being dragged\n * @property {Number|null} dragDimensionDisplayInd\n *  Display index of the dimension being dragged. null if no dimension is being dragged\n * @property {Array.<Number>|null} initialDragDimensionDisplayInds\n *  Dimensions display indexes at the beginning of the current drag. null if no dimension is being dragged\n * @property {Array.<Number>|null} initialDragCategoryDisplayInds\n *  Category display indexes for the at the beginning of the current drag. null if no category is being dragged\n * @property {HTMLElement} potentialClickBand\n *  Band under mouse when current drag began. If no drag movement takes place then a click will be emitted for this\n *  band. Null if not drag in progress.\n * @property {Boolean} dragHasMoved\n *  True if there is an active drag and the drag has moved. If drag doesn't move before being ended then\n *  this may be interpreted as a click. Null if no drag in progress\n */\n\n/**\n * @typedef {Object} CategoryViewModel\n *  Object containing calculated parcats category view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {CategoryModel} model\n *  Source category model\n * @property {Number} width\n *  Width for this category (pixels)\n * @property {Number} height\n *  Height for this category (pixels)\n * @property {Number} y\n *  Y position of this cateogry with respect to the Figure (pixels)\n * @property {Array.<CategoryBandViewModel>} bands\n *  Array of color bands inside the category\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n */\n\n/**\n * @typedef {Object} CategoryBandViewModel\n *  Object containing calculated category band information. A category band is a region inside a category covering\n *  paths of a single color\n *\n * @property key\n *  Unique key for this model\n * @property color\n *  Band color\n * @property rawColor\n *  Raw color value for band\n * @property {Number} width\n *  Band width\n * @property {Number} height\n *  Band height\n * @property {Number} y\n *  Y position of top of the band with respect to the category\n * @property {Number} count\n *  The number of samples represented by the band\n * @property {CategoryViewModel} categoryViewModel\n *  The parent categorie's view model\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n */\n\n/**\n * @typedef {Object} PathViewModel\n *  Object containing calculated parcats path view information\n *\n *  These are quantities that require Layout information to calculate\n * @property key\n *  Unique key for this model\n * @property {PathModel} model\n *  Source path model\n * @property {Number} height\n *  Height of this path (pixels)\n * @property {Array.<Number>} leftXs\n *  The x position of the left edge of each display dimension\n * @property {Array.<Number>} topYs\n *  The y position of the top of the path for each display dimension\n * @property {Array.<Number>} dimWidths\n *  The width of each display dimension\n * @property {String} svgD\n *  SVG path \"d\" attribute string\n * @property {ParcatsViewModel} parcatsViewModel\n *  The parent trace's view model\n */\n"]},"metadata":{},"sourceType":"script"}