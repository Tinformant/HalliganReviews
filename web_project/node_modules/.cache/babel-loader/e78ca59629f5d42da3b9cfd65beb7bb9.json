{"ast":null,"code":"/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar tinycolor = require('tinycolor2');\n\nvar Plots = require('../../plots/plots');\n\nvar Registry = require('../../registry');\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar dragElement = require('../dragelement');\n\nvar Lib = require('../../lib');\n\nvar extendFlat = require('../../lib/extend').extendFlat;\n\nvar setCursor = require('../../lib/setcursor');\n\nvar Drawing = require('../drawing');\n\nvar Color = require('../color');\n\nvar Titles = require('../titles');\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar flipScale = require('../colorscale/helpers').flipScale;\n\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\n\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\n\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\n\nvar alignmentConstants = require('../../constants/alignment');\n\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar cn = require('./constants').cn;\n\nfunction draw(gd) {\n  var fullLayout = gd._fullLayout;\n\n  var colorBars = fullLayout._infolayer.selectAll('g.' + cn.colorbar).data(makeColorBarData(gd), function (opts) {\n    return opts._id;\n  });\n\n  colorBars.enter().append('g').attr('class', function (opts) {\n    return opts._id;\n  }).classed(cn.colorbar, true);\n  colorBars.each(function (opts) {\n    var g = d3.select(this);\n    Lib.ensureSingle(g, 'rect', cn.cbbg);\n    Lib.ensureSingle(g, 'g', cn.cbfills);\n    Lib.ensureSingle(g, 'g', cn.cblines);\n    Lib.ensureSingle(g, 'g', cn.cbaxis, function (s) {\n      s.classed(cn.crisp, true);\n    });\n    Lib.ensureSingle(g, 'g', cn.cbtitleunshift, function (s) {\n      s.append('g').classed(cn.cbtitle, true);\n    });\n    Lib.ensureSingle(g, 'rect', cn.cboutline);\n    var done = drawColorBar(g, opts, gd);\n    if (done && done.then) (gd._promises || []).push(done);\n\n    if (gd._context.edits.colorbarPosition) {\n      makeEditable(g, opts, gd);\n    }\n  });\n  colorBars.exit().each(function (opts) {\n    Plots.autoMargin(gd, opts._id);\n  }).remove();\n  colorBars.order();\n}\n\nfunction makeColorBarData(gd) {\n  var fullLayout = gd._fullLayout;\n  var calcdata = gd.calcdata;\n  var out = []; // single out item\n\n  var opts; // colorbar attr parent container\n\n  var cont; // trace attr container\n\n  var trace; // colorbar options\n\n  var cbOpt;\n\n  function initOpts(opts) {\n    return extendFlat(opts, {\n      // fillcolor can be a d3 scale, domain is z values, range is colors\n      // or leave it out for no fill,\n      // or set to a string constant for single-color fill\n      _fillcolor: null,\n      // line.color has the same options as fillcolor\n      _line: {\n        color: null,\n        width: null,\n        dash: null\n      },\n      // levels of lines to draw.\n      // note that this DOES NOT determine the extent of the bar\n      // that's given by the domain of fillcolor\n      // (or line.color if no fillcolor domain)\n      _levels: {\n        start: null,\n        end: null,\n        size: null\n      },\n      // separate fill levels (for example, heatmap coloring of a\n      // contour map) if this is omitted, fillcolors will be\n      // evaluated halfway between levels\n      _filllevels: null,\n      // for continuous colorscales: fill with a gradient instead of explicit levels\n      // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n      _fillgradient: null,\n      // when using a gradient, we need the data range specified separately\n      _zrange: null\n    });\n  }\n\n  function calcOpts() {\n    if (typeof cbOpt.calc === 'function') {\n      cbOpt.calc(gd, trace, opts);\n    } else {\n      opts._fillgradient = cont.reversescale ? flipScale(cont.colorscale) : cont.colorscale;\n      opts._zrange = [cont[cbOpt.min], cont[cbOpt.max]];\n    }\n  }\n\n  for (var i = 0; i < calcdata.length; i++) {\n    var cd = calcdata[i];\n    trace = cd[0].trace;\n    var moduleOpts = trace._module.colorbar;\n\n    if (trace.visible === true && moduleOpts) {\n      var allowsMultiplotCbs = Array.isArray(moduleOpts);\n      var cbOpts = allowsMultiplotCbs ? moduleOpts : [moduleOpts];\n\n      for (var j = 0; j < cbOpts.length; j++) {\n        cbOpt = cbOpts[j];\n        var contName = cbOpt.container;\n        cont = contName ? trace[contName] : trace;\n\n        if (cont && cont.showscale) {\n          opts = initOpts(cont.colorbar);\n          opts._id = 'cb' + trace.uid + (allowsMultiplotCbs && contName ? '-' + contName : '');\n          opts._traceIndex = trace.index;\n          opts._propPrefix = (contName ? contName + '.' : '') + 'colorbar.';\n          opts._meta = trace._meta;\n          calcOpts();\n          out.push(opts);\n        }\n      }\n    }\n  }\n\n  for (var k in fullLayout._colorAxes) {\n    cont = fullLayout[k];\n\n    if (cont.showscale) {\n      var colorAxOpts = fullLayout._colorAxes[k];\n      opts = initOpts(cont.colorbar);\n      opts._id = 'cb' + k;\n      opts._propPrefix = k + '.colorbar.';\n      opts._meta = fullLayout._meta;\n      cbOpt = {\n        min: 'cmin',\n        max: 'cmax'\n      };\n\n      if (colorAxOpts[0] !== 'heatmap') {\n        trace = colorAxOpts[1];\n        cbOpt.calc = trace._module.colorbar.calc;\n      }\n\n      calcOpts();\n      out.push(opts);\n    }\n  }\n\n  return out;\n}\n\nfunction drawColorBar(g, opts, gd) {\n  var fullLayout = gd._fullLayout;\n  var gs = fullLayout._size;\n  var fillColor = opts._fillcolor;\n  var line = opts._line;\n  var title = opts.title;\n  var titleSide = title.side;\n  var zrange = opts._zrange || d3.extent((typeof fillColor === 'function' ? fillColor : line.color).domain());\n  var lineColormap = typeof line.color === 'function' ? line.color : function () {\n    return line.color;\n  };\n  var fillColormap = typeof fillColor === 'function' ? fillColor : function () {\n    return fillColor;\n  };\n  var levelsIn = opts._levels;\n  var levelsOut = calcLevels(gd, opts, zrange);\n  var fillLevels = levelsOut.fill;\n  var lineLevels = levelsOut.line; // we calculate pixel sizes based on the specified graph size,\n  // not the actual (in case something pushed the margins around)\n  // which is a little odd but avoids an odd iterative effect\n  // when the colorbar itself is pushing the margins.\n  // but then the fractional size is calculated based on the\n  // actual graph size, so that the axes will size correctly.\n\n  var thickPx = Math.round(opts.thickness * (opts.thicknessmode === 'fraction' ? gs.w : 1));\n  var thickFrac = thickPx / gs.w;\n  var lenPx = Math.round(opts.len * (opts.lenmode === 'fraction' ? gs.h : 1));\n  var lenFrac = lenPx / gs.h;\n  var xpadFrac = opts.xpad / gs.w;\n  var yExtraPx = (opts.borderwidth + opts.outlinewidth) / 2;\n  var ypadFrac = opts.ypad / gs.h; // x positioning: do it initially just for left anchor,\n  // then fix at the end (since we don't know the width yet)\n\n  var xLeft = Math.round(opts.x * gs.w + opts.xpad); // for dragging... this is getting a little muddled...\n\n  var xLeftFrac = opts.x - thickFrac * ({\n    middle: 0.5,\n    right: 1\n  }[opts.xanchor] || 0); // y positioning we can do correctly from the start\n\n  var yBottomFrac = opts.y + lenFrac * (({\n    top: -0.5,\n    bottom: 0.5\n  }[opts.yanchor] || 0) - 0.5);\n  var yBottomPx = Math.round(gs.h * (1 - yBottomFrac));\n  var yTopPx = yBottomPx - lenPx; // stash a few things for makeEditable\n\n  opts._lenFrac = lenFrac;\n  opts._thickFrac = thickFrac;\n  opts._xLeftFrac = xLeftFrac;\n  opts._yBottomFrac = yBottomFrac; // stash mocked axis for contour label formatting\n\n  var ax = opts._axis = mockColorBarAxis(gd, opts, zrange); // position can't go in through supplyDefaults\n  // because that restricts it to [0,1]\n\n  ax.position = opts.x + xpadFrac + thickFrac;\n\n  if (['top', 'bottom'].indexOf(titleSide) !== -1) {\n    ax.title.side = titleSide;\n    ax.titlex = opts.x + xpadFrac;\n    ax.titley = yBottomFrac + (title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n  }\n\n  if (line.color && opts.tickmode === 'auto') {\n    ax.tickmode = 'linear';\n    ax.tick0 = levelsIn.start;\n    var dtick = levelsIn.size; // expand if too many contours, so we don't get too many ticks\n\n    var autoNtick = Lib.constrain((yBottomPx - yTopPx) / 50, 4, 15) + 1;\n    var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n\n    if (dtFactor > 1) {\n      var dtexp = Math.pow(10, Math.floor(Math.log(dtFactor) / Math.LN10));\n      dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]); // if the contours are at round multiples, reset tick0\n      // so they're still at round multiples. Otherwise,\n      // keep the first label on the first contour level\n\n      if ((Math.abs(levelsIn.start) / levelsIn.size + 1e-6) % 1 < 2e-6) {\n        ax.tick0 = 0;\n      }\n    }\n\n    ax.dtick = dtick;\n  } // set domain after init, because we may want to\n  // allow it outside [0,1]\n\n\n  ax.domain = [yBottomFrac + ypadFrac, yBottomFrac + lenFrac - ypadFrac];\n  ax.setScale();\n  g.attr('transform', 'translate(' + Math.round(gs.l) + ',' + Math.round(gs.t) + ')');\n  var titleCont = g.select('.' + cn.cbtitleunshift).attr('transform', 'translate(-' + Math.round(gs.l) + ',-' + Math.round(gs.t) + ')');\n  var axLayer = g.select('.' + cn.cbaxis);\n  var titleEl;\n  var titleHeight = 0;\n\n  function drawTitle(titleClass, titleOpts) {\n    var dfltTitleOpts = {\n      propContainer: ax,\n      propName: opts._propPrefix + 'title',\n      traceIndex: opts._traceIndex,\n      _meta: opts._meta,\n      placeholder: fullLayout._dfltTitle.colorbar,\n      containerGroup: g.select('.' + cn.cbtitle)\n    }; // this class-to-rotate thing with convertToTspans is\n    // getting hackier and hackier... delete groups with the\n    // wrong class (in case earlier the colorbar was drawn on\n    // a different side, I think?)\n\n    var otherClass = titleClass.charAt(0) === 'h' ? titleClass.substr(1) : 'h' + titleClass;\n    g.selectAll('.' + otherClass + ',.' + otherClass + '-math-group').remove();\n    Titles.draw(gd, titleClass, extendFlat(dfltTitleOpts, titleOpts || {}));\n  }\n\n  function drawDummyTitle() {\n    if (['top', 'bottom'].indexOf(titleSide) !== -1) {\n      // draw the title so we know how much room it needs\n      // when we squish the axis. This one only applies to\n      // top or bottom titles, not right side.\n      var x = gs.l + (opts.x + xpadFrac) * gs.w;\n      var fontSize = ax.title.font.size;\n      var y;\n\n      if (titleSide === 'top') {\n        y = (1 - (yBottomFrac + lenFrac - ypadFrac)) * gs.h + gs.t + 3 + fontSize * 0.75;\n      } else {\n        y = (1 - (yBottomFrac + ypadFrac)) * gs.h + gs.t - 3 - fontSize * 0.25;\n      }\n\n      drawTitle(ax._id + 'title', {\n        attributes: {\n          x: x,\n          y: y,\n          'text-anchor': 'start'\n        }\n      });\n    }\n  }\n\n  function drawCbTitle() {\n    if (['top', 'bottom'].indexOf(titleSide) === -1) {\n      var fontSize = ax.title.font.size;\n      var y = ax._offset + ax._length / 2;\n      var x = gs.l + (ax.position || 0) * gs.w + (ax.side === 'right' ? 10 + fontSize * (ax.showticklabels ? 1 : 0.5) : -10 - fontSize * (ax.showticklabels ? 0.5 : 0)); // the 'h' + is a hack to get around the fact that\n      // convertToTspans rotates any 'y...' class by 90 degrees.\n      // TODO: find a better way to control this.\n\n      drawTitle('h' + ax._id + 'title', {\n        avoid: {\n          selection: d3.select(gd).selectAll('g.' + ax._id + 'tick'),\n          side: titleSide,\n          offsetLeft: gs.l,\n          offsetTop: 0,\n          maxShift: fullLayout.width\n        },\n        attributes: {\n          x: x,\n          y: y,\n          'text-anchor': 'middle'\n        },\n        transform: {\n          rotate: '-90',\n          offset: 0\n        }\n      });\n    }\n  }\n\n  function drawAxis() {\n    if (['top', 'bottom'].indexOf(titleSide) !== -1) {\n      // squish the axis top to make room for the title\n      var titleGroup = g.select('.' + cn.cbtitle);\n      var titleText = titleGroup.select('text');\n      var titleTrans = [-opts.outlinewidth / 2, opts.outlinewidth / 2];\n      var mathJaxNode = titleGroup.select('.h' + ax._id + 'title-math-group').node();\n      var lineSize = 15.6;\n\n      if (titleText.node()) {\n        lineSize = parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n      }\n\n      if (mathJaxNode) {\n        titleHeight = Drawing.bBox(mathJaxNode).height;\n\n        if (titleHeight > lineSize) {\n          // not entirely sure how mathjax is doing\n          // vertical alignment, but this seems to work.\n          titleTrans[1] -= (titleHeight - lineSize) / 2;\n        }\n      } else if (titleText.node() && !titleText.classed(cn.jsPlaceholder)) {\n        titleHeight = Drawing.bBox(titleText.node()).height;\n      }\n\n      if (titleHeight) {\n        // buffer btwn colorbar and title\n        // TODO: configurable\n        titleHeight += 5;\n\n        if (titleSide === 'top') {\n          ax.domain[1] -= titleHeight / gs.h;\n          titleTrans[1] *= -1;\n        } else {\n          ax.domain[0] += titleHeight / gs.h;\n          var nlines = svgTextUtils.lineCount(titleText);\n          titleTrans[1] += (1 - nlines) * lineSize;\n        }\n\n        titleGroup.attr('transform', 'translate(' + titleTrans + ')');\n        ax.setScale();\n      }\n    }\n\n    g.selectAll('.' + cn.cbfills + ',.' + cn.cblines).attr('transform', 'translate(0,' + Math.round(gs.h * (1 - ax.domain[1])) + ')');\n    axLayer.attr('transform', 'translate(0,' + Math.round(-gs.t) + ')');\n    var fills = g.select('.' + cn.cbfills).selectAll('rect.' + cn.cbfill).data(fillLevels);\n    fills.enter().append('rect').classed(cn.cbfill, true).style('stroke', 'none');\n    fills.exit().remove();\n    var zBounds = zrange.map(ax.c2p).map(Math.round).sort(function (a, b) {\n      return a - b;\n    });\n    fills.each(function (d, i) {\n      var z = [i === 0 ? zrange[0] : (fillLevels[i] + fillLevels[i - 1]) / 2, i === fillLevels.length - 1 ? zrange[1] : (fillLevels[i] + fillLevels[i + 1]) / 2].map(ax.c2p).map(Math.round); // offset the side adjoining the next rectangle so they\n      // overlap, to prevent antialiasing gaps\n\n      z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]); // Colorbar cannot currently support opacities so we\n      // use an opaque fill even when alpha channels present\n\n      var fillEl = d3.select(this).attr({\n        x: xLeft,\n        width: Math.max(thickPx, 2),\n        y: d3.min(z),\n        height: Math.max(d3.max(z) - d3.min(z), 2)\n      });\n\n      if (opts._fillgradient) {\n        Drawing.gradient(fillEl, gd, opts._id, 'vertical', opts._fillgradient, 'fill');\n      } else {\n        // tinycolor can't handle exponents and\n        // at this scale, removing it makes no difference.\n        var colorString = fillColormap(d).replace('e-', '');\n        fillEl.attr('fill', tinycolor(colorString).toHexString());\n      }\n    });\n    var lines = g.select('.' + cn.cblines).selectAll('path.' + cn.cbline).data(line.color && line.width ? lineLevels : []);\n    lines.enter().append('path').classed(cn.cbline, true);\n    lines.exit().remove();\n    lines.each(function (d) {\n      d3.select(this).attr('d', 'M' + xLeft + ',' + (Math.round(ax.c2p(d)) + line.width / 2 % 1) + 'h' + thickPx).call(Drawing.lineGroupStyle, line.width, lineColormap(d), line.dash);\n    }); // force full redraw of labels and ticks\n\n    axLayer.selectAll('g.' + ax._id + 'tick,path').remove();\n    var shift = xLeft + thickPx + (opts.outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n    var vals = Axes.calcTicks(ax);\n    var transFn = Axes.makeTransFn(ax);\n    var tickSign = Axes.getTickSigns(ax)[2];\n    Axes.drawTicks(gd, ax, {\n      vals: ax.ticks === 'inside' ? Axes.clipEnds(ax, vals) : vals,\n      layer: axLayer,\n      path: Axes.makeTickPath(ax, shift, tickSign),\n      transFn: transFn\n    });\n    return Axes.drawLabels(gd, ax, {\n      vals: vals,\n      layer: axLayer,\n      transFn: transFn,\n      labelFns: Axes.makeLabelFns(ax, shift)\n    });\n  } // wait for the axis & title to finish rendering before\n  // continuing positioning\n  // TODO: why are we redrawing multiple times now with this?\n  // I guess autoMargin doesn't like being post-promise?\n\n\n  function positionCB() {\n    var innerWidth = thickPx + opts.outlinewidth / 2 + Drawing.bBox(axLayer.node()).width;\n    titleEl = titleCont.select('text');\n\n    if (titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n      var mathJaxNode = titleCont.select('.h' + ax._id + 'title-math-group').node();\n      var titleWidth;\n\n      if (mathJaxNode && ['top', 'bottom'].indexOf(titleSide) !== -1) {\n        titleWidth = Drawing.bBox(mathJaxNode).width;\n      } else {\n        // note: the formula below works for all title sides,\n        // (except for top/bottom mathjax, above)\n        // but the weird gs.l is because the titleunshift\n        // transform gets removed by Drawing.bBox\n        titleWidth = Drawing.bBox(titleCont.node()).right - xLeft - gs.l;\n      }\n\n      innerWidth = Math.max(innerWidth, titleWidth);\n    }\n\n    var outerwidth = 2 * opts.xpad + innerWidth + opts.borderwidth + opts.outlinewidth / 2;\n    var outerheight = yBottomPx - yTopPx;\n    g.select('.' + cn.cbbg).attr({\n      x: xLeft - opts.xpad - (opts.borderwidth + opts.outlinewidth) / 2,\n      y: yTopPx - yExtraPx,\n      width: Math.max(outerwidth, 2),\n      height: Math.max(outerheight + 2 * yExtraPx, 2)\n    }).call(Color.fill, opts.bgcolor).call(Color.stroke, opts.bordercolor).style('stroke-width', opts.borderwidth);\n    g.selectAll('.' + cn.cboutline).attr({\n      x: xLeft,\n      y: yTopPx + opts.ypad + (titleSide === 'top' ? titleHeight : 0),\n      width: Math.max(thickPx, 2),\n      height: Math.max(outerheight - 2 * opts.ypad - titleHeight, 2)\n    }).call(Color.stroke, opts.outlinecolor).style({\n      fill: 'none',\n      'stroke-width': opts.outlinewidth\n    }); // fix positioning for xanchor!='left'\n\n    var xoffset = ({\n      center: 0.5,\n      right: 1\n    }[opts.xanchor] || 0) * outerwidth;\n    g.attr('transform', 'translate(' + (gs.l - xoffset) + ',' + gs.t + ')'); // auto margin adjustment\n\n    var marginOpts = {};\n    var tFrac = FROM_TL[opts.yanchor];\n    var bFrac = FROM_BR[opts.yanchor];\n\n    if (opts.lenmode === 'pixels') {\n      marginOpts.y = opts.y;\n      marginOpts.t = outerheight * tFrac;\n      marginOpts.b = outerheight * bFrac;\n    } else {\n      marginOpts.t = marginOpts.b = 0;\n      marginOpts.yt = opts.y + opts.len * tFrac;\n      marginOpts.yb = opts.y - opts.len * bFrac;\n    }\n\n    var lFrac = FROM_TL[opts.xanchor];\n    var rFrac = FROM_BR[opts.xanchor];\n\n    if (opts.thicknessmode === 'pixels') {\n      marginOpts.x = opts.x;\n      marginOpts.l = outerwidth * lFrac;\n      marginOpts.r = outerwidth * rFrac;\n    } else {\n      var extraThickness = outerwidth - thickPx;\n      marginOpts.l = extraThickness * lFrac;\n      marginOpts.r = extraThickness * rFrac;\n      marginOpts.xl = opts.x - opts.thickness * lFrac;\n      marginOpts.xr = opts.x + opts.thickness * rFrac;\n    }\n\n    Plots.autoMargin(gd, opts._id, marginOpts);\n  }\n\n  return Lib.syncOrAsync([Plots.previousPromises, drawDummyTitle, drawAxis, drawCbTitle, Plots.previousPromises, positionCB], gd);\n}\n\nfunction makeEditable(g, opts, gd) {\n  var fullLayout = gd._fullLayout;\n  var gs = fullLayout._size;\n  var t0, xf, yf;\n  dragElement.init({\n    element: g.node(),\n    gd: gd,\n    prepFn: function () {\n      t0 = g.attr('transform');\n      setCursor(g);\n    },\n    moveFn: function (dx, dy) {\n      g.attr('transform', t0 + ' ' + 'translate(' + dx + ',' + dy + ')');\n      xf = dragElement.align(opts._xLeftFrac + dx / gs.w, opts._thickFrac, 0, 1, opts.xanchor);\n      yf = dragElement.align(opts._yBottomFrac - dy / gs.h, opts._lenFrac, 0, 1, opts.yanchor);\n      var csr = dragElement.getCursor(xf, yf, opts.xanchor, opts.yanchor);\n      setCursor(g, csr);\n    },\n    doneFn: function () {\n      setCursor(g);\n\n      if (xf !== undefined && yf !== undefined) {\n        var update = {};\n        update[opts._propPrefix + 'x'] = xf;\n        update[opts._propPrefix + 'y'] = yf;\n\n        if (opts._traceIndex !== undefined) {\n          Registry.call('_guiRestyle', gd, update, opts._traceIndex);\n        } else {\n          Registry.call('_guiRelayout', gd, update);\n        }\n      }\n    }\n  });\n}\n\nfunction calcLevels(gd, opts, zrange) {\n  var levelsIn = opts._levels;\n  var lineLevels = [];\n  var fillLevels = [];\n  var l;\n  var i;\n  var l0 = levelsIn.end + levelsIn.size / 100;\n  var ls = levelsIn.size;\n  var zr0 = 1.001 * zrange[0] - 0.001 * zrange[1];\n  var zr1 = 1.001 * zrange[1] - 0.001 * zrange[0];\n\n  for (i = 0; i < 1e5; i++) {\n    l = levelsIn.start + i * ls;\n    if (ls > 0 ? l >= l0 : l <= l0) break;\n    if (l > zr0 && l < zr1) lineLevels.push(l);\n  }\n\n  if (opts._fillgradient) {\n    fillLevels = [0];\n  } else if (typeof opts._fillcolor === 'function') {\n    var fillLevelsIn = opts._filllevels;\n\n    if (fillLevelsIn) {\n      l0 = fillLevelsIn.end + fillLevelsIn.size / 100;\n      ls = fillLevelsIn.size;\n\n      for (i = 0; i < 1e5; i++) {\n        l = fillLevelsIn.start + i * ls;\n        if (ls > 0 ? l >= l0 : l <= l0) break;\n        if (l > zrange[0] && l < zrange[1]) fillLevels.push(l);\n      }\n    } else {\n      fillLevels = lineLevels.map(function (v) {\n        return v - levelsIn.size / 2;\n      });\n      fillLevels.push(fillLevels[fillLevels.length - 1] + levelsIn.size);\n    }\n  } else if (opts._fillcolor && typeof opts._fillcolor === 'string') {\n    // doesn't matter what this value is, with a single value\n    // we'll make a single fill rect covering the whole bar\n    fillLevels = [0];\n  }\n\n  if (levelsIn.size < 0) {\n    lineLevels.reverse();\n    fillLevels.reverse();\n  }\n\n  return {\n    line: lineLevels,\n    fill: fillLevels\n  };\n}\n\nfunction mockColorBarAxis(gd, opts, zrange) {\n  var fullLayout = gd._fullLayout;\n  var cbAxisIn = {\n    type: 'linear',\n    range: zrange,\n    tickmode: opts.tickmode,\n    nticks: opts.nticks,\n    tick0: opts.tick0,\n    dtick: opts.dtick,\n    tickvals: opts.tickvals,\n    ticktext: opts.ticktext,\n    ticks: opts.ticks,\n    ticklen: opts.ticklen,\n    tickwidth: opts.tickwidth,\n    tickcolor: opts.tickcolor,\n    showticklabels: opts.showticklabels,\n    tickfont: opts.tickfont,\n    tickangle: opts.tickangle,\n    tickformat: opts.tickformat,\n    exponentformat: opts.exponentformat,\n    separatethousands: opts.separatethousands,\n    showexponent: opts.showexponent,\n    showtickprefix: opts.showtickprefix,\n    tickprefix: opts.tickprefix,\n    showticksuffix: opts.showticksuffix,\n    ticksuffix: opts.ticksuffix,\n    title: opts.title,\n    showline: true,\n    anchor: 'free',\n    side: 'right',\n    position: 1\n  };\n  var cbAxisOut = {\n    type: 'linear',\n    _id: 'y' + opts._id\n  };\n  var axisOptions = {\n    letter: 'y',\n    font: fullLayout.font,\n    noHover: true,\n    noTickson: true,\n    calendar: fullLayout.calendar // not really necessary (yet?)\n\n  };\n\n  function coerce(attr, dflt) {\n    return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n  }\n\n  handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n  handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n  return cbAxisOut;\n}\n\nmodule.exports = {\n  draw: draw\n};","map":{"version":3,"sources":["/Users/jingkaisu/Documents/HRfront/HalliganReviews/web_project/node_modules/plotly.js/src/components/colorbar/draw.js"],"names":["d3","require","tinycolor","Plots","Registry","Axes","dragElement","Lib","extendFlat","setCursor","Drawing","Color","Titles","svgTextUtils","flipScale","handleAxisDefaults","handleAxisPositionDefaults","axisLayoutAttrs","alignmentConstants","LINE_SPACING","FROM_TL","FROM_BR","cn","draw","gd","fullLayout","_fullLayout","colorBars","_infolayer","selectAll","colorbar","data","makeColorBarData","opts","_id","enter","append","attr","classed","each","g","select","ensureSingle","cbbg","cbfills","cblines","cbaxis","s","crisp","cbtitleunshift","cbtitle","cboutline","done","drawColorBar","then","_promises","push","_context","edits","colorbarPosition","makeEditable","exit","autoMargin","remove","order","calcdata","out","cont","trace","cbOpt","initOpts","_fillcolor","_line","color","width","dash","_levels","start","end","size","_filllevels","_fillgradient","_zrange","calcOpts","calc","reversescale","colorscale","min","max","i","length","cd","moduleOpts","_module","visible","allowsMultiplotCbs","Array","isArray","cbOpts","j","contName","container","showscale","uid","_traceIndex","index","_propPrefix","_meta","k","_colorAxes","colorAxOpts","gs","_size","fillColor","line","title","titleSide","side","zrange","extent","domain","lineColormap","fillColormap","levelsIn","levelsOut","calcLevels","fillLevels","fill","lineLevels","thickPx","Math","round","thickness","thicknessmode","w","thickFrac","lenPx","len","lenmode","h","lenFrac","xpadFrac","xpad","yExtraPx","borderwidth","outlinewidth","ypadFrac","ypad","xLeft","x","xLeftFrac","middle","right","xanchor","yBottomFrac","y","top","bottom","yanchor","yBottomPx","yTopPx","_lenFrac","_thickFrac","_xLeftFrac","_yBottomFrac","ax","_axis","mockColorBarAxis","position","indexOf","titlex","titley","tickmode","tick0","dtick","autoNtick","constrain","dtFactor","nticks","dtexp","pow","floor","log","LN10","roundUp","abs","setScale","l","t","titleCont","axLayer","titleEl","titleHeight","drawTitle","titleClass","titleOpts","dfltTitleOpts","propContainer","propName","traceIndex","placeholder","_dfltTitle","containerGroup","otherClass","charAt","substr","drawDummyTitle","fontSize","font","attributes","drawCbTitle","_offset","_length","showticklabels","avoid","selection","offsetLeft","offsetTop","maxShift","transform","rotate","offset","drawAxis","titleGroup","titleText","titleTrans","mathJaxNode","node","lineSize","parseInt","style","bBox","height","jsPlaceholder","nlines","lineCount","fills","cbfill","zBounds","map","c2p","sort","a","b","d","z","fillEl","gradient","colorString","replace","toHexString","lines","cbline","call","lineGroupStyle","shift","ticks","vals","calcTicks","transFn","makeTransFn","tickSign","getTickSigns","drawTicks","clipEnds","layer","path","makeTickPath","drawLabels","labelFns","makeLabelFns","positionCB","innerWidth","titleWidth","outerwidth","outerheight","bgcolor","stroke","bordercolor","outlinecolor","xoffset","center","marginOpts","tFrac","bFrac","yt","yb","lFrac","rFrac","r","extraThickness","xl","xr","syncOrAsync","previousPromises","t0","xf","yf","init","element","prepFn","moveFn","dx","dy","align","csr","getCursor","doneFn","undefined","update","l0","ls","zr0","zr1","fillLevelsIn","v","reverse","cbAxisIn","type","range","tickvals","ticktext","ticklen","tickwidth","tickcolor","tickfont","tickangle","tickformat","exponentformat","separatethousands","showexponent","showtickprefix","tickprefix","showticksuffix","ticksuffix","showline","anchor","cbAxisOut","axisOptions","letter","noHover","noTickson","calendar","coerce","dflt","module","exports"],"mappings":"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","sourcesContent":["/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar d3 = require('d3');\nvar tinycolor = require('tinycolor2');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Axes = require('../../plots/cartesian/axes');\nvar dragElement = require('../dragelement');\nvar Lib = require('../../lib');\nvar extendFlat = require('../../lib/extend').extendFlat;\nvar setCursor = require('../../lib/setcursor');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar Titles = require('../titles');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar flipScale = require('../colorscale/helpers').flipScale;\n\nvar handleAxisDefaults = require('../../plots/cartesian/axis_defaults');\nvar handleAxisPositionDefaults = require('../../plots/cartesian/position_defaults');\nvar axisLayoutAttrs = require('../../plots/cartesian/layout_attributes');\n\nvar alignmentConstants = require('../../constants/alignment');\nvar LINE_SPACING = alignmentConstants.LINE_SPACING;\nvar FROM_TL = alignmentConstants.FROM_TL;\nvar FROM_BR = alignmentConstants.FROM_BR;\n\nvar cn = require('./constants').cn;\n\nfunction draw(gd) {\n    var fullLayout = gd._fullLayout;\n\n    var colorBars = fullLayout._infolayer\n        .selectAll('g.' + cn.colorbar)\n        .data(makeColorBarData(gd), function(opts) { return opts._id; });\n\n    colorBars.enter().append('g')\n        .attr('class', function(opts) { return opts._id; })\n        .classed(cn.colorbar, true);\n\n    colorBars.each(function(opts) {\n        var g = d3.select(this);\n\n        Lib.ensureSingle(g, 'rect', cn.cbbg);\n        Lib.ensureSingle(g, 'g', cn.cbfills);\n        Lib.ensureSingle(g, 'g', cn.cblines);\n        Lib.ensureSingle(g, 'g', cn.cbaxis, function(s) { s.classed(cn.crisp, true); });\n        Lib.ensureSingle(g, 'g', cn.cbtitleunshift, function(s) { s.append('g').classed(cn.cbtitle, true); });\n        Lib.ensureSingle(g, 'rect', cn.cboutline);\n\n        var done = drawColorBar(g, opts, gd);\n        if(done && done.then) (gd._promises || []).push(done);\n\n        if(gd._context.edits.colorbarPosition) {\n            makeEditable(g, opts, gd);\n        }\n    });\n\n    colorBars.exit()\n        .each(function(opts) { Plots.autoMargin(gd, opts._id); })\n        .remove();\n\n    colorBars.order();\n}\n\nfunction makeColorBarData(gd) {\n    var fullLayout = gd._fullLayout;\n    var calcdata = gd.calcdata;\n    var out = [];\n\n    // single out item\n    var opts;\n    // colorbar attr parent container\n    var cont;\n    // trace attr container\n    var trace;\n    // colorbar options\n    var cbOpt;\n\n    function initOpts(opts) {\n        return extendFlat(opts, {\n            // fillcolor can be a d3 scale, domain is z values, range is colors\n            // or leave it out for no fill,\n            // or set to a string constant for single-color fill\n            _fillcolor: null,\n            // line.color has the same options as fillcolor\n            _line: {color: null, width: null, dash: null},\n            // levels of lines to draw.\n            // note that this DOES NOT determine the extent of the bar\n            // that's given by the domain of fillcolor\n            // (or line.color if no fillcolor domain)\n            _levels: {start: null, end: null, size: null},\n            // separate fill levels (for example, heatmap coloring of a\n            // contour map) if this is omitted, fillcolors will be\n            // evaluated halfway between levels\n            _filllevels: null,\n            // for continuous colorscales: fill with a gradient instead of explicit levels\n            // value should be the colorscale [[0, c0], [v1, c1], ..., [1, cEnd]]\n            _fillgradient: null,\n            // when using a gradient, we need the data range specified separately\n            _zrange: null\n        });\n    }\n\n    function calcOpts() {\n        if(typeof cbOpt.calc === 'function') {\n            cbOpt.calc(gd, trace, opts);\n        } else {\n            opts._fillgradient = cont.reversescale ?\n                flipScale(cont.colorscale) :\n                cont.colorscale;\n            opts._zrange = [cont[cbOpt.min], cont[cbOpt.max]];\n        }\n    }\n\n    for(var i = 0; i < calcdata.length; i++) {\n        var cd = calcdata[i];\n        trace = cd[0].trace;\n        var moduleOpts = trace._module.colorbar;\n\n        if(trace.visible === true && moduleOpts) {\n            var allowsMultiplotCbs = Array.isArray(moduleOpts);\n            var cbOpts = allowsMultiplotCbs ? moduleOpts : [moduleOpts];\n\n            for(var j = 0; j < cbOpts.length; j++) {\n                cbOpt = cbOpts[j];\n                var contName = cbOpt.container;\n                cont = contName ? trace[contName] : trace;\n\n                if(cont && cont.showscale) {\n                    opts = initOpts(cont.colorbar);\n                    opts._id = 'cb' + trace.uid + (allowsMultiplotCbs && contName ? '-' + contName : '');\n                    opts._traceIndex = trace.index;\n                    opts._propPrefix = (contName ? contName + '.' : '') + 'colorbar.';\n                    opts._meta = trace._meta;\n                    calcOpts();\n                    out.push(opts);\n                }\n            }\n        }\n    }\n\n    for(var k in fullLayout._colorAxes) {\n        cont = fullLayout[k];\n\n        if(cont.showscale) {\n            var colorAxOpts = fullLayout._colorAxes[k];\n\n            opts = initOpts(cont.colorbar);\n            opts._id = 'cb' + k;\n            opts._propPrefix = k + '.colorbar.';\n            opts._meta = fullLayout._meta;\n\n            cbOpt = {min: 'cmin', max: 'cmax'};\n            if(colorAxOpts[0] !== 'heatmap') {\n                trace = colorAxOpts[1];\n                cbOpt.calc = trace._module.colorbar.calc;\n            }\n\n            calcOpts();\n            out.push(opts);\n        }\n    }\n\n    return out;\n}\n\nfunction drawColorBar(g, opts, gd) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n\n    var fillColor = opts._fillcolor;\n    var line = opts._line;\n    var title = opts.title;\n    var titleSide = title.side;\n\n    var zrange = opts._zrange ||\n        d3.extent((typeof fillColor === 'function' ? fillColor : line.color).domain());\n\n    var lineColormap = typeof line.color === 'function' ?\n        line.color :\n        function() { return line.color; };\n    var fillColormap = typeof fillColor === 'function' ?\n        fillColor :\n        function() { return fillColor; };\n\n    var levelsIn = opts._levels;\n    var levelsOut = calcLevels(gd, opts, zrange);\n    var fillLevels = levelsOut.fill;\n    var lineLevels = levelsOut.line;\n\n    // we calculate pixel sizes based on the specified graph size,\n    // not the actual (in case something pushed the margins around)\n    // which is a little odd but avoids an odd iterative effect\n    // when the colorbar itself is pushing the margins.\n    // but then the fractional size is calculated based on the\n    // actual graph size, so that the axes will size correctly.\n    var thickPx = Math.round(opts.thickness * (opts.thicknessmode === 'fraction' ? gs.w : 1));\n    var thickFrac = thickPx / gs.w;\n    var lenPx = Math.round(opts.len * (opts.lenmode === 'fraction' ? gs.h : 1));\n    var lenFrac = lenPx / gs.h;\n    var xpadFrac = opts.xpad / gs.w;\n    var yExtraPx = (opts.borderwidth + opts.outlinewidth) / 2;\n    var ypadFrac = opts.ypad / gs.h;\n\n    // x positioning: do it initially just for left anchor,\n    // then fix at the end (since we don't know the width yet)\n    var xLeft = Math.round(opts.x * gs.w + opts.xpad);\n    // for dragging... this is getting a little muddled...\n    var xLeftFrac = opts.x - thickFrac * ({middle: 0.5, right: 1}[opts.xanchor] || 0);\n\n    // y positioning we can do correctly from the start\n    var yBottomFrac = opts.y + lenFrac * (({top: -0.5, bottom: 0.5}[opts.yanchor] || 0) - 0.5);\n    var yBottomPx = Math.round(gs.h * (1 - yBottomFrac));\n    var yTopPx = yBottomPx - lenPx;\n\n    // stash a few things for makeEditable\n    opts._lenFrac = lenFrac;\n    opts._thickFrac = thickFrac;\n    opts._xLeftFrac = xLeftFrac;\n    opts._yBottomFrac = yBottomFrac;\n\n    // stash mocked axis for contour label formatting\n    var ax = opts._axis = mockColorBarAxis(gd, opts, zrange);\n\n    // position can't go in through supplyDefaults\n    // because that restricts it to [0,1]\n    ax.position = opts.x + xpadFrac + thickFrac;\n\n    if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n        ax.title.side = titleSide;\n        ax.titlex = opts.x + xpadFrac;\n        ax.titley = yBottomFrac + (title.side === 'top' ? lenFrac - ypadFrac : ypadFrac);\n    }\n\n    if(line.color && opts.tickmode === 'auto') {\n        ax.tickmode = 'linear';\n        ax.tick0 = levelsIn.start;\n        var dtick = levelsIn.size;\n        // expand if too many contours, so we don't get too many ticks\n        var autoNtick = Lib.constrain((yBottomPx - yTopPx) / 50, 4, 15) + 1;\n        var dtFactor = (zrange[1] - zrange[0]) / ((opts.nticks || autoNtick) * dtick);\n        if(dtFactor > 1) {\n            var dtexp = Math.pow(10, Math.floor(Math.log(dtFactor) / Math.LN10));\n            dtick *= dtexp * Lib.roundUp(dtFactor / dtexp, [2, 5, 10]);\n            // if the contours are at round multiples, reset tick0\n            // so they're still at round multiples. Otherwise,\n            // keep the first label on the first contour level\n            if((Math.abs(levelsIn.start) / levelsIn.size + 1e-6) % 1 < 2e-6) {\n                ax.tick0 = 0;\n            }\n        }\n        ax.dtick = dtick;\n    }\n\n    // set domain after init, because we may want to\n    // allow it outside [0,1]\n    ax.domain = [\n        yBottomFrac + ypadFrac,\n        yBottomFrac + lenFrac - ypadFrac\n    ];\n\n    ax.setScale();\n\n    g.attr('transform', 'translate(' + Math.round(gs.l) + ',' + Math.round(gs.t) + ')');\n\n    var titleCont = g.select('.' + cn.cbtitleunshift)\n        .attr('transform', 'translate(-' + Math.round(gs.l) + ',-' + Math.round(gs.t) + ')');\n\n    var axLayer = g.select('.' + cn.cbaxis);\n    var titleEl;\n    var titleHeight = 0;\n\n    function drawTitle(titleClass, titleOpts) {\n        var dfltTitleOpts = {\n            propContainer: ax,\n            propName: opts._propPrefix + 'title',\n            traceIndex: opts._traceIndex,\n            _meta: opts._meta,\n            placeholder: fullLayout._dfltTitle.colorbar,\n            containerGroup: g.select('.' + cn.cbtitle)\n        };\n\n        // this class-to-rotate thing with convertToTspans is\n        // getting hackier and hackier... delete groups with the\n        // wrong class (in case earlier the colorbar was drawn on\n        // a different side, I think?)\n        var otherClass = titleClass.charAt(0) === 'h' ?\n            titleClass.substr(1) :\n            'h' + titleClass;\n        g.selectAll('.' + otherClass + ',.' + otherClass + '-math-group').remove();\n\n        Titles.draw(gd, titleClass, extendFlat(dfltTitleOpts, titleOpts || {}));\n    }\n\n    function drawDummyTitle() {\n        if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n            // draw the title so we know how much room it needs\n            // when we squish the axis. This one only applies to\n            // top or bottom titles, not right side.\n            var x = gs.l + (opts.x + xpadFrac) * gs.w;\n            var fontSize = ax.title.font.size;\n            var y;\n\n            if(titleSide === 'top') {\n                y = (1 - (yBottomFrac + lenFrac - ypadFrac)) * gs.h +\n                    gs.t + 3 + fontSize * 0.75;\n            } else {\n                y = (1 - (yBottomFrac + ypadFrac)) * gs.h +\n                    gs.t - 3 - fontSize * 0.25;\n            }\n            drawTitle(ax._id + 'title', {\n                attributes: {x: x, y: y, 'text-anchor': 'start'}\n            });\n        }\n    }\n\n    function drawCbTitle() {\n        if(['top', 'bottom'].indexOf(titleSide) === -1) {\n            var fontSize = ax.title.font.size;\n            var y = ax._offset + ax._length / 2;\n            var x = gs.l + (ax.position || 0) * gs.w + ((ax.side === 'right') ?\n                10 + fontSize * ((ax.showticklabels ? 1 : 0.5)) :\n                -10 - fontSize * ((ax.showticklabels ? 0.5 : 0)));\n\n            // the 'h' + is a hack to get around the fact that\n            // convertToTspans rotates any 'y...' class by 90 degrees.\n            // TODO: find a better way to control this.\n            drawTitle('h' + ax._id + 'title', {\n                avoid: {\n                    selection: d3.select(gd).selectAll('g.' + ax._id + 'tick'),\n                    side: titleSide,\n                    offsetLeft: gs.l,\n                    offsetTop: 0,\n                    maxShift: fullLayout.width\n                },\n                attributes: {x: x, y: y, 'text-anchor': 'middle'},\n                transform: {rotate: '-90', offset: 0}\n            });\n        }\n    }\n\n    function drawAxis() {\n        if(['top', 'bottom'].indexOf(titleSide) !== -1) {\n            // squish the axis top to make room for the title\n            var titleGroup = g.select('.' + cn.cbtitle);\n            var titleText = titleGroup.select('text');\n            var titleTrans = [-opts.outlinewidth / 2, opts.outlinewidth / 2];\n            var mathJaxNode = titleGroup\n                .select('.h' + ax._id + 'title-math-group')\n                .node();\n            var lineSize = 15.6;\n            if(titleText.node()) {\n                lineSize = parseInt(titleText.node().style.fontSize, 10) * LINE_SPACING;\n            }\n            if(mathJaxNode) {\n                titleHeight = Drawing.bBox(mathJaxNode).height;\n                if(titleHeight > lineSize) {\n                    // not entirely sure how mathjax is doing\n                    // vertical alignment, but this seems to work.\n                    titleTrans[1] -= (titleHeight - lineSize) / 2;\n                }\n            } else if(titleText.node() && !titleText.classed(cn.jsPlaceholder)) {\n                titleHeight = Drawing.bBox(titleText.node()).height;\n            }\n            if(titleHeight) {\n                // buffer btwn colorbar and title\n                // TODO: configurable\n                titleHeight += 5;\n\n                if(titleSide === 'top') {\n                    ax.domain[1] -= titleHeight / gs.h;\n                    titleTrans[1] *= -1;\n                } else {\n                    ax.domain[0] += titleHeight / gs.h;\n                    var nlines = svgTextUtils.lineCount(titleText);\n                    titleTrans[1] += (1 - nlines) * lineSize;\n                }\n\n                titleGroup.attr('transform', 'translate(' + titleTrans + ')');\n                ax.setScale();\n            }\n        }\n\n        g.selectAll('.' + cn.cbfills + ',.' + cn.cblines)\n            .attr('transform', 'translate(0,' + Math.round(gs.h * (1 - ax.domain[1])) + ')');\n\n        axLayer.attr('transform', 'translate(0,' + Math.round(-gs.t) + ')');\n\n        var fills = g.select('.' + cn.cbfills)\n            .selectAll('rect.' + cn.cbfill)\n            .data(fillLevels);\n        fills.enter().append('rect')\n            .classed(cn.cbfill, true)\n            .style('stroke', 'none');\n        fills.exit().remove();\n\n        var zBounds = zrange\n            .map(ax.c2p)\n            .map(Math.round)\n            .sort(function(a, b) { return a - b; });\n\n        fills.each(function(d, i) {\n            var z = [\n                (i === 0) ? zrange[0] : (fillLevels[i] + fillLevels[i - 1]) / 2,\n                (i === fillLevels.length - 1) ? zrange[1] : (fillLevels[i] + fillLevels[i + 1]) / 2\n            ]\n            .map(ax.c2p)\n            .map(Math.round);\n\n            // offset the side adjoining the next rectangle so they\n            // overlap, to prevent antialiasing gaps\n            z[1] = Lib.constrain(z[1] + (z[1] > z[0]) ? 1 : -1, zBounds[0], zBounds[1]);\n\n\n            // Colorbar cannot currently support opacities so we\n            // use an opaque fill even when alpha channels present\n            var fillEl = d3.select(this).attr({\n                x: xLeft,\n                width: Math.max(thickPx, 2),\n                y: d3.min(z),\n                height: Math.max(d3.max(z) - d3.min(z), 2),\n            });\n\n            if(opts._fillgradient) {\n                Drawing.gradient(fillEl, gd, opts._id, 'vertical', opts._fillgradient, 'fill');\n            } else {\n                // tinycolor can't handle exponents and\n                // at this scale, removing it makes no difference.\n                var colorString = fillColormap(d).replace('e-', '');\n                fillEl.attr('fill', tinycolor(colorString).toHexString());\n            }\n        });\n\n        var lines = g.select('.' + cn.cblines)\n            .selectAll('path.' + cn.cbline)\n            .data(line.color && line.width ? lineLevels : []);\n        lines.enter().append('path')\n            .classed(cn.cbline, true);\n        lines.exit().remove();\n        lines.each(function(d) {\n            d3.select(this)\n                .attr('d', 'M' + xLeft + ',' +\n                    (Math.round(ax.c2p(d)) + (line.width / 2) % 1) + 'h' + thickPx)\n                .call(Drawing.lineGroupStyle, line.width, lineColormap(d), line.dash);\n        });\n\n        // force full redraw of labels and ticks\n        axLayer.selectAll('g.' + ax._id + 'tick,path').remove();\n\n        var shift = xLeft + thickPx +\n            (opts.outlinewidth || 0) / 2 - (opts.ticks === 'outside' ? 1 : 0);\n\n        var vals = Axes.calcTicks(ax);\n        var transFn = Axes.makeTransFn(ax);\n        var tickSign = Axes.getTickSigns(ax)[2];\n\n        Axes.drawTicks(gd, ax, {\n            vals: ax.ticks === 'inside' ? Axes.clipEnds(ax, vals) : vals,\n            layer: axLayer,\n            path: Axes.makeTickPath(ax, shift, tickSign),\n            transFn: transFn\n        });\n\n        return Axes.drawLabels(gd, ax, {\n            vals: vals,\n            layer: axLayer,\n            transFn: transFn,\n            labelFns: Axes.makeLabelFns(ax, shift)\n        });\n    }\n\n    // wait for the axis & title to finish rendering before\n    // continuing positioning\n    // TODO: why are we redrawing multiple times now with this?\n    // I guess autoMargin doesn't like being post-promise?\n    function positionCB() {\n        var innerWidth = thickPx + opts.outlinewidth / 2 + Drawing.bBox(axLayer.node()).width;\n        titleEl = titleCont.select('text');\n\n        if(titleEl.node() && !titleEl.classed(cn.jsPlaceholder)) {\n            var mathJaxNode = titleCont.select('.h' + ax._id + 'title-math-group').node();\n            var titleWidth;\n            if(mathJaxNode && ['top', 'bottom'].indexOf(titleSide) !== -1) {\n                titleWidth = Drawing.bBox(mathJaxNode).width;\n            } else {\n                // note: the formula below works for all title sides,\n                // (except for top/bottom mathjax, above)\n                // but the weird gs.l is because the titleunshift\n                // transform gets removed by Drawing.bBox\n                titleWidth = Drawing.bBox(titleCont.node()).right - xLeft - gs.l;\n            }\n            innerWidth = Math.max(innerWidth, titleWidth);\n        }\n\n        var outerwidth = 2 * opts.xpad + innerWidth + opts.borderwidth + opts.outlinewidth / 2;\n        var outerheight = yBottomPx - yTopPx;\n\n        g.select('.' + cn.cbbg).attr({\n            x: xLeft - opts.xpad - (opts.borderwidth + opts.outlinewidth) / 2,\n            y: yTopPx - yExtraPx,\n            width: Math.max(outerwidth, 2),\n            height: Math.max(outerheight + 2 * yExtraPx, 2)\n        })\n        .call(Color.fill, opts.bgcolor)\n        .call(Color.stroke, opts.bordercolor)\n        .style('stroke-width', opts.borderwidth);\n\n        g.selectAll('.' + cn.cboutline).attr({\n            x: xLeft,\n            y: yTopPx + opts.ypad + (titleSide === 'top' ? titleHeight : 0),\n            width: Math.max(thickPx, 2),\n            height: Math.max(outerheight - 2 * opts.ypad - titleHeight, 2)\n        })\n        .call(Color.stroke, opts.outlinecolor)\n        .style({\n            fill: 'none',\n            'stroke-width': opts.outlinewidth\n        });\n\n        // fix positioning for xanchor!='left'\n        var xoffset = ({center: 0.5, right: 1}[opts.xanchor] || 0) * outerwidth;\n        g.attr('transform', 'translate(' + (gs.l - xoffset) + ',' + gs.t + ')');\n\n        // auto margin adjustment\n        var marginOpts = {};\n        var tFrac = FROM_TL[opts.yanchor];\n        var bFrac = FROM_BR[opts.yanchor];\n        if(opts.lenmode === 'pixels') {\n            marginOpts.y = opts.y;\n            marginOpts.t = outerheight * tFrac;\n            marginOpts.b = outerheight * bFrac;\n        } else {\n            marginOpts.t = marginOpts.b = 0;\n            marginOpts.yt = opts.y + opts.len * tFrac;\n            marginOpts.yb = opts.y - opts.len * bFrac;\n        }\n\n        var lFrac = FROM_TL[opts.xanchor];\n        var rFrac = FROM_BR[opts.xanchor];\n        if(opts.thicknessmode === 'pixels') {\n            marginOpts.x = opts.x;\n            marginOpts.l = outerwidth * lFrac;\n            marginOpts.r = outerwidth * rFrac;\n        } else {\n            var extraThickness = outerwidth - thickPx;\n            marginOpts.l = extraThickness * lFrac;\n            marginOpts.r = extraThickness * rFrac;\n            marginOpts.xl = opts.x - opts.thickness * lFrac;\n            marginOpts.xr = opts.x + opts.thickness * rFrac;\n        }\n\n        Plots.autoMargin(gd, opts._id, marginOpts);\n    }\n\n    return Lib.syncOrAsync([\n        Plots.previousPromises,\n        drawDummyTitle,\n        drawAxis,\n        drawCbTitle,\n        Plots.previousPromises,\n        positionCB\n    ], gd);\n}\n\nfunction makeEditable(g, opts, gd) {\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n    var t0, xf, yf;\n\n    dragElement.init({\n        element: g.node(),\n        gd: gd,\n        prepFn: function() {\n            t0 = g.attr('transform');\n            setCursor(g);\n        },\n        moveFn: function(dx, dy) {\n            g.attr('transform', t0 + ' ' + 'translate(' + dx + ',' + dy + ')');\n\n            xf = dragElement.align(opts._xLeftFrac + (dx / gs.w), opts._thickFrac,\n                0, 1, opts.xanchor);\n            yf = dragElement.align(opts._yBottomFrac - (dy / gs.h), opts._lenFrac,\n                0, 1, opts.yanchor);\n\n            var csr = dragElement.getCursor(xf, yf, opts.xanchor, opts.yanchor);\n            setCursor(g, csr);\n        },\n        doneFn: function() {\n            setCursor(g);\n\n            if(xf !== undefined && yf !== undefined) {\n                var update = {};\n                update[opts._propPrefix + 'x'] = xf;\n                update[opts._propPrefix + 'y'] = yf;\n                if(opts._traceIndex !== undefined) {\n                    Registry.call('_guiRestyle', gd, update, opts._traceIndex);\n                } else {\n                    Registry.call('_guiRelayout', gd, update);\n                }\n            }\n        }\n    });\n}\n\nfunction calcLevels(gd, opts, zrange) {\n    var levelsIn = opts._levels;\n    var lineLevels = [];\n    var fillLevels = [];\n    var l;\n    var i;\n\n    var l0 = levelsIn.end + levelsIn.size / 100;\n    var ls = levelsIn.size;\n    var zr0 = (1.001 * zrange[0] - 0.001 * zrange[1]);\n    var zr1 = (1.001 * zrange[1] - 0.001 * zrange[0]);\n\n    for(i = 0; i < 1e5; i++) {\n        l = levelsIn.start + i * ls;\n        if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n        if(l > zr0 && l < zr1) lineLevels.push(l);\n    }\n\n    if(opts._fillgradient) {\n        fillLevels = [0];\n    } else if(typeof opts._fillcolor === 'function') {\n        var fillLevelsIn = opts._filllevels;\n\n        if(fillLevelsIn) {\n            l0 = fillLevelsIn.end + fillLevelsIn.size / 100;\n            ls = fillLevelsIn.size;\n            for(i = 0; i < 1e5; i++) {\n                l = fillLevelsIn.start + i * ls;\n                if(ls > 0 ? (l >= l0) : (l <= l0)) break;\n                if(l > zrange[0] && l < zrange[1]) fillLevels.push(l);\n            }\n        } else {\n            fillLevels = lineLevels.map(function(v) {\n                return v - levelsIn.size / 2;\n            });\n            fillLevels.push(fillLevels[fillLevels.length - 1] + levelsIn.size);\n        }\n    } else if(opts._fillcolor && typeof opts._fillcolor === 'string') {\n        // doesn't matter what this value is, with a single value\n        // we'll make a single fill rect covering the whole bar\n        fillLevels = [0];\n    }\n\n    if(levelsIn.size < 0) {\n        lineLevels.reverse();\n        fillLevels.reverse();\n    }\n\n    return {line: lineLevels, fill: fillLevels};\n}\n\nfunction mockColorBarAxis(gd, opts, zrange) {\n    var fullLayout = gd._fullLayout;\n\n    var cbAxisIn = {\n        type: 'linear',\n        range: zrange,\n        tickmode: opts.tickmode,\n        nticks: opts.nticks,\n        tick0: opts.tick0,\n        dtick: opts.dtick,\n        tickvals: opts.tickvals,\n        ticktext: opts.ticktext,\n        ticks: opts.ticks,\n        ticklen: opts.ticklen,\n        tickwidth: opts.tickwidth,\n        tickcolor: opts.tickcolor,\n        showticklabels: opts.showticklabels,\n        tickfont: opts.tickfont,\n        tickangle: opts.tickangle,\n        tickformat: opts.tickformat,\n        exponentformat: opts.exponentformat,\n        separatethousands: opts.separatethousands,\n        showexponent: opts.showexponent,\n        showtickprefix: opts.showtickprefix,\n        tickprefix: opts.tickprefix,\n        showticksuffix: opts.showticksuffix,\n        ticksuffix: opts.ticksuffix,\n        title: opts.title,\n        showline: true,\n        anchor: 'free',\n        side: 'right',\n        position: 1\n    };\n\n    var cbAxisOut = {\n        type: 'linear',\n        _id: 'y' + opts._id\n    };\n\n    var axisOptions = {\n        letter: 'y',\n        font: fullLayout.font,\n        noHover: true,\n        noTickson: true,\n        calendar: fullLayout.calendar  // not really necessary (yet?)\n    };\n\n    function coerce(attr, dflt) {\n        return Lib.coerce(cbAxisIn, cbAxisOut, axisLayoutAttrs, attr, dflt);\n    }\n\n    handleAxisDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions, fullLayout);\n    handleAxisPositionDefaults(cbAxisIn, cbAxisOut, coerce, axisOptions);\n\n    return cbAxisOut;\n}\n\nmodule.exports = {\n    draw: draw\n};\n"]},"metadata":{},"sourceType":"script"}