{"ast":null,"code":"/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar isNumeric = require('fast-isnumeric');\n\nvar Plots = require('../../plots/plots');\n\nvar Registry = require('../../registry');\n\nvar Lib = require('../../lib');\n\nvar Drawing = require('../drawing');\n\nvar Color = require('../color');\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar interactConstants = require('../../constants/interactions');\n\nvar OPPOSITE_SIDE = require('../../constants/alignment').OPPOSITE_SIDE;\n\nvar numStripRE = / [XY][0-9]* /;\n/**\n * Titles - (re)draw titles on the axes and plot:\n * @param {DOM element} gd - the graphDiv\n * @param {string} titleClass - the css class of this title\n * @param {object} options - how and what to draw\n *      propContainer - the layout object containing `title` and `titlefont`\n *          attributes that apply to this title\n *      propName - the full name of the title property (for Plotly.relayout)\n *      [traceIndex] - include only if this property applies to one trace\n *          (such as a colorbar title) - then editing pipes to Plotly.restyle\n *          instead of Plotly.relayout\n *      placeholder - placeholder text for an empty editable title\n *      [avoid] {object} - include if this title should move to avoid other elements\n *          selection - d3 selection of elements to avoid\n *          side - which direction to move if there is a conflict\n *          [offsetLeft] - if these elements are subject to a translation\n *              wrt the title element\n *          [offsetTop]\n *      attributes {object} - position and alignment attributes\n *          x - pixels\n *          y - pixels\n *          text-anchor - start|middle|end\n *      transform {object} - how to transform the title after positioning\n *          rotate - degrees\n *          offset - shift up/down in the rotated frame (unused?)\n *      containerGroup - if an svg <g> element already exists to hold this\n *          title, include here. Otherwise it will go in fullLayout._infolayer\n *      _meta {object (optional} - meta key-value to for title with\n *          Lib.templateString, default to fullLayout._meta, if not provided\n *\n *  @return {selection} d3 selection of title container group\n */\n\nfunction draw(gd, titleClass, options) {\n  var cont = options.propContainer;\n  var prop = options.propName;\n  var placeholder = options.placeholder;\n  var traceIndex = options.traceIndex;\n  var avoid = options.avoid || {};\n  var attributes = options.attributes;\n  var transform = options.transform;\n  var group = options.containerGroup;\n  var fullLayout = gd._fullLayout;\n  var opacity = 1;\n  var isplaceholder = false;\n  var title = cont.title;\n  var txt = (title && title.text ? title.text : '').trim();\n  var font = title && title.font ? title.font : {};\n  var fontFamily = font.family;\n  var fontSize = font.size;\n  var fontColor = font.color; // only make this title editable if we positively identify its property\n  // as one that has editing enabled.\n\n  var editAttr;\n  if (prop === 'title.text') editAttr = 'titleText';else if (prop.indexOf('axis') !== -1) editAttr = 'axisTitleText';else if (prop.indexOf('colorbar' !== -1)) editAttr = 'colorbarTitleText';\n  var editable = gd._context.edits[editAttr];\n  if (txt === '') opacity = 0; // look for placeholder text while stripping out numbers from eg X2, Y3\n  // this is just for backward compatibility with the old version that had\n  // \"Click to enter X2 title\" and may have gotten saved in some old plots,\n  // we don't want this to show up when these are displayed.\n  else if (txt.replace(numStripRE, ' % ') === placeholder.replace(numStripRE, ' % ')) {\n      opacity = 0.2;\n      isplaceholder = true;\n      if (!editable) txt = '';\n    }\n\n  if (options._meta) {\n    txt = Lib.templateString(txt, options._meta);\n  } else if (fullLayout._meta) {\n    txt = Lib.templateString(txt, fullLayout._meta);\n  }\n\n  var elShouldExist = txt || editable;\n\n  if (!group) {\n    group = Lib.ensureSingle(fullLayout._infolayer, 'g', 'g-' + titleClass);\n  }\n\n  var el = group.selectAll('text').data(elShouldExist ? [0] : []);\n  el.enter().append('text');\n  el.text(txt) // this is hacky, but convertToTspans uses the class\n  // to determine whether to rotate mathJax...\n  // so we need to clear out any old class and put the\n  // correct one (only relevant for colorbars, at least\n  // for now) - ie don't use .classed\n  .attr('class', titleClass);\n  el.exit().remove();\n  if (!elShouldExist) return group;\n\n  function titleLayout(titleEl) {\n    Lib.syncOrAsync([drawTitle, scootTitle], titleEl);\n  }\n\n  function drawTitle(titleEl) {\n    var transformVal;\n\n    if (transform) {\n      transformVal = '';\n\n      if (transform.rotate) {\n        transformVal += 'rotate(' + [transform.rotate, attributes.x, attributes.y] + ')';\n      }\n\n      if (transform.offset) {\n        transformVal += 'translate(0, ' + transform.offset + ')';\n      }\n    } else {\n      transformVal = null;\n    }\n\n    titleEl.attr('transform', transformVal);\n    titleEl.style({\n      'font-family': fontFamily,\n      'font-size': d3.round(fontSize, 2) + 'px',\n      fill: Color.rgb(fontColor),\n      opacity: opacity * Color.opacity(fontColor),\n      'font-weight': Plots.fontWeight\n    }).attr(attributes).call(svgTextUtils.convertToTspans, gd);\n    return Plots.previousPromises(gd);\n  }\n\n  function scootTitle(titleElIn) {\n    var titleGroup = d3.select(titleElIn.node().parentNode);\n\n    if (avoid && avoid.selection && avoid.side && txt) {\n      titleGroup.attr('transform', null); // move toward avoid.side (= left, right, top, bottom) if needed\n      // can include pad (pixels, default 2)\n\n      var backside = OPPOSITE_SIDE[avoid.side];\n      var shiftSign = avoid.side === 'left' || avoid.side === 'top' ? -1 : 1;\n      var pad = isNumeric(avoid.pad) ? avoid.pad : 2;\n      var titlebb = Drawing.bBox(titleGroup.node());\n      var paperbb = {\n        left: 0,\n        top: 0,\n        right: fullLayout.width,\n        bottom: fullLayout.height\n      };\n      var maxshift = avoid.maxShift || shiftSign * (paperbb[avoid.side] - titlebb[avoid.side]);\n      var shift = 0; // Prevent the title going off the paper\n\n      if (maxshift < 0) {\n        shift = maxshift;\n      } else {\n        // so we don't have to offset each avoided element,\n        // give the title the opposite offset\n        var offsetLeft = avoid.offsetLeft || 0;\n        var offsetTop = avoid.offsetTop || 0;\n        titlebb.left -= offsetLeft;\n        titlebb.right -= offsetLeft;\n        titlebb.top -= offsetTop;\n        titlebb.bottom -= offsetTop; // iterate over a set of elements (avoid.selection)\n        // to avoid collisions with\n\n        avoid.selection.each(function () {\n          var avoidbb = Drawing.bBox(this);\n\n          if (Lib.bBoxIntersect(titlebb, avoidbb, pad)) {\n            shift = Math.max(shift, shiftSign * (avoidbb[avoid.side] - titlebb[backside]) + pad);\n          }\n        });\n        shift = Math.min(maxshift, shift);\n      }\n\n      if (shift > 0 || maxshift < 0) {\n        var shiftTemplate = {\n          left: [-shift, 0],\n          right: [shift, 0],\n          top: [0, -shift],\n          bottom: [0, shift]\n        }[avoid.side];\n        titleGroup.attr('transform', 'translate(' + shiftTemplate + ')');\n      }\n    }\n  }\n\n  el.call(titleLayout);\n\n  function setPlaceholder() {\n    opacity = 0;\n    isplaceholder = true;\n    el.text(placeholder).on('mouseover.opacity', function () {\n      d3.select(this).transition().duration(interactConstants.SHOW_PLACEHOLDER).style('opacity', 1);\n    }).on('mouseout.opacity', function () {\n      d3.select(this).transition().duration(interactConstants.HIDE_PLACEHOLDER).style('opacity', 0);\n    });\n  }\n\n  if (editable) {\n    if (!txt) setPlaceholder();else el.on('.opacity', null);\n    el.call(svgTextUtils.makeEditable, {\n      gd: gd\n    }).on('edit', function (text) {\n      if (traceIndex !== undefined) {\n        Registry.call('_guiRestyle', gd, prop, text, traceIndex);\n      } else {\n        Registry.call('_guiRelayout', gd, prop, text);\n      }\n    }).on('cancel', function () {\n      this.text(this.attr('data-unformatted')).call(titleLayout);\n    }).on('input', function (d) {\n      this.text(d || ' ').call(svgTextUtils.positionText, attributes.x, attributes.y);\n    });\n  }\n\n  el.classed('js-placeholder', isplaceholder);\n  return group;\n}\n\nmodule.exports = {\n  draw: draw\n};","map":{"version":3,"sources":["/Users/jingkaisu/Documents/HRfront/HalliganReviews/web_project/node_modules/plotly.js/src/components/titles/index.js"],"names":["d3","require","isNumeric","Plots","Registry","Lib","Drawing","Color","svgTextUtils","interactConstants","OPPOSITE_SIDE","numStripRE","draw","gd","titleClass","options","cont","propContainer","prop","propName","placeholder","traceIndex","avoid","attributes","transform","group","containerGroup","fullLayout","_fullLayout","opacity","isplaceholder","title","txt","text","trim","font","fontFamily","family","fontSize","size","fontColor","color","editAttr","indexOf","editable","_context","edits","replace","_meta","templateString","elShouldExist","ensureSingle","_infolayer","el","selectAll","data","enter","append","attr","exit","remove","titleLayout","titleEl","syncOrAsync","drawTitle","scootTitle","transformVal","rotate","x","y","offset","style","round","fill","rgb","fontWeight","call","convertToTspans","previousPromises","titleElIn","titleGroup","select","node","parentNode","selection","side","backside","shiftSign","pad","titlebb","bBox","paperbb","left","top","right","width","bottom","height","maxshift","maxShift","shift","offsetLeft","offsetTop","each","avoidbb","bBoxIntersect","Math","max","min","shiftTemplate","setPlaceholder","on","transition","duration","SHOW_PLACEHOLDER","HIDE_PLACEHOLDER","makeEditable","undefined","d","positionText","classed","module","exports"],"mappings":"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","sourcesContent":["/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n\n'use strict';\n\nvar d3 = require('d3');\nvar isNumeric = require('fast-isnumeric');\n\nvar Plots = require('../../plots/plots');\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar interactConstants = require('../../constants/interactions');\n\nvar OPPOSITE_SIDE = require('../../constants/alignment').OPPOSITE_SIDE;\nvar numStripRE = / [XY][0-9]* /;\n\n/**\n * Titles - (re)draw titles on the axes and plot:\n * @param {DOM element} gd - the graphDiv\n * @param {string} titleClass - the css class of this title\n * @param {object} options - how and what to draw\n *      propContainer - the layout object containing `title` and `titlefont`\n *          attributes that apply to this title\n *      propName - the full name of the title property (for Plotly.relayout)\n *      [traceIndex] - include only if this property applies to one trace\n *          (such as a colorbar title) - then editing pipes to Plotly.restyle\n *          instead of Plotly.relayout\n *      placeholder - placeholder text for an empty editable title\n *      [avoid] {object} - include if this title should move to avoid other elements\n *          selection - d3 selection of elements to avoid\n *          side - which direction to move if there is a conflict\n *          [offsetLeft] - if these elements are subject to a translation\n *              wrt the title element\n *          [offsetTop]\n *      attributes {object} - position and alignment attributes\n *          x - pixels\n *          y - pixels\n *          text-anchor - start|middle|end\n *      transform {object} - how to transform the title after positioning\n *          rotate - degrees\n *          offset - shift up/down in the rotated frame (unused?)\n *      containerGroup - if an svg <g> element already exists to hold this\n *          title, include here. Otherwise it will go in fullLayout._infolayer\n *      _meta {object (optional} - meta key-value to for title with\n *          Lib.templateString, default to fullLayout._meta, if not provided\n *\n *  @return {selection} d3 selection of title container group\n */\nfunction draw(gd, titleClass, options) {\n    var cont = options.propContainer;\n    var prop = options.propName;\n    var placeholder = options.placeholder;\n    var traceIndex = options.traceIndex;\n    var avoid = options.avoid || {};\n    var attributes = options.attributes;\n    var transform = options.transform;\n    var group = options.containerGroup;\n\n    var fullLayout = gd._fullLayout;\n\n    var opacity = 1;\n    var isplaceholder = false;\n    var title = cont.title;\n    var txt = (title && title.text ? title.text : '').trim();\n\n    var font = title && title.font ? title.font : {};\n    var fontFamily = font.family;\n    var fontSize = font.size;\n    var fontColor = font.color;\n\n    // only make this title editable if we positively identify its property\n    // as one that has editing enabled.\n    var editAttr;\n    if(prop === 'title.text') editAttr = 'titleText';\n    else if(prop.indexOf('axis') !== -1) editAttr = 'axisTitleText';\n    else if(prop.indexOf('colorbar' !== -1)) editAttr = 'colorbarTitleText';\n    var editable = gd._context.edits[editAttr];\n\n    if(txt === '') opacity = 0;\n    // look for placeholder text while stripping out numbers from eg X2, Y3\n    // this is just for backward compatibility with the old version that had\n    // \"Click to enter X2 title\" and may have gotten saved in some old plots,\n    // we don't want this to show up when these are displayed.\n    else if(txt.replace(numStripRE, ' % ') === placeholder.replace(numStripRE, ' % ')) {\n        opacity = 0.2;\n        isplaceholder = true;\n        if(!editable) txt = '';\n    }\n\n    if(options._meta) {\n        txt = Lib.templateString(txt, options._meta);\n    } else if(fullLayout._meta) {\n        txt = Lib.templateString(txt, fullLayout._meta);\n    }\n\n    var elShouldExist = txt || editable;\n\n    if(!group) {\n        group = Lib.ensureSingle(fullLayout._infolayer, 'g', 'g-' + titleClass);\n    }\n\n    var el = group.selectAll('text')\n        .data(elShouldExist ? [0] : []);\n    el.enter().append('text');\n    el.text(txt)\n        // this is hacky, but convertToTspans uses the class\n        // to determine whether to rotate mathJax...\n        // so we need to clear out any old class and put the\n        // correct one (only relevant for colorbars, at least\n        // for now) - ie don't use .classed\n        .attr('class', titleClass);\n    el.exit().remove();\n\n    if(!elShouldExist) return group;\n\n    function titleLayout(titleEl) {\n        Lib.syncOrAsync([drawTitle, scootTitle], titleEl);\n    }\n\n    function drawTitle(titleEl) {\n        var transformVal;\n\n        if(transform) {\n            transformVal = '';\n            if(transform.rotate) {\n                transformVal += 'rotate(' + [transform.rotate, attributes.x, attributes.y] + ')';\n            }\n            if(transform.offset) {\n                transformVal += 'translate(0, ' + transform.offset + ')';\n            }\n        } else {\n            transformVal = null;\n        }\n\n        titleEl.attr('transform', transformVal);\n\n        titleEl.style({\n            'font-family': fontFamily,\n            'font-size': d3.round(fontSize, 2) + 'px',\n            fill: Color.rgb(fontColor),\n            opacity: opacity * Color.opacity(fontColor),\n            'font-weight': Plots.fontWeight\n        })\n        .attr(attributes)\n        .call(svgTextUtils.convertToTspans, gd);\n\n        return Plots.previousPromises(gd);\n    }\n\n    function scootTitle(titleElIn) {\n        var titleGroup = d3.select(titleElIn.node().parentNode);\n\n        if(avoid && avoid.selection && avoid.side && txt) {\n            titleGroup.attr('transform', null);\n\n            // move toward avoid.side (= left, right, top, bottom) if needed\n            // can include pad (pixels, default 2)\n            var backside = OPPOSITE_SIDE[avoid.side];\n            var shiftSign = (avoid.side === 'left' || avoid.side === 'top') ? -1 : 1;\n            var pad = isNumeric(avoid.pad) ? avoid.pad : 2;\n\n            var titlebb = Drawing.bBox(titleGroup.node());\n            var paperbb = {\n                left: 0,\n                top: 0,\n                right: fullLayout.width,\n                bottom: fullLayout.height\n            };\n\n            var maxshift = avoid.maxShift ||\n                shiftSign * (paperbb[avoid.side] - titlebb[avoid.side]);\n            var shift = 0;\n\n            // Prevent the title going off the paper\n            if(maxshift < 0) {\n                shift = maxshift;\n            } else {\n                // so we don't have to offset each avoided element,\n                // give the title the opposite offset\n                var offsetLeft = avoid.offsetLeft || 0;\n                var offsetTop = avoid.offsetTop || 0;\n                titlebb.left -= offsetLeft;\n                titlebb.right -= offsetLeft;\n                titlebb.top -= offsetTop;\n                titlebb.bottom -= offsetTop;\n\n                // iterate over a set of elements (avoid.selection)\n                // to avoid collisions with\n                avoid.selection.each(function() {\n                    var avoidbb = Drawing.bBox(this);\n\n                    if(Lib.bBoxIntersect(titlebb, avoidbb, pad)) {\n                        shift = Math.max(shift, shiftSign * (\n                            avoidbb[avoid.side] - titlebb[backside]) + pad);\n                    }\n                });\n                shift = Math.min(maxshift, shift);\n            }\n\n            if(shift > 0 || maxshift < 0) {\n                var shiftTemplate = {\n                    left: [-shift, 0],\n                    right: [shift, 0],\n                    top: [0, -shift],\n                    bottom: [0, shift]\n                }[avoid.side];\n                titleGroup.attr('transform', 'translate(' + shiftTemplate + ')');\n            }\n        }\n    }\n\n    el.call(titleLayout);\n\n    function setPlaceholder() {\n        opacity = 0;\n        isplaceholder = true;\n        el.text(placeholder)\n            .on('mouseover.opacity', function() {\n                d3.select(this).transition()\n                    .duration(interactConstants.SHOW_PLACEHOLDER).style('opacity', 1);\n            })\n            .on('mouseout.opacity', function() {\n                d3.select(this).transition()\n                    .duration(interactConstants.HIDE_PLACEHOLDER).style('opacity', 0);\n            });\n    }\n\n    if(editable) {\n        if(!txt) setPlaceholder();\n        else el.on('.opacity', null);\n\n        el.call(svgTextUtils.makeEditable, {gd: gd})\n            .on('edit', function(text) {\n                if(traceIndex !== undefined) {\n                    Registry.call('_guiRestyle', gd, prop, text, traceIndex);\n                } else {\n                    Registry.call('_guiRelayout', gd, prop, text);\n                }\n            })\n            .on('cancel', function() {\n                this.text(this.attr('data-unformatted'))\n                    .call(titleLayout);\n            })\n            .on('input', function(d) {\n                this.text(d || ' ')\n                    .call(svgTextUtils.positionText, attributes.x, attributes.y);\n            });\n    }\n    el.classed('js-placeholder', isplaceholder);\n\n    return group;\n}\n\nmodule.exports = {\n    draw: draw\n};\n"]},"metadata":{},"sourceType":"script"}