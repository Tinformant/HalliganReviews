{"ast":null,"code":"'use strict';\n\nconst rgba = require('color-normalize');\n\nconst getBounds = require('array-bounds');\n\nconst extend = require('object-assign');\n\nconst glslify = require('glslify');\n\nconst pick = require('pick-by-alias');\n\nconst flatten = require('flatten-vertex-data');\n\nconst triangulate = require('earcut');\n\nconst normalize = require('array-normalize');\n\nconst {\n  float32,\n  fract32\n} = require('to-float32');\n\nconst WeakMap = require('es6-weak-map');\n\nconst parseRect = require('parse-rect');\n\nmodule.exports = Line2D;\n/** @constructor */\n\nfunction Line2D(regl, options) {\n  if (!(this instanceof Line2D)) return new Line2D(regl, options);\n\n  if (typeof regl === 'function') {\n    if (!options) options = {};\n    options.regl = regl;\n  } else {\n    options = regl;\n  }\n\n  if (options.length) options.positions = options;\n  regl = options.regl;\n\n  if (!regl.hasExtension('ANGLE_instanced_arrays')) {\n    throw Error('regl-error2d: `ANGLE_instanced_arrays` extension should be enabled');\n  } // persistent variables\n\n\n  this.gl = regl._gl;\n  this.regl = regl; // list of options for lines\n\n  this.passes = []; // cached shaders instance\n\n  this.shaders = Line2D.shaders.has(regl) ? Line2D.shaders.get(regl) : Line2D.shaders.set(regl, Line2D.createShaders(regl)).get(regl); // init defaults\n\n  this.update(options);\n}\n\nLine2D.dashMult = 2;\nLine2D.maxPatternLength = 256;\nLine2D.precisionThreshold = 3e6;\nLine2D.maxPoints = 1e4;\nLine2D.maxLines = 2048; // cache of created draw calls per-regl instance\n\nLine2D.shaders = new WeakMap(); // create static shaders once\n\nLine2D.createShaders = function (regl) {\n  let offsetBuffer = regl.buffer({\n    usage: 'static',\n    type: 'float',\n    data: [0, 1, 0, 0, 1, 1, 1, 0]\n  });\n  let shaderOptions = {\n    primitive: 'triangle strip',\n    instances: regl.prop('count'),\n    count: 4,\n    offset: 0,\n    uniforms: {\n      miterMode: (ctx, prop) => prop.join === 'round' ? 2 : 1,\n      miterLimit: regl.prop('miterLimit'),\n      scale: regl.prop('scale'),\n      scaleFract: regl.prop('scaleFract'),\n      translateFract: regl.prop('translateFract'),\n      translate: regl.prop('translate'),\n      thickness: regl.prop('thickness'),\n      dashPattern: regl.prop('dashTexture'),\n      opacity: regl.prop('opacity'),\n      pixelRatio: regl.context('pixelRatio'),\n      id: regl.prop('id'),\n      dashSize: regl.prop('dashLength'),\n      viewport: (c, p) => [p.viewport.x, p.viewport.y, c.viewportWidth, c.viewportHeight],\n      depth: regl.prop('depth')\n    },\n    blend: {\n      enable: true,\n      color: [0, 0, 0, 0],\n      equation: {\n        rgb: 'add',\n        alpha: 'add'\n      },\n      func: {\n        srcRGB: 'src alpha',\n        dstRGB: 'one minus src alpha',\n        srcAlpha: 'one minus dst alpha',\n        dstAlpha: 'one'\n      }\n    },\n    depth: {\n      enable: (c, p) => {\n        return !p.overlay;\n      }\n    },\n    stencil: {\n      enable: false\n    },\n    scissor: {\n      enable: true,\n      box: regl.prop('viewport')\n    },\n    viewport: regl.prop('viewport')\n  }; // simplified rectangular line shader\n\n  let drawRectLine = regl(extend({\n    vert: glslify('./rect-vert.glsl'),\n    frag: glslify('./rect-frag.glsl'),\n    attributes: {\n      // if point is at the end of segment\n      lineEnd: {\n        buffer: offsetBuffer,\n        divisor: 0,\n        stride: 8,\n        offset: 0\n      },\n      // if point is at the top of segment\n      lineTop: {\n        buffer: offsetBuffer,\n        divisor: 0,\n        stride: 8,\n        offset: 4\n      },\n      // beginning of line coordinate\n      aCoord: {\n        buffer: regl.prop('positionBuffer'),\n        stride: 8,\n        offset: 8,\n        divisor: 1\n      },\n      // end of line coordinate\n      bCoord: {\n        buffer: regl.prop('positionBuffer'),\n        stride: 8,\n        offset: 16,\n        divisor: 1\n      },\n      aCoordFract: {\n        buffer: regl.prop('positionFractBuffer'),\n        stride: 8,\n        offset: 8,\n        divisor: 1\n      },\n      bCoordFract: {\n        buffer: regl.prop('positionFractBuffer'),\n        stride: 8,\n        offset: 16,\n        divisor: 1\n      },\n      color: {\n        buffer: regl.prop('colorBuffer'),\n        stride: 4,\n        offset: 0,\n        divisor: 1\n      }\n    }\n  }, shaderOptions)); // create regl draw\n\n  let drawMiterLine;\n\n  try {\n    drawMiterLine = regl(extend({\n      // culling removes polygon creasing\n      cull: {\n        enable: true,\n        face: 'back'\n      },\n      vert: glslify('./miter-vert.glsl'),\n      frag: glslify('./miter-frag.glsl'),\n      attributes: {\n        // is line end\n        lineEnd: {\n          buffer: offsetBuffer,\n          divisor: 0,\n          stride: 8,\n          offset: 0\n        },\n        // is line top\n        lineTop: {\n          buffer: offsetBuffer,\n          divisor: 0,\n          stride: 8,\n          offset: 4\n        },\n        // left color\n        aColor: {\n          buffer: regl.prop('colorBuffer'),\n          stride: 4,\n          offset: 0,\n          divisor: 1\n        },\n        // right color\n        bColor: {\n          buffer: regl.prop('colorBuffer'),\n          stride: 4,\n          offset: 4,\n          divisor: 1\n        },\n        prevCoord: {\n          buffer: regl.prop('positionBuffer'),\n          stride: 8,\n          offset: 0,\n          divisor: 1\n        },\n        aCoord: {\n          buffer: regl.prop('positionBuffer'),\n          stride: 8,\n          offset: 8,\n          divisor: 1\n        },\n        bCoord: {\n          buffer: regl.prop('positionBuffer'),\n          stride: 8,\n          offset: 16,\n          divisor: 1\n        },\n        nextCoord: {\n          buffer: regl.prop('positionBuffer'),\n          stride: 8,\n          offset: 24,\n          divisor: 1\n        }\n      }\n    }, shaderOptions));\n  } catch (e) {\n    // IE/bad Webkit fallback\n    drawMiterLine = drawRectLine;\n  } // fill shader\n\n\n  let drawFill = regl({\n    primitive: 'triangle',\n    elements: (ctx, prop) => prop.triangles,\n    offset: 0,\n    vert: glslify('./fill-vert.glsl'),\n    frag: glslify('./fill-frag.glsl'),\n    uniforms: {\n      scale: regl.prop('scale'),\n      color: regl.prop('fill'),\n      scaleFract: regl.prop('scaleFract'),\n      translateFract: regl.prop('translateFract'),\n      translate: regl.prop('translate'),\n      opacity: regl.prop('opacity'),\n      pixelRatio: regl.context('pixelRatio'),\n      id: regl.prop('id'),\n      viewport: (ctx, prop) => [prop.viewport.x, prop.viewport.y, ctx.viewportWidth, ctx.viewportHeight]\n    },\n    attributes: {\n      position: {\n        buffer: regl.prop('positionBuffer'),\n        stride: 8,\n        offset: 8\n      },\n      positionFract: {\n        buffer: regl.prop('positionFractBuffer'),\n        stride: 8,\n        offset: 8\n      }\n    },\n    blend: shaderOptions.blend,\n    depth: {\n      enable: false\n    },\n    scissor: shaderOptions.scissor,\n    stencil: shaderOptions.stencil,\n    viewport: shaderOptions.viewport\n  });\n  return {\n    fill: drawFill,\n    rect: drawRectLine,\n    miter: drawMiterLine\n  };\n}; // used to for new lines instances\n\n\nLine2D.defaults = {\n  dashes: null,\n  join: 'miter',\n  miterLimit: 1,\n  thickness: 10,\n  cap: 'square',\n  color: 'black',\n  opacity: 1,\n  overlay: false,\n  viewport: null,\n  range: null,\n  close: false,\n  fill: null\n};\n\nLine2D.prototype.render = function (...args) {\n  if (args.length) {\n    this.update(...args);\n  }\n\n  this.draw();\n};\n\nLine2D.prototype.draw = function (...args) {\n  // render multiple polylines via regl batch\n  (args.length ? args : this.passes).forEach((s, i) => {\n    // render array pass as a list of passes\n    if (s && Array.isArray(s)) return this.draw(...s);\n    if (typeof s === 'number') s = this.passes[s];\n    if (!(s && s.count > 1 && s.opacity)) return;\n\n    this.regl._refresh();\n\n    if (s.fill && s.triangles && s.triangles.length > 2) {\n      this.shaders.fill(s);\n    }\n\n    if (!s.thickness) return; // high scale is only available for rect mode with precision\n\n    if (s.scale[0] * s.viewport.width > Line2D.precisionThreshold || s.scale[1] * s.viewport.height > Line2D.precisionThreshold) {\n      this.shaders.rect(s);\n    } // thin this.passes or too many points are rendered as simplified rect shader\n    else if (s.join === 'rect' || !s.join && (s.thickness <= 2 || s.count >= Line2D.maxPoints)) {\n        this.shaders.rect(s);\n      } else {\n        this.shaders.miter(s);\n      }\n  });\n  return this;\n};\n\nLine2D.prototype.update = function (options) {\n  if (!options) return;\n\n  if (options.length != null) {\n    if (typeof options[0] === 'number') options = [{\n      positions: options\n    }];\n  } // make options a batch\n  else if (!Array.isArray(options)) options = [options];\n\n  let {\n    regl,\n    gl\n  } = this; // process per-line settings\n\n  options.forEach((o, i) => {\n    let state = this.passes[i];\n    if (o === undefined) return; // null-argument removes pass\n\n    if (o === null) {\n      this.passes[i] = null;\n      return;\n    }\n\n    if (typeof o[0] === 'number') o = {\n      positions: o\n    }; // handle aliases\n\n    o = pick(o, {\n      positions: 'positions points data coords',\n      thickness: 'thickness lineWidth lineWidths line-width linewidth width stroke-width strokewidth strokeWidth',\n      join: 'lineJoin linejoin join type mode',\n      miterLimit: 'miterlimit miterLimit',\n      dashes: 'dash dashes dasharray dash-array dashArray',\n      color: 'color colour stroke colors colours stroke-color strokeColor',\n      fill: 'fill fill-color fillColor',\n      opacity: 'alpha opacity',\n      overlay: 'overlay crease overlap intersect',\n      close: 'closed close closed-path closePath',\n      range: 'range dataBox',\n      viewport: 'viewport viewBox',\n      hole: 'holes hole hollow'\n    }); // init state\n\n    if (!state) {\n      this.passes[i] = state = {\n        id: i,\n        scale: null,\n        scaleFract: null,\n        translate: null,\n        translateFract: null,\n        count: 0,\n        hole: [],\n        depth: 0,\n        dashLength: 1,\n        dashTexture: regl.texture({\n          channels: 1,\n          data: new Uint8Array([255]),\n          width: 1,\n          height: 1,\n          mag: 'linear',\n          min: 'linear'\n        }),\n        colorBuffer: regl.buffer({\n          usage: 'dynamic',\n          type: 'uint8',\n          data: new Uint8Array()\n        }),\n        positionBuffer: regl.buffer({\n          usage: 'dynamic',\n          type: 'float',\n          data: new Uint8Array()\n        }),\n        positionFractBuffer: regl.buffer({\n          usage: 'dynamic',\n          type: 'float',\n          data: new Uint8Array()\n        })\n      };\n      o = extend({}, Line2D.defaults, o);\n    }\n\n    if (o.thickness != null) state.thickness = parseFloat(o.thickness);\n    if (o.opacity != null) state.opacity = parseFloat(o.opacity);\n    if (o.miterLimit != null) state.miterLimit = parseFloat(o.miterLimit);\n\n    if (o.overlay != null) {\n      state.overlay = !!o.overlay;\n\n      if (i < Line2D.maxLines) {\n        state.depth = 2 * (Line2D.maxLines - 1 - i % Line2D.maxLines) / Line2D.maxLines - 1.;\n      }\n    }\n\n    if (o.join != null) state.join = o.join;\n    if (o.hole != null) state.hole = o.hole;\n    if (o.fill != null) state.fill = !o.fill ? null : rgba(o.fill, 'uint8');\n    if (o.viewport != null) state.viewport = parseRect(o.viewport);\n\n    if (!state.viewport) {\n      state.viewport = parseRect([gl.drawingBufferWidth, gl.drawingBufferHeight]);\n    }\n\n    if (o.close != null) state.close = o.close; // reset positions\n\n    if (o.positions === null) o.positions = [];\n\n    if (o.positions) {\n      let positions, count; // if positions are an object with x/y\n\n      if (o.positions.x && o.positions.y) {\n        let xPos = o.positions.x;\n        let yPos = o.positions.y;\n        count = state.count = Math.max(xPos.length, yPos.length);\n        positions = new Float64Array(count * 2);\n\n        for (let i = 0; i < count; i++) {\n          positions[i * 2] = xPos[i];\n          positions[i * 2 + 1] = yPos[i];\n        }\n      } else {\n        positions = flatten(o.positions, 'float64');\n        count = state.count = Math.floor(positions.length / 2);\n      }\n\n      let bounds = state.bounds = getBounds(positions, 2); // create fill positions\n      // FIXME: fill positions can be set only along with positions\n\n      if (state.fill) {\n        let pos = []; // filter bad vertices and remap triangles to ensure shape\n\n        let ids = {};\n        let lastId = 0;\n\n        for (let i = 0, ptr = 0, l = state.count; i < l; i++) {\n          let x = positions[i * 2];\n          let y = positions[i * 2 + 1];\n\n          if (isNaN(x) || isNaN(y) || x == null || y == null) {\n            x = positions[lastId * 2];\n            y = positions[lastId * 2 + 1];\n            ids[i] = lastId;\n          } else {\n            lastId = i;\n          }\n\n          pos[ptr++] = x;\n          pos[ptr++] = y;\n        }\n\n        let triangles = triangulate(pos, state.hole || []);\n\n        for (let i = 0, l = triangles.length; i < l; i++) {\n          if (ids[triangles[i]] != null) triangles[i] = ids[triangles[i]];\n        }\n\n        state.triangles = triangles;\n      } // update position buffers\n\n\n      let npos = new Float64Array(positions);\n      normalize(npos, 2, bounds);\n      let positionData = new Float64Array(count * 2 + 6); // rotate first segment join\n\n      if (state.close) {\n        if (positions[0] === positions[count * 2 - 2] && positions[1] === positions[count * 2 - 1]) {\n          positionData[0] = npos[count * 2 - 4];\n          positionData[1] = npos[count * 2 - 3];\n        } else {\n          positionData[0] = npos[count * 2 - 2];\n          positionData[1] = npos[count * 2 - 1];\n        }\n      } else {\n        positionData[0] = npos[0];\n        positionData[1] = npos[1];\n      }\n\n      positionData.set(npos, 2); // add last segment\n\n      if (state.close) {\n        // ignore coinciding start/end\n        if (positions[0] === positions[count * 2 - 2] && positions[1] === positions[count * 2 - 1]) {\n          positionData[count * 2 + 2] = npos[2];\n          positionData[count * 2 + 3] = npos[3];\n          state.count -= 1;\n        } else {\n          positionData[count * 2 + 2] = npos[0];\n          positionData[count * 2 + 3] = npos[1];\n          positionData[count * 2 + 4] = npos[2];\n          positionData[count * 2 + 5] = npos[3];\n        }\n      } // add stub\n      else {\n          positionData[count * 2 + 2] = npos[count * 2 - 2];\n          positionData[count * 2 + 3] = npos[count * 2 - 1];\n          positionData[count * 2 + 4] = npos[count * 2 - 2];\n          positionData[count * 2 + 5] = npos[count * 2 - 1];\n        }\n\n      state.positionBuffer(float32(positionData));\n      state.positionFractBuffer(fract32(positionData));\n    }\n\n    if (o.range) {\n      state.range = o.range;\n    } else if (!state.range) {\n      state.range = state.bounds;\n    }\n\n    if ((o.range || o.positions) && state.count) {\n      let bounds = state.bounds;\n      let boundsW = bounds[2] - bounds[0],\n          boundsH = bounds[3] - bounds[1];\n      let rangeW = state.range[2] - state.range[0],\n          rangeH = state.range[3] - state.range[1];\n      state.scale = [boundsW / rangeW, boundsH / rangeH];\n      state.translate = [-state.range[0] / rangeW + bounds[0] / rangeW || 0, -state.range[1] / rangeH + bounds[1] / rangeH || 0];\n      state.scaleFract = fract32(state.scale);\n      state.translateFract = fract32(state.translate);\n    }\n\n    if (o.dashes) {\n      let dashLength = 0.,\n          dashData;\n\n      if (!o.dashes || o.dashes.length < 2) {\n        dashLength = 1.;\n        dashData = new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255]);\n      } else {\n        dashLength = 0.;\n\n        for (let i = 0; i < o.dashes.length; ++i) {\n          dashLength += o.dashes[i];\n        }\n\n        dashData = new Uint8Array(dashLength * Line2D.dashMult);\n        let ptr = 0;\n        let fillColor = 255; // repeat texture two times to provide smooth 0-step\n\n        for (let k = 0; k < 2; k++) {\n          for (let i = 0; i < o.dashes.length; ++i) {\n            for (let j = 0, l = o.dashes[i] * Line2D.dashMult * .5; j < l; ++j) {\n              dashData[ptr++] = fillColor;\n            }\n\n            fillColor ^= 255;\n          }\n        }\n      }\n\n      state.dashLength = dashLength;\n      state.dashTexture({\n        channels: 1,\n        data: dashData,\n        width: dashData.length,\n        height: 1,\n        mag: 'linear',\n        min: 'linear'\n      }, 0, 0);\n    }\n\n    if (o.color) {\n      let count = state.count;\n      let colors = o.color;\n      if (!colors) colors = 'transparent';\n      let colorData = new Uint8Array(count * 4 + 4); // convert colors to typed arrays\n\n      if (!Array.isArray(colors) || typeof colors[0] === 'number') {\n        let c = rgba(colors, 'uint8');\n\n        for (let i = 0; i < count + 1; i++) {\n          colorData.set(c, i * 4);\n        }\n      } else {\n        for (let i = 0; i < count; i++) {\n          let c = rgba(colors[i], 'uint8');\n          colorData.set(c, i * 4);\n        }\n\n        colorData.set(rgba(colors[0], 'uint8'), count * 4);\n      }\n\n      state.colorBuffer({\n        usage: 'dynamic',\n        type: 'uint8',\n        data: colorData\n      });\n    }\n  }); // remove unmentioned passes\n\n  if (options.length < this.passes.length) {\n    for (let i = options.length; i < this.passes.length; i++) {\n      let pass = this.passes[i];\n      if (!pass) continue;\n      pass.colorBuffer.destroy();\n      pass.positionBuffer.destroy();\n      pass.dashTexture.destroy();\n    }\n\n    this.passes.length = options.length;\n  } // remove null items\n\n\n  let passes = [];\n\n  for (let i = 0; i < this.passes.length; i++) {\n    if (this.passes[i] !== null) passes.push(this.passes[i]);\n  }\n\n  this.passes = passes;\n  return this;\n};\n\nLine2D.prototype.destroy = function () {\n  this.passes.forEach(pass => {\n    pass.colorBuffer.destroy();\n    pass.positionBuffer.destroy();\n    pass.dashTexture.destroy();\n  });\n  this.passes.length = 0;\n  return this;\n};","map":{"version":3,"sources":["/Users/jingkaisu/Documents/HRfront/HalliganReviews/web_project/node_modules/regl-line2d/index.js"],"names":["rgba","require","getBounds","extend","glslify","pick","flatten","triangulate","normalize","float32","fract32","WeakMap","parseRect","module","exports","Line2D","regl","options","length","positions","hasExtension","Error","gl","_gl","passes","shaders","has","get","set","createShaders","update","dashMult","maxPatternLength","precisionThreshold","maxPoints","maxLines","offsetBuffer","buffer","usage","type","data","shaderOptions","primitive","instances","prop","count","offset","uniforms","miterMode","ctx","join","miterLimit","scale","scaleFract","translateFract","translate","thickness","dashPattern","opacity","pixelRatio","context","id","dashSize","viewport","c","p","x","y","viewportWidth","viewportHeight","depth","blend","enable","color","equation","rgb","alpha","func","srcRGB","dstRGB","srcAlpha","dstAlpha","overlay","stencil","scissor","box","drawRectLine","vert","frag","attributes","lineEnd","divisor","stride","lineTop","aCoord","bCoord","aCoordFract","bCoordFract","drawMiterLine","cull","face","aColor","bColor","prevCoord","nextCoord","e","drawFill","elements","triangles","position","positionFract","fill","rect","miter","defaults","dashes","cap","range","close","prototype","render","args","draw","forEach","s","i","Array","isArray","_refresh","width","height","o","state","undefined","hole","dashLength","dashTexture","texture","channels","Uint8Array","mag","min","colorBuffer","positionBuffer","positionFractBuffer","parseFloat","drawingBufferWidth","drawingBufferHeight","xPos","yPos","Math","max","Float64Array","floor","bounds","pos","ids","lastId","ptr","l","isNaN","npos","positionData","boundsW","boundsH","rangeW","rangeH","dashData","fillColor","k","j","colors","colorData","pass","destroy","push"],"mappings":"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","sourcesContent":["'use strict'\n\n\nconst rgba = require('color-normalize')\nconst getBounds = require('array-bounds')\nconst extend = require('object-assign')\nconst glslify = require('glslify')\nconst pick = require('pick-by-alias')\nconst flatten = require('flatten-vertex-data')\nconst triangulate = require('earcut')\nconst normalize = require('array-normalize')\nconst { float32, fract32 } = require('to-float32')\nconst WeakMap = require('es6-weak-map')\nconst parseRect = require('parse-rect')\n\n\nmodule.exports = Line2D\n\n\n/** @constructor */\nfunction Line2D (regl, options) {\n\tif (!(this instanceof Line2D)) return new Line2D(regl, options)\n\n\tif (typeof regl === 'function') {\n\t\tif (!options) options = {}\n\t\toptions.regl = regl\n\t}\n\telse {\n\t\toptions = regl\n\t}\n\tif (options.length) options.positions = options\n\tregl = options.regl\n\n\tif (!regl.hasExtension('ANGLE_instanced_arrays')) {\n\t\tthrow Error('regl-error2d: `ANGLE_instanced_arrays` extension should be enabled');\n\t}\n\n\t// persistent variables\n\tthis.gl = regl._gl\n\tthis.regl = regl\n\n\t// list of options for lines\n\tthis.passes = []\n\n\t// cached shaders instance\n\tthis.shaders = Line2D.shaders.has(regl) ? Line2D.shaders.get(regl) : Line2D.shaders.set(regl, Line2D.createShaders(regl)).get(regl)\n\n\n\t// init defaults\n\tthis.update(options)\n}\n\n\nLine2D.dashMult = 2\nLine2D.maxPatternLength = 256\nLine2D.precisionThreshold = 3e6\nLine2D.maxPoints = 1e4\nLine2D.maxLines = 2048\n\n\n// cache of created draw calls per-regl instance\nLine2D.shaders = new WeakMap()\n\n\n// create static shaders once\nLine2D.createShaders = function (regl) {\n\tlet offsetBuffer = regl.buffer({\n\t\tusage: 'static',\n\t\ttype: 'float',\n\t\tdata: [0,1, 0,0, 1,1, 1,0]\n\t})\n\n\tlet shaderOptions = {\n\t\tprimitive: 'triangle strip',\n\t\tinstances: regl.prop('count'),\n\t\tcount: 4,\n\t\toffset: 0,\n\n\t\tuniforms: {\n\t\t\tmiterMode: (ctx, prop) => prop.join === 'round' ? 2 : 1,\n\t\t\tmiterLimit: regl.prop('miterLimit'),\n\t\t\tscale: regl.prop('scale'),\n\t\t\tscaleFract: regl.prop('scaleFract'),\n\t\t\ttranslateFract: regl.prop('translateFract'),\n\t\t\ttranslate: regl.prop('translate'),\n\t\t\tthickness: regl.prop('thickness'),\n\t\t\tdashPattern: regl.prop('dashTexture'),\n\t\t\topacity: regl.prop('opacity'),\n\t\t\tpixelRatio: regl.context('pixelRatio'),\n\t\t\tid: regl.prop('id'),\n\t\t\tdashSize: regl.prop('dashLength'),\n\t\t\tviewport: (c, p) => [p.viewport.x, p.viewport.y, c.viewportWidth, c.viewportHeight],\n\t\t\tdepth: regl.prop('depth')\n\t\t},\n\n\t\tblend: {\n\t\t\tenable: true,\n\t\t\tcolor: [0,0,0,0],\n\t\t\tequation: {\n\t\t\t\trgb: 'add',\n\t\t\t\talpha: 'add'\n\t\t\t},\n\t\t\tfunc: {\n\t\t\t\tsrcRGB: 'src alpha',\n\t\t\t\tdstRGB: 'one minus src alpha',\n\t\t\t\tsrcAlpha: 'one minus dst alpha',\n\t\t\t\tdstAlpha: 'one'\n\t\t\t}\n\t\t},\n\t\tdepth: {\n\t\t\tenable: (c, p) => {\n\t\t\t\treturn !p.overlay\n\t\t\t}\n\t\t},\n\t\tstencil: {enable: false},\n\t\tscissor: {\n\t\t\tenable: true,\n\t\t\tbox: regl.prop('viewport')\n\t\t},\n\t\tviewport: regl.prop('viewport')\n\t}\n\n\n\t// simplified rectangular line shader\n\tlet drawRectLine = regl(extend({\n\t\tvert: glslify('./rect-vert.glsl'),\n\t\tfrag: glslify('./rect-frag.glsl'),\n\n\t\tattributes: {\n\t\t\t// if point is at the end of segment\n\t\t\tlineEnd: {\n\t\t\t\tbuffer: offsetBuffer,\n\t\t\t\tdivisor: 0,\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 0\n\t\t\t},\n\t\t\t// if point is at the top of segment\n\t\t\tlineTop: {\n\t\t\t\tbuffer: offsetBuffer,\n\t\t\t\tdivisor: 0,\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 4\n\t\t\t},\n\t\t\t// beginning of line coordinate\n\t\t\taCoord: {\n\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 8,\n\t\t\t\tdivisor: 1\n\t\t\t},\n\t\t\t// end of line coordinate\n\t\t\tbCoord: {\n\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 16,\n\t\t\t\tdivisor: 1\n\t\t\t},\n\t\t\taCoordFract: {\n\t\t\t\tbuffer: regl.prop('positionFractBuffer'),\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 8,\n\t\t\t\tdivisor: 1\n\t\t\t},\n\t\t\tbCoordFract: {\n\t\t\t\tbuffer: regl.prop('positionFractBuffer'),\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 16,\n\t\t\t\tdivisor: 1\n\t\t\t},\n\t\t\tcolor: {\n\t\t\t\tbuffer: regl.prop('colorBuffer'),\n\t\t\t\tstride: 4,\n\t\t\t\toffset: 0,\n\t\t\t\tdivisor: 1\n\t\t\t}\n\t\t}\n\t}, shaderOptions))\n\n\t// create regl draw\n\tlet drawMiterLine\n\n\ttry {\n\t\tdrawMiterLine = regl(extend({\n\t\t\t// culling removes polygon creasing\n\t\t\tcull: {\n\t\t\t\tenable: true,\n\t\t\t\tface: 'back'\n\t\t\t},\n\n\t\t\tvert: glslify('./miter-vert.glsl'),\n\t\t\tfrag: glslify('./miter-frag.glsl'),\n\n\t\t\tattributes: {\n\t\t\t\t// is line end\n\t\t\t\tlineEnd: {\n\t\t\t\t\tbuffer: offsetBuffer,\n\t\t\t\t\tdivisor: 0,\n\t\t\t\t\tstride: 8,\n\t\t\t\t\toffset: 0\n\t\t\t\t},\n\t\t\t\t// is line top\n\t\t\t\tlineTop: {\n\t\t\t\t\tbuffer: offsetBuffer,\n\t\t\t\t\tdivisor: 0,\n\t\t\t\t\tstride: 8,\n\t\t\t\t\toffset: 4\n\t\t\t\t},\n\t\t\t\t// left color\n\t\t\t\taColor: {\n\t\t\t\t\tbuffer: regl.prop('colorBuffer'),\n\t\t\t\t\tstride: 4,\n\t\t\t\t\toffset: 0,\n\t\t\t\t\tdivisor: 1\n\t\t\t\t},\n\t\t\t\t// right color\n\t\t\t\tbColor: {\n\t\t\t\t\tbuffer: regl.prop('colorBuffer'),\n\t\t\t\t\tstride: 4,\n\t\t\t\t\toffset: 4,\n\t\t\t\t\tdivisor: 1\n\t\t\t\t},\n\t\t\t\tprevCoord: {\n\t\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\t\tstride: 8,\n\t\t\t\t\toffset: 0,\n\t\t\t\t\tdivisor: 1\n\t\t\t\t},\n\t\t\t\taCoord: {\n\t\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\t\tstride: 8,\n\t\t\t\t\toffset: 8,\n\t\t\t\t\tdivisor: 1\n\t\t\t\t},\n\t\t\t\tbCoord: {\n\t\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\t\tstride: 8,\n\t\t\t\t\toffset: 16,\n\t\t\t\t\tdivisor: 1\n\t\t\t\t},\n\t\t\t\tnextCoord: {\n\t\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\t\tstride: 8,\n\t\t\t\t\toffset: 24,\n\t\t\t\t\tdivisor: 1\n\t\t\t\t}\n\t\t\t}\n\t\t}, shaderOptions))\n\t} catch (e) {\n\t\t// IE/bad Webkit fallback\n\t\tdrawMiterLine = drawRectLine\n\t}\n\n\t// fill shader\n\tlet drawFill = regl({\n\t\tprimitive: 'triangle',\n\t\telements: (ctx, prop) => prop.triangles,\n\t\toffset: 0,\n\n\t\tvert: glslify('./fill-vert.glsl'),\n\t\tfrag: glslify('./fill-frag.glsl'),\n\n\t\tuniforms: {\n\t\t\tscale: regl.prop('scale'),\n\t\t\tcolor: regl.prop('fill'),\n\t\t\tscaleFract: regl.prop('scaleFract'),\n\t\t\ttranslateFract: regl.prop('translateFract'),\n\t\t\ttranslate: regl.prop('translate'),\n\t\t\topacity: regl.prop('opacity'),\n\t\t\tpixelRatio: regl.context('pixelRatio'),\n\t\t\tid: regl.prop('id'),\n\t\t\tviewport: (ctx, prop) => [prop.viewport.x, prop.viewport.y, ctx.viewportWidth, ctx.viewportHeight]\n\t\t},\n\n\t\tattributes: {\n\t\t\tposition: {\n\t\t\t\tbuffer: regl.prop('positionBuffer'),\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 8\n\t\t\t},\n\t\t\tpositionFract: {\n\t\t\t\tbuffer: regl.prop('positionFractBuffer'),\n\t\t\t\tstride: 8,\n\t\t\t\toffset: 8\n\t\t\t}\n\t\t},\n\n\t\tblend: shaderOptions.blend,\n\n\t\tdepth: { enable: false },\n\t\tscissor: shaderOptions.scissor,\n\t\tstencil: shaderOptions.stencil,\n\t\tviewport: shaderOptions.viewport\n\t})\n\n\treturn {\n\t\tfill: drawFill, rect: drawRectLine, miter: drawMiterLine\n\t}\n}\n\n\n// used to for new lines instances\nLine2D.defaults = {\n\tdashes: null,\n\tjoin: 'miter',\n\tmiterLimit: 1,\n\tthickness: 10,\n\tcap: 'square',\n\tcolor: 'black',\n\topacity: 1,\n\toverlay: false,\n\tviewport: null,\n\trange: null,\n\tclose: false,\n\tfill: null\n}\n\n\nLine2D.prototype.render = function (...args) {\n\tif (args.length) {\n\t\tthis.update(...args)\n\t}\n\n\tthis.draw()\n}\n\n\nLine2D.prototype.draw = function (...args) {\n\t// render multiple polylines via regl batch\n\t(args.length ? args : this.passes).forEach((s, i) => {\n\t\t// render array pass as a list of passes\n\t\tif (s && Array.isArray(s)) return this.draw(...s)\n\n\t\tif (typeof s === 'number') s = this.passes[s]\n\n\t\tif (!(s && s.count > 1 && s.opacity)) return\n\n\t\tthis.regl._refresh()\n\n\t\tif (s.fill && s.triangles && s.triangles.length > 2) {\n\t\t\tthis.shaders.fill(s)\n\t\t}\n\n\t\tif (!s.thickness) return\n\n\t\t// high scale is only available for rect mode with precision\n\t\tif (s.scale[0] * s.viewport.width > Line2D.precisionThreshold || s.scale[1] * s.viewport.height > Line2D.precisionThreshold) {\n\t\t\tthis.shaders.rect(s)\n\t\t}\n\n\t\t// thin this.passes or too many points are rendered as simplified rect shader\n\t\telse if (s.join === 'rect' || (!s.join && (s.thickness <= 2 || s.count >= Line2D.maxPoints))) {\n\t\t\tthis.shaders.rect(s)\n\t\t}\n\t\telse {\n\t\t\tthis.shaders.miter(s)\n\t\t}\n\t})\n\n\treturn this\n}\n\nLine2D.prototype.update = function (options) {\n\tif (!options) return\n\n\tif (options.length != null) {\n\t\tif (typeof options[0] === 'number') options = [{positions: options}]\n\t}\n\n\t// make options a batch\n\telse if (!Array.isArray(options)) options = [options]\n\n\tlet { regl, gl } = this\n\n\t// process per-line settings\n\toptions.forEach((o, i) => {\n\t\tlet state = this.passes[i]\n\n\t\tif (o === undefined) return\n\n\t\t// null-argument removes pass\n\t\tif (o === null) {\n\t\t\tthis.passes[i] = null\n\t\t\treturn\n\t\t}\n\n\t\tif (typeof o[0] === 'number') o = {positions: o}\n\n\t\t// handle aliases\n\t\to = pick(o, {\n\t\t\tpositions: 'positions points data coords',\n\t\t\tthickness: 'thickness lineWidth lineWidths line-width linewidth width stroke-width strokewidth strokeWidth',\n\t\t\tjoin: 'lineJoin linejoin join type mode',\n\t\t\tmiterLimit: 'miterlimit miterLimit',\n\t\t\tdashes: 'dash dashes dasharray dash-array dashArray',\n\t\t\tcolor: 'color colour stroke colors colours stroke-color strokeColor',\n\t\t\tfill: 'fill fill-color fillColor',\n\t\t\topacity: 'alpha opacity',\n\t\t\toverlay: 'overlay crease overlap intersect',\n\t\t\tclose: 'closed close closed-path closePath',\n\t\t\trange: 'range dataBox',\n\t\t\tviewport: 'viewport viewBox',\n\t\t\thole: 'holes hole hollow'\n\t\t})\n\n\t\t// init state\n\t\tif (!state) {\n\t\t\tthis.passes[i] = state = {\n\t\t\t\tid: i,\n\t\t\t\tscale: null,\n\t\t\t\tscaleFract: null,\n\t\t\t\ttranslate: null,\n\t\t\t\ttranslateFract: null,\n\t\t\t\tcount: 0,\n\t\t\t\thole: [],\n\t\t\t\tdepth: 0,\n\n\t\t\t\tdashLength: 1,\n\t\t\t\tdashTexture: regl.texture({\n\t\t\t\t\tchannels: 1,\n\t\t\t\t\tdata: new Uint8Array([255]),\n\t\t\t\t\twidth: 1,\n\t\t\t\t\theight: 1,\n\t\t\t\t\tmag: 'linear',\n\t\t\t\t\tmin: 'linear'\n\t\t\t\t}),\n\n\t\t\t\tcolorBuffer: regl.buffer({\n\t\t\t\t\tusage: 'dynamic',\n\t\t\t\t\ttype: 'uint8',\n\t\t\t\t\tdata: new Uint8Array()\n\t\t\t\t}),\n\t\t\t\tpositionBuffer: regl.buffer({\n\t\t\t\t\tusage: 'dynamic',\n\t\t\t\t\ttype: 'float',\n\t\t\t\t\tdata: new Uint8Array()\n\t\t\t\t}),\n\t\t\t\tpositionFractBuffer: regl.buffer({\n\t\t\t\t\tusage: 'dynamic',\n\t\t\t\t\ttype: 'float',\n\t\t\t\t\tdata: new Uint8Array()\n\t\t\t\t})\n\t\t\t}\n\n\t\t\to = extend({}, Line2D.defaults, o)\n\t\t}\n\t\tif (o.thickness != null) state.thickness = parseFloat(o.thickness)\n\t\tif (o.opacity != null) state.opacity = parseFloat(o.opacity)\n\t\tif (o.miterLimit != null) state.miterLimit = parseFloat(o.miterLimit)\n\t\tif (o.overlay != null) {\n\t\t\tstate.overlay = !!o.overlay\n\t\t\tif (i < Line2D.maxLines) {\n\t\t\t\tstate.depth = 2 * (Line2D.maxLines - 1 - i % Line2D.maxLines) / Line2D.maxLines - 1.;\n\t\t\t}\n\t\t}\n\t\tif (o.join != null) state.join = o.join\n\t\tif (o.hole != null) state.hole = o.hole\n\t\tif (o.fill != null) state.fill = !o.fill ? null : rgba(o.fill, 'uint8')\n\t\tif (o.viewport != null) state.viewport = parseRect(o.viewport)\n\n\t\tif (!state.viewport) {\n\t\t\tstate.viewport = parseRect([\n\t\t\t\tgl.drawingBufferWidth,\n\t\t\t\tgl.drawingBufferHeight\n\t\t\t])\n\t\t}\n\n\t\tif (o.close != null) state.close = o.close\n\n\t\t// reset positions\n\t\tif (o.positions === null) o.positions = []\n\t\tif (o.positions) {\n\t\t\tlet positions, count\n\n\t\t\t// if positions are an object with x/y\n\t\t\tif (o.positions.x && o.positions.y) {\n\t\t\t\tlet xPos = o.positions.x\n\t\t\t\tlet yPos = o.positions.y\n\t\t\t\tcount = state.count = Math.max(\n\t\t\t\t\txPos.length,\n\t\t\t\t\tyPos.length\n\t\t\t\t)\n\t\t\t\tpositions = new Float64Array(count * 2)\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tpositions[i * 2] = xPos[i]\n\t\t\t\t\tpositions[i * 2 + 1] = yPos[i]\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpositions = flatten(o.positions, 'float64')\n\t\t\t\tcount = state.count = Math.floor(positions.length / 2)\n\t\t\t}\n\n\t\t\tlet bounds = state.bounds = getBounds(positions, 2)\n\n\t\t\t// create fill positions\n\t\t\t// FIXME: fill positions can be set only along with positions\n\t\t\tif (state.fill) {\n\t\t\t\tlet pos = []\n\n\t\t\t\t// filter bad vertices and remap triangles to ensure shape\n\t\t\t\tlet ids = {}\n\t\t\t\tlet lastId = 0\n\n\t\t\t\tfor (let i = 0, ptr = 0, l = state.count; i < l; i++) {\n\t\t\t\t\tlet x = positions[i*2]\n\t\t\t\t\tlet y = positions[i*2 + 1]\n\t\t\t\t\tif (isNaN(x) || isNaN(y) || x == null || y == null) {\n\t\t\t\t\t\tx = positions[lastId*2]\n\t\t\t\t\t\ty = positions[lastId*2 + 1]\n\t\t\t\t\t\tids[i] = lastId\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlastId = i\n\t\t\t\t\t}\n\t\t\t\t\tpos[ptr++] = x\n\t\t\t\t\tpos[ptr++] = y\n\t\t\t\t}\n\n\t\t\t\tlet triangles = triangulate(pos, state.hole || [])\n\n\t\t\t\tfor (let i = 0, l = triangles.length; i < l; i++) {\n\t\t\t\t\tif (ids[triangles[i]] != null) triangles[i] = ids[triangles[i]]\n\t\t\t\t}\n\n\t\t\t\tstate.triangles = triangles\n\t\t\t}\n\n\t\t\t// update position buffers\n\t\t\tlet npos = new Float64Array(positions)\n\t\t\tnormalize(npos, 2, bounds)\n\n\t\t\tlet positionData = new Float64Array(count * 2 + 6)\n\n\t\t\t// rotate first segment join\n\t\t\tif (state.close) {\n\t\t\t\tif (positions[0] === positions[count*2 - 2] &&\n\t\t\t\t\tpositions[1] === positions[count*2 - 1]) {\n\t\t\t\t\tpositionData[0] = npos[count*2 - 4]\n\t\t\t\t\tpositionData[1] = npos[count*2 - 3]\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tpositionData[0] = npos[count*2 - 2]\n\t\t\t\t\tpositionData[1] = npos[count*2 - 1]\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpositionData[0] = npos[0]\n\t\t\t\tpositionData[1] = npos[1]\n\t\t\t}\n\n\t\t\tpositionData.set(npos, 2)\n\n\t\t\t// add last segment\n\t\t\tif (state.close) {\n\t\t\t\t// ignore coinciding start/end\n\t\t\t\tif (positions[0] === positions[count*2 - 2] &&\n\t\t\t\t\tpositions[1] === positions[count*2 - 1]) {\n\t\t\t\t\tpositionData[count*2 + 2] = npos[2]\n\t\t\t\t\tpositionData[count*2 + 3] = npos[3]\n\t\t\t\t\tstate.count -= 1\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tpositionData[count*2 + 2] = npos[0]\n\t\t\t\t\tpositionData[count*2 + 3] = npos[1]\n\t\t\t\t\tpositionData[count*2 + 4] = npos[2]\n\t\t\t\t\tpositionData[count*2 + 5] = npos[3]\n\t\t\t\t}\n\t\t\t}\n\t\t\t// add stub\n\t\t\telse {\n\t\t\t\tpositionData[count*2 + 2] = npos[count*2 - 2]\n\t\t\t\tpositionData[count*2 + 3] = npos[count*2 - 1]\n\t\t\t\tpositionData[count*2 + 4] = npos[count*2 - 2]\n\t\t\t\tpositionData[count*2 + 5] = npos[count*2 - 1]\n\t\t\t}\n\n\t\t\tstate.positionBuffer(float32(positionData))\n\t\t\tstate.positionFractBuffer(fract32(positionData))\n\t\t}\n\n\t\tif (o.range) {\n\t\t\tstate.range = o.range\n\t\t} else if (!state.range) {\n\t\t\tstate.range = state.bounds\n\t\t}\n\n\t\tif ((o.range || o.positions) && state.count) {\n\t\t\tlet bounds = state.bounds\n\n\t\t\tlet boundsW = bounds[2] - bounds[0],\n\t\t\t\tboundsH = bounds[3] - bounds[1]\n\n\t\t\tlet rangeW = state.range[2] - state.range[0],\n\t\t\t\trangeH = state.range[3] - state.range[1]\n\n\t\t\tstate.scale = [\n\t\t\t\tboundsW / rangeW,\n\t\t\t\tboundsH / rangeH\n\t\t\t]\n\t\t\tstate.translate = [\n\t\t\t\t-state.range[0] / rangeW + bounds[0] / rangeW || 0,\n\t\t\t\t-state.range[1] / rangeH + bounds[1] / rangeH || 0\n\t\t\t]\n\n\t\t\tstate.scaleFract = fract32(state.scale)\n\t\t\tstate.translateFract = fract32(state.translate)\n\t\t}\n\n\t\tif (o.dashes) {\n\t\t\tlet dashLength = 0., dashData\n\n\t\t\tif (!o.dashes || o.dashes.length < 2) {\n\t\t\t\tdashLength = 1.\n\t\t\t\tdashData = new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255])\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\tdashLength = 0.;\n\t\t\t\tfor(let i = 0; i < o.dashes.length; ++i) {\n\t\t\t\t\tdashLength += o.dashes[i]\n\t\t\t\t}\n\t\t\t\tdashData = new Uint8Array(dashLength * Line2D.dashMult)\n\t\t\t\tlet ptr = 0\n\t\t\t\tlet fillColor = 255\n\n\t\t\t\t// repeat texture two times to provide smooth 0-step\n\t\t\t\tfor (let k = 0; k < 2; k++) {\n\t\t\t\t\tfor(let i = 0; i < o.dashes.length; ++i) {\n\t\t\t\t\t\tfor(let j = 0, l = o.dashes[i] * Line2D.dashMult * .5; j < l; ++j) {\n\t\t\t\t\t\t\tdashData[ptr++] = fillColor\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfillColor ^= 255\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstate.dashLength = dashLength\n\t\t\tstate.dashTexture({\n\t\t\t\tchannels: 1,\n\t\t\t\tdata: dashData,\n\t\t\t\twidth: dashData.length,\n\t\t\t\theight: 1,\n\t\t\t\tmag: 'linear',\n\t\t\t\tmin: 'linear'\n\t\t\t}, 0, 0)\n\t\t}\n\n\t\tif (o.color) {\n\t\t\tlet count = state.count\n\t\t\tlet colors = o.color\n\n\t\t\tif (!colors) colors = 'transparent'\n\n\t\t\tlet colorData = new Uint8Array(count * 4 + 4)\n\n\t\t\t// convert colors to typed arrays\n\t\t\tif (!Array.isArray(colors) || typeof colors[0] === 'number') {\n\t\t\t\tlet c = rgba(colors, 'uint8')\n\n\t\t\t\tfor (let i = 0; i < count + 1; i++) {\n\t\t\t\t\tcolorData.set(c, i * 4)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tlet c = rgba(colors[i], 'uint8')\n\t\t\t\t\tcolorData.set(c, i * 4)\n\t\t\t\t}\n\t\t\t\tcolorData.set(rgba(colors[0], 'uint8'), count * 4)\n\t\t\t}\n\n\t\t\tstate.colorBuffer({\n\t\t\t\tusage: 'dynamic',\n\t\t\t\ttype: 'uint8',\n\t\t\t\tdata: colorData\n\t\t\t})\n\t\t}\n\t})\n\n\t// remove unmentioned passes\n\tif (options.length < this.passes.length) {\n\t\tfor (let i = options.length; i < this.passes.length; i++) {\n\t\t\tlet pass = this.passes[i]\n\t\t\tif (!pass) continue\n\t\t\tpass.colorBuffer.destroy()\n\t\t\tpass.positionBuffer.destroy()\n\t\t\tpass.dashTexture.destroy()\n\t\t}\n\t\tthis.passes.length = options.length\n\t}\n\n\t// remove null items\n\tlet passes = []\n\tfor (let i = 0; i < this.passes.length; i++) {\n\t\tif (this.passes[i] !== null) passes.push(this.passes[i])\n\t}\n\tthis.passes = passes\n\n\treturn this\n}\n\nLine2D.prototype.destroy = function () {\n\tthis.passes.forEach(pass => {\n\t\tpass.colorBuffer.destroy()\n\t\tpass.positionBuffer.destroy()\n\t\tpass.dashTexture.destroy()\n\t})\n\n\tthis.passes.length = 0\n\n\treturn this\n}\n\n"]},"metadata":{},"sourceType":"script"}