{"ast":null,"code":"'use strict';\n\nmodule.exports = createCamera;\n\nvar now = require('right-now');\n\nvar createView = require('3d-view');\n\nvar mouseChange = require('mouse-change');\n\nvar mouseWheel = require('mouse-wheel');\n\nvar mouseOffset = require('mouse-event-offset');\n\nvar hasPassive = require('has-passive-events');\n\nfunction createCamera(element, options) {\n  element = element || document.body;\n  options = options || {};\n  var limits = [0.01, Infinity];\n\n  if ('distanceLimits' in options) {\n    limits[0] = options.distanceLimits[0];\n    limits[1] = options.distanceLimits[1];\n  }\n\n  if ('zoomMin' in options) {\n    limits[0] = options.zoomMin;\n  }\n\n  if ('zoomMax' in options) {\n    limits[1] = options.zoomMax;\n  }\n\n  var view = createView({\n    center: options.center || [0, 0, 0],\n    up: options.up || [0, 1, 0],\n    eye: options.eye || [0, 0, 10],\n    mode: options.mode || 'orbit',\n    distanceLimits: limits\n  });\n  var pmatrix = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  var distance = 0.0;\n  var width = element.clientWidth;\n  var height = element.clientHeight;\n  var camera = {\n    keyBindingMode: 'rotate',\n    enableWheel: true,\n    view: view,\n    element: element,\n    delay: options.delay || 16,\n    rotateSpeed: options.rotateSpeed || 1,\n    zoomSpeed: options.zoomSpeed || 1,\n    translateSpeed: options.translateSpeed || 1,\n    flipX: !!options.flipX,\n    flipY: !!options.flipY,\n    modes: view.modes,\n    _ortho: options._ortho || options.projection && options.projection.type === 'orthographic' || false,\n    tick: function () {\n      var t = now();\n      var delay = this.delay;\n      var ctime = t - 2 * delay;\n      view.idle(t - delay);\n      view.recalcMatrix(ctime);\n      view.flush(t - (100 + delay * 2));\n      var allEqual = true;\n      var matrix = view.computedMatrix;\n\n      for (var i = 0; i < 16; ++i) {\n        allEqual = allEqual && pmatrix[i] === matrix[i];\n        pmatrix[i] = matrix[i];\n      }\n\n      var sizeChanged = element.clientWidth === width && element.clientHeight === height;\n      width = element.clientWidth;\n      height = element.clientHeight;\n\n      if (allEqual) {\n        return !sizeChanged;\n      }\n\n      distance = Math.exp(view.computedRadius[0]);\n      return true;\n    },\n    lookAt: function (eye, center, up) {\n      view.lookAt(view.lastT(), eye, center, up);\n    },\n    rotate: function (pitch, yaw, roll) {\n      view.rotate(view.lastT(), pitch, yaw, roll);\n    },\n    pan: function (dx, dy, dz) {\n      view.pan(view.lastT(), dx, dy, dz);\n    },\n    translate: function (dx, dy, dz) {\n      view.translate(view.lastT(), dx, dy, dz);\n    }\n  };\n  Object.defineProperties(camera, {\n    matrix: {\n      get: function () {\n        return view.computedMatrix;\n      },\n      set: function (mat) {\n        view.setMatrix(view.lastT(), mat);\n        return view.computedMatrix;\n      },\n      enumerable: true\n    },\n    mode: {\n      get: function () {\n        return view.getMode();\n      },\n      set: function (mode) {\n        var curUp = view.computedUp.slice();\n        var curEye = view.computedEye.slice();\n        var curCenter = view.computedCenter.slice();\n        view.setMode(mode);\n\n        if (mode === 'turntable') {\n          // Hacky time warping stuff to generate smooth animation\n          var t0 = now();\n\n          view._active.lookAt(t0, curEye, curCenter, curUp);\n\n          view._active.lookAt(t0 + 500, curEye, curCenter, [0, 0, 1]);\n\n          view._active.flush(t0);\n        }\n\n        return view.getMode();\n      },\n      enumerable: true\n    },\n    center: {\n      get: function () {\n        return view.computedCenter;\n      },\n      set: function (ncenter) {\n        view.lookAt(view.lastT(), null, ncenter);\n        return view.computedCenter;\n      },\n      enumerable: true\n    },\n    eye: {\n      get: function () {\n        return view.computedEye;\n      },\n      set: function (neye) {\n        view.lookAt(view.lastT(), neye);\n        return view.computedEye;\n      },\n      enumerable: true\n    },\n    up: {\n      get: function () {\n        return view.computedUp;\n      },\n      set: function (nup) {\n        view.lookAt(view.lastT(), null, null, nup);\n        return view.computedUp;\n      },\n      enumerable: true\n    },\n    distance: {\n      get: function () {\n        return distance;\n      },\n      set: function (d) {\n        view.setDistance(view.lastT(), d);\n        return d;\n      },\n      enumerable: true\n    },\n    distanceLimits: {\n      get: function () {\n        return view.getDistanceLimits(limits);\n      },\n      set: function (v) {\n        view.setDistanceLimits(v);\n        return v;\n      },\n      enumerable: true\n    }\n  });\n  element.addEventListener('contextmenu', function (ev) {\n    ev.preventDefault();\n    return false;\n  });\n  camera._lastX = -1;\n  camera._lastY = -1;\n  camera._lastMods = {\n    shift: false,\n    control: false,\n    alt: false,\n    meta: false\n  };\n\n  camera.enableMouseListeners = function () {\n    camera.mouseListener = mouseChange(element, handleInteraction); //enable simple touch interactions\n\n    element.addEventListener('touchstart', function (ev) {\n      var xy = mouseOffset(ev.changedTouches[0], element);\n      handleInteraction(0, xy[0], xy[1], camera._lastMods);\n      handleInteraction(1, xy[0], xy[1], camera._lastMods);\n      ev.preventDefault();\n    }, hasPassive ? {\n      passive: false\n    } : false);\n    element.addEventListener('touchmove', function (ev) {\n      var xy = mouseOffset(ev.changedTouches[0], element);\n      handleInteraction(1, xy[0], xy[1], camera._lastMods);\n      ev.preventDefault();\n    }, hasPassive ? {\n      passive: false\n    } : false);\n    element.addEventListener('touchend', function (ev) {\n      handleInteraction(0, camera._lastX, camera._lastY, camera._lastMods);\n      ev.preventDefault();\n    }, hasPassive ? {\n      passive: false\n    } : false);\n\n    function handleInteraction(buttons, x, y, mods) {\n      var keyBindingMode = camera.keyBindingMode;\n      if (keyBindingMode === false) return;\n      var rotate = keyBindingMode === 'rotate';\n      var pan = keyBindingMode === 'pan';\n      var zoom = keyBindingMode === 'zoom';\n      var ctrl = !!mods.control;\n      var alt = !!mods.alt;\n      var shift = !!mods.shift;\n      var left = !!(buttons & 1);\n      var right = !!(buttons & 2);\n      var middle = !!(buttons & 4);\n      var scale = 1.0 / element.clientHeight;\n      var dx = scale * (x - camera._lastX);\n      var dy = scale * (y - camera._lastY);\n      var flipX = camera.flipX ? 1 : -1;\n      var flipY = camera.flipY ? 1 : -1;\n      var drot = Math.PI * camera.rotateSpeed;\n      var t = now();\n\n      if (camera._lastX !== -1 && camera._lastY !== -1) {\n        if (rotate && left && !ctrl && !alt && !shift || left && !ctrl && !alt && shift) {\n          // Rotate\n          view.rotate(t, flipX * drot * dx, -flipY * drot * dy, 0);\n        }\n\n        if (pan && left && !ctrl && !alt && !shift || right || left && ctrl && !alt && !shift) {\n          // Pan\n          view.pan(t, -camera.translateSpeed * dx * distance, camera.translateSpeed * dy * distance, 0);\n        }\n\n        if (zoom && left && !ctrl && !alt && !shift || middle || left && !ctrl && alt && !shift) {\n          // Zoom\n          var kzoom = -camera.zoomSpeed * dy / window.innerHeight * (t - view.lastT()) * 100;\n          view.pan(t, 0, 0, distance * (Math.exp(kzoom) - 1));\n        }\n      }\n\n      camera._lastX = x;\n      camera._lastY = y;\n      camera._lastMods = mods;\n      return true;\n    }\n\n    camera.wheelListener = mouseWheel(element, function (dx, dy) {\n      // TODO remove now that we can disable scroll via scrollZoom?\n      if (camera.keyBindingMode === false) return;\n      if (!camera.enableWheel) return;\n      var flipX = camera.flipX ? 1 : -1;\n      var flipY = camera.flipY ? 1 : -1;\n      var t = now();\n\n      if (Math.abs(dx) > Math.abs(dy)) {\n        view.rotate(t, 0, 0, -dx * flipX * Math.PI * camera.rotateSpeed / window.innerWidth);\n      } else {\n        if (!camera._ortho) {\n          var kzoom = -camera.zoomSpeed * flipY * dy / window.innerHeight * (t - view.lastT()) / 20.0;\n          view.pan(t, 0, 0, distance * (Math.exp(kzoom) - 1));\n        }\n      }\n    }, true);\n  };\n\n  camera.enableMouseListeners();\n  return camera;\n}","map":{"version":3,"sources":["/Users/jingkaisu/Documents/HRfront/HalliganReviews/web_project/node_modules/gl-plot3d/camera.js"],"names":["module","exports","createCamera","now","require","createView","mouseChange","mouseWheel","mouseOffset","hasPassive","element","options","document","body","limits","Infinity","distanceLimits","zoomMin","zoomMax","view","center","up","eye","mode","pmatrix","distance","width","clientWidth","height","clientHeight","camera","keyBindingMode","enableWheel","delay","rotateSpeed","zoomSpeed","translateSpeed","flipX","flipY","modes","_ortho","projection","type","tick","t","ctime","idle","recalcMatrix","flush","allEqual","matrix","computedMatrix","i","sizeChanged","Math","exp","computedRadius","lookAt","lastT","rotate","pitch","yaw","roll","pan","dx","dy","dz","translate","Object","defineProperties","get","set","mat","setMatrix","enumerable","getMode","curUp","computedUp","slice","curEye","computedEye","curCenter","computedCenter","setMode","t0","_active","ncenter","neye","nup","d","setDistance","getDistanceLimits","v","setDistanceLimits","addEventListener","ev","preventDefault","_lastX","_lastY","_lastMods","shift","control","alt","meta","enableMouseListeners","mouseListener","handleInteraction","xy","changedTouches","passive","buttons","x","y","mods","zoom","ctrl","left","right","middle","scale","drot","PI","kzoom","window","innerHeight","wheelListener","abs","innerWidth"],"mappings":"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","sourcesContent":["'use strict'\n\nmodule.exports = createCamera\n\nvar now         = require('right-now')\nvar createView  = require('3d-view')\nvar mouseChange = require('mouse-change')\nvar mouseWheel  = require('mouse-wheel')\nvar mouseOffset = require('mouse-event-offset')\nvar hasPassive  = require('has-passive-events')\n\nfunction createCamera(element, options) {\n  element = element || document.body\n  options = options || {}\n\n  var limits  = [ 0.01, Infinity ]\n  if('distanceLimits' in options) {\n    limits[0] = options.distanceLimits[0]\n    limits[1] = options.distanceLimits[1]\n  }\n  if('zoomMin' in options) {\n    limits[0] = options.zoomMin\n  }\n  if('zoomMax' in options) {\n    limits[1] = options.zoomMax\n  }\n\n  var view = createView({\n    center: options.center || [0,0,0],\n    up:     options.up     || [0,1,0],\n    eye:    options.eye    || [0,0,10],\n    mode:   options.mode   || 'orbit',\n    distanceLimits: limits\n  })\n\n  var pmatrix = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]\n  var distance = 0.0\n  var width   = element.clientWidth\n  var height  = element.clientHeight\n\n  var camera = {\n    keyBindingMode: 'rotate',\n    enableWheel: true,\n    view:               view,\n    element:            element,\n    delay:              options.delay          || 16,\n    rotateSpeed:        options.rotateSpeed    || 1,\n    zoomSpeed:          options.zoomSpeed      || 1,\n    translateSpeed:     options.translateSpeed || 1,\n    flipX:              !!options.flipX,\n    flipY:              !!options.flipY,\n    modes:              view.modes,\n    _ortho: options._ortho || (options.projection && options.projection.type === 'orthographic') || false,\n    tick: function() {\n      var t = now()\n      var delay = this.delay\n      var ctime = t - 2 * delay\n      view.idle(t-delay)\n      view.recalcMatrix(ctime)\n      view.flush(t-(100+delay*2))\n      var allEqual = true\n      var matrix = view.computedMatrix\n      for(var i=0; i<16; ++i) {\n        allEqual = allEqual && (pmatrix[i] === matrix[i])\n        pmatrix[i] = matrix[i]\n      }\n      var sizeChanged =\n          element.clientWidth === width &&\n          element.clientHeight === height\n      width  = element.clientWidth\n      height = element.clientHeight\n      if(allEqual) {\n        return !sizeChanged\n      }\n      distance = Math.exp(view.computedRadius[0])\n      return true\n    },\n    lookAt: function(eye, center, up) {\n      view.lookAt(view.lastT(), eye, center, up)\n    },\n    rotate: function(pitch, yaw, roll) {\n      view.rotate(view.lastT(), pitch, yaw, roll)\n    },\n    pan: function(dx, dy, dz) {\n      view.pan(view.lastT(), dx, dy, dz)\n    },\n    translate: function(dx, dy, dz) {\n      view.translate(view.lastT(), dx, dy, dz)\n    }\n  }\n\n  Object.defineProperties(camera, {\n    matrix: {\n      get: function() {\n        return view.computedMatrix\n      },\n      set: function(mat) {\n        view.setMatrix(view.lastT(), mat)\n        return view.computedMatrix\n      },\n      enumerable: true\n    },\n    mode: {\n      get: function() {\n        return view.getMode()\n      },\n      set: function(mode) {\n        var curUp = view.computedUp.slice()\n        var curEye = view.computedEye.slice()\n        var curCenter = view.computedCenter.slice()\n        view.setMode(mode)\n        if(mode === 'turntable') {\n          // Hacky time warping stuff to generate smooth animation\n          var t0 = now()\n          view._active.lookAt(t0, curEye, curCenter, curUp)\n          view._active.lookAt(t0 + 500, curEye, curCenter, [0, 0, 1])\n          view._active.flush(t0)\n        }\n        return view.getMode()\n      },\n      enumerable: true\n    },\n    center: {\n      get: function() {\n        return view.computedCenter\n      },\n      set: function(ncenter) {\n        view.lookAt(view.lastT(), null, ncenter)\n        return view.computedCenter\n      },\n      enumerable: true\n    },\n    eye: {\n      get: function() {\n        return view.computedEye\n      },\n      set: function(neye) {\n        view.lookAt(view.lastT(), neye)\n        return view.computedEye\n      },\n      enumerable: true\n    },\n    up: {\n      get: function() {\n        return view.computedUp\n      },\n      set: function(nup) {\n        view.lookAt(view.lastT(), null, null, nup)\n        return view.computedUp\n      },\n      enumerable: true\n    },\n    distance: {\n      get: function() {\n        return distance\n      },\n      set: function(d) {\n        view.setDistance(view.lastT(), d)\n        return d\n      },\n      enumerable: true\n    },\n    distanceLimits: {\n      get: function() {\n        return view.getDistanceLimits(limits)\n      },\n      set: function(v) {\n        view.setDistanceLimits(v)\n        return v\n      },\n      enumerable: true\n    }\n  })\n\n  element.addEventListener('contextmenu', function(ev) {\n    ev.preventDefault()\n    return false\n  })\n\n  camera._lastX = -1\n  camera._lastY = -1\n  camera._lastMods = {shift: false, control: false, alt: false, meta: false}\n\n  camera.enableMouseListeners = function() {\n\n    camera.mouseListener = mouseChange(element, handleInteraction)\n\n    //enable simple touch interactions\n    element.addEventListener('touchstart', function (ev) {\n      var xy = mouseOffset(ev.changedTouches[0], element)\n      handleInteraction(0, xy[0], xy[1], camera._lastMods)\n      handleInteraction(1, xy[0], xy[1], camera._lastMods)\n\n      ev.preventDefault()\n    }, hasPassive ? {passive: false} : false)\n\n    element.addEventListener('touchmove', function (ev) {\n      var xy = mouseOffset(ev.changedTouches[0], element)\n      handleInteraction(1, xy[0], xy[1], camera._lastMods)\n\n      ev.preventDefault()\n    }, hasPassive ? {passive: false} : false)\n\n    element.addEventListener('touchend', function (ev) {\n\n      handleInteraction(0, camera._lastX, camera._lastY, camera._lastMods)\n\n      ev.preventDefault()\n    }, hasPassive ? {passive: false} : false)\n\n    function handleInteraction (buttons, x, y, mods) {\n      var keyBindingMode = camera.keyBindingMode\n\n      if(keyBindingMode === false) return\n\n      var rotate = keyBindingMode === 'rotate'\n      var pan = keyBindingMode === 'pan'\n      var zoom = keyBindingMode === 'zoom'\n\n      var ctrl = !!mods.control\n      var alt = !!mods.alt\n      var shift = !!mods.shift\n      var left = !!(buttons & 1)\n      var right = !!(buttons & 2)\n      var middle = !!(buttons & 4)\n\n      var scale = 1.0 / element.clientHeight\n      var dx    = scale * (x - camera._lastX)\n      var dy    = scale * (y - camera._lastY)\n\n      var flipX = camera.flipX ? 1 : -1\n      var flipY = camera.flipY ? 1 : -1\n\n      var drot  = Math.PI * camera.rotateSpeed\n\n      var t = now()\n\n      if(camera._lastX !== -1 && camera._lastY !== -1) {\n        if((rotate && left && !ctrl && !alt && !shift) || (left && !ctrl && !alt && shift)) {\n          // Rotate\n          view.rotate(t, flipX * drot * dx, -flipY * drot * dy, 0)\n        }\n\n        if((pan && left && !ctrl && !alt && !shift) || right || (left && ctrl && !alt && !shift)) {\n          // Pan\n          view.pan(t, -camera.translateSpeed * dx * distance, camera.translateSpeed * dy * distance, 0)\n        }\n\n        if((zoom && left && !ctrl && !alt && !shift) || middle || (left && !ctrl && alt && !shift)) {\n          // Zoom\n          var kzoom = -camera.zoomSpeed * dy / window.innerHeight * (t - view.lastT()) * 100\n          view.pan(t, 0, 0, distance * (Math.exp(kzoom) - 1))\n        }\n      }\n\n      camera._lastX = x\n      camera._lastY = y\n      camera._lastMods = mods\n\n      return true\n    }\n\n    camera.wheelListener = mouseWheel(element, function(dx, dy) {\n      // TODO remove now that we can disable scroll via scrollZoom?\n      if(camera.keyBindingMode === false) return\n      if(!camera.enableWheel) return\n\n      var flipX = camera.flipX ? 1 : -1\n      var flipY = camera.flipY ? 1 : -1\n      var t = now()\n      if(Math.abs(dx) > Math.abs(dy)) {\n        view.rotate(t, 0, 0, -dx * flipX * Math.PI * camera.rotateSpeed / window.innerWidth)\n      } else {\n        if(!camera._ortho) {\n          var kzoom = -camera.zoomSpeed * flipY * dy / window.innerHeight * (t - view.lastT()) / 20.0\n          view.pan(t, 0, 0, distance * (Math.exp(kzoom) - 1))\n        }\n      }\n    }, true)\n  }\n\n  camera.enableMouseListeners()\n\n  return camera\n}\n"]},"metadata":{},"sourceType":"script"}